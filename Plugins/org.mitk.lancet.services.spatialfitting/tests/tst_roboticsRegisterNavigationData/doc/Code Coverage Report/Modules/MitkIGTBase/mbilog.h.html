<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mbilog.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#ifndef _MBILOG_H
#define _MBILOG_H

#include &lt;sstream&gt;

#include "mbilogBackendBase.h"
#include "mbilogBackendCout.h"
#include "mbilogConfig.h"
#include "mbilogExports.h"
#include "mbilogLogMessage.h"
#include "mbilogLoggingTypes.h"

namespace mbilog
{
  /** \brief Registeres a backend to the mbi logging mechanism. If a backend is registered here, all mbilog messages
   *         are relayed to this backend through the method ProcessMessage. If no backend is registered the default
   *         backend is used.
   */
  void MBILOG_EXPORT RegisterBackend(BackendBase *backend);

  /** \brief Unregisters a backend.
   */
  void MBILOG_EXPORT UnregisterBackend(BackendBase *backend);

  /** \brief Distributes the given message to all registered backends. Should only be called by objects
    *        of the class pseudo stream.
    */
  void MBILOG_EXPORT DistributeToBackends(LogMessage &amp;l);

  /**
   * Enable the output of a backend.
   **/
  void MBILOG_EXPORT EnableBackends(OutputType type);
  /**
   * Disable the output of a backend.
   **/
  void MBILOG_EXPORT DisableBackends(OutputType type);
  /**
   * Checks wether the output of this backend is enabled.
   **/
  bool MBILOG_EXPORT IsBackendEnabled(OutputType type);

  /**
   * \brief An object of this class simulates a std::cout stream. This means messages can be added by
   *        using the bit shift operator (&lt;&lt;). Should only be used by the macros defined in the file mbilog.h
   *  \ingroup mbilog
   */
  class MBILOG_EXPORT PseudoStream
  {
  protected:
    bool disabled;
    LogMessage msg;
    std::stringstream ss;

  public:
    inline PseudoStream(int level, const char *filePath, int lineNumber, const char *functionName)
<span style = "background-color:#dfd">      : disabled(false), msg(LogMessage(level, filePath, lineNumber, functionName)), ss(std::stringstream::out)
    {
    }</span>

    /** \brief The message which is stored in the member ss is written to the backend. */
    inline ~PseudoStream()
<span style = "background-color:#dfd">    {
      if (!disabled)</span>
      {
<span style = "background-color:#dfd">        msg.message = ss.str();
        msg.moduleName = MBILOG_MODULENAME;
        DistributeToBackends(msg);</span>
      }
<span style = "background-color:#dfd">    }</span>

    /** \brief Definition of the bit shift operator for this class.*/
    template &lt;class T&gt;
    inline PseudoStream &amp;operator&lt;&lt;(const T &amp;data)
<span style = "background-color:#dfd">    {
      if (!disabled)</span>
      {
<span style = "background-color:#dfd">        std::locale C("C");
        std::locale originalLocale = ss.getloc();
        ss.imbue(C);</span>

<span style = "background-color:#dfd">        ss &lt;&lt; data;</span>

<span style = "background-color:#dfd">        ss.imbue(originalLocale);
      }
      return *this;
    }</span>

    /** \brief Definition of the bit shift operator for this class (for non const data).*/
    template &lt;class T&gt;
    inline PseudoStream &amp;operator&lt;&lt;(T &amp;data)
<span style = "background-color:#dfd">    {
      if (!disabled)</span>
      {
<span style = "background-color:#dfd">        std::locale C("C");
        std::locale originalLocale = ss.getloc();
        ss.imbue(C);</span>

<span style = "background-color:#dfd">        ss &lt;&lt; data;</span>

<span style = "background-color:#dfd">        ss.imbue(originalLocale);
      }
      return *this;
    }</span>

    /** \brief Definition of the bit shift operator for this class (for functions).*/
    inline PseudoStream &amp;operator&lt;&lt;(std::ostream &amp;(*func)(std::ostream &amp;))
<span style = "background-color:#dfd">    {
      if (!disabled)</span>
      {
<span style = "background-color:#dfd">        std::locale C("C");
        std::locale originalLocale = ss.getloc();
        ss.imbue(C);</span>

<span style = "background-color:#dfd">        ss &lt;&lt; func;</span>

<span style = "background-color:#dfd">        ss.imbue(originalLocale);
      }
      return *this;
    }</span>

    /** \brief Sets the category of this PseudoStream object. If there already is a category it is appended, seperated
     * by a dot.*/
    inline PseudoStream &amp;operator()(const char *category)
<span style = "background-color:#fdd">    {
      if (!disabled)</span>
      {
<span style = "background-color:#fdd">        if (msg.category.length())
          msg.category += ".";
        msg.category += category;</span>
      }
<span style = "background-color:#fdd">      return *this;
    }</span>

    /** \brief Enables/disables the PseudoStream. If set to false parsing and output is suppressed. */
    inline PseudoStream &amp;operator()(bool enabled)
<span style = "background-color:#fdd">    {
      disabled |= !enabled;
      return *this;
    }</span>
  };

  /**
   * \brief An object of this class simulates a std::cout stream but does nothing. This class is for dummy objects, bit
   * shift
   *        operators are availiable but doing nothing. Should only be used by the macros defined in the file mbilog.h
   * \ingroup mbilog
   */
  class MBILOG_EXPORT NullStream
  {
  public:
    template &lt;class T&gt;
    inline NullStream &amp;operator&lt;&lt;(const T &amp; /*data*/)
    {
      return *this;
    }
    template &lt;class T&gt;
    inline NullStream &amp;operator&lt;&lt;(T &amp; /*data*/)
    {
      return *this;
    }
<span style = "background-color:#fdd">    inline NullStream &amp;operator&lt;&lt;(std::ostream &amp;(*)(std::ostream &amp;)) { return *this; }
    inline NullStream &amp;operator()(const char *) { return *this; }
    inline NullStream &amp;operator()(bool) { return *this; }</span>
  };

  //  /** \brief templated backend: one can define a class and a method to create a new backend. */
  //  template&lt;typename T&gt;
  //  struct DelegateBackend : public BackendBase
  //  {
  //
  //    typedef void(T::*Callback)(const mbilog::LogMessage&amp;);
  //
  //    DelegateBackend(T* obj, Callback callback) : m_Obj(obj), m_Callback(callback)
  //    {
  //    }
  //
  //    void ProcessMessage(const mbilog::LogMessage&amp; msg)
  //    {
  //      m_Obj-&gt;*m_Callback(msg);
  //    }
  //
  //  private:
  //
  //    T* m_Obj;
  //    Callback m_Callback;
  //  };
}

/** \brief Macros for different message levels. Creates an instance of class PseudoStream with the corresponding message
 * level.
  *        Other parameters are the name of the source file, line of the source code and function name which are
 * generated
  *        by the compiler.
  */
#define MBI_INFO mbilog::PseudoStream(mbilog::Info, __FILE__, __LINE__, __FUNCTION__)
#define MBI_WARN mbilog::PseudoStream(mbilog::Warn, __FILE__, __LINE__, __FUNCTION__)
#define MBI_ERROR mbilog::PseudoStream(mbilog::Error, __FILE__, __LINE__, __FUNCTION__)
#define MBI_FATAL mbilog::PseudoStream(mbilog::Fatal, __FILE__, __LINE__, __FUNCTION__)

/** \brief Macro for the debug messages. The messages are disabled if the cmake variable MBILOG_ENABLE_DEBUG is false.
 */
#ifdef MBILOG_ENABLE_DEBUG
#define MBI_DEBUG mbilog::PseudoStream(mbilog::Debug, __FILE__, __LINE__, __FUNCTION__)
#else
#define MBI_DEBUG true ? mbilog::NullStream() : mbilog::NullStream() // this is magic by markus
#endif

#endif</pre>
	</body>
</html>