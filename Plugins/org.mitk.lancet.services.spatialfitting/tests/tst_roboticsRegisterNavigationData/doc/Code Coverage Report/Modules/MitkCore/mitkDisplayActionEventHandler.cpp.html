<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkDisplayActionEventHandler.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkDisplayActionEventHandler.h"

mitk::DisplayActionEventHandler::~DisplayActionEventHandler()
<span style = "background-color:#fdd">{
  if (!m_ObservableBroadcast.IsExpired())</span>
  {
<span style = "background-color:#fdd">    auto observableBroadcastPtr = m_ObservableBroadcast.Lock();</span>

    // remove current observer
<span style = "background-color:#fdd">    for (const auto&amp; tag : m_ObserverTags)</span>
    {
<span style = "background-color:#fdd">      observableBroadcastPtr-&gt;RemoveObserver(tag);
    }
    m_ObserverTags.clear();
  }
}</span>

void mitk::DisplayActionEventHandler::SetObservableBroadcast(DisplayActionEventBroadcast* observableBroadcast)
<span style = "background-color:#fdd">{
  if (m_ObservableBroadcast == observableBroadcast)</span>
  {
    // no need to update the broadcast class
<span style = "background-color:#fdd">    return;</span>
  }

<span style = "background-color:#fdd">  if (!m_ObservableBroadcast.IsExpired())</span>
  {
<span style = "background-color:#fdd">    auto observableBroadcastPtr = m_ObservableBroadcast.Lock();</span>

    // remove current observer
<span style = "background-color:#fdd">    for (const auto&amp; tag : m_ObserverTags)</span>
    {
<span style = "background-color:#fdd">      observableBroadcastPtr-&gt;RemoveObserver(tag);
    }
    m_ObserverTags.clear();
  }</span>

  // set new broadcast class
<span style = "background-color:#fdd">  m_ObservableBroadcast = observableBroadcast;
}</span>

mitk::DisplayActionEventHandler::OberserverTagType mitk::DisplayActionEventHandler::ConnectDisplayActionEvent(const DisplayActionEvent&amp; displayActionEvent,
  const StdFunctionCommand::ActionFunction&amp; actionFunction,
  const StdFunctionCommand::FilterFunction&amp; filterFunction)
<span style = "background-color:#fdd">{
  if (m_ObservableBroadcast.IsExpired())</span>
  {
<span style = "background-color:#fdd">    mitkThrow() &lt;&lt; "No display action event broadcast class set to observe. Use 'SetObservableBroadcast' before connecting events.";</span>
  }

<span style = "background-color:#fdd">  auto observableBroadcast = m_ObservableBroadcast.Lock();
  auto command = StdFunctionCommand::New();
  command-&gt;SetCommandAction(actionFunction);
  command-&gt;SetCommandFilter(filterFunction);
  OberserverTagType tag = observableBroadcast-&gt;AddObserver(displayActionEvent, command);
  m_ObserverTags.push_back(tag);
  return tag;
}</span>

void mitk::DisplayActionEventHandler::DisconnectObserver(OberserverTagType observerTag)
<span style = "background-color:#fdd">{
  if (m_ObservableBroadcast.IsExpired())</span>
  {
<span style = "background-color:#fdd">    mitkThrow() &lt;&lt; "No display action event broadcast class set to observe. Use 'SetObservableBroadcast' before disconnecting observer.";</span>
  }

<span style = "background-color:#fdd">  auto observableBroadcast = m_ObservableBroadcast.Lock();
  std::vector&lt;OberserverTagType&gt;::iterator observerTagPosition = std::find(m_ObserverTags.begin(), m_ObserverTags.end(), observerTag);
  if (observerTagPosition != m_ObserverTags.end())</span>
  {
<span style = "background-color:#fdd">    observableBroadcast-&gt;RemoveObserver(observerTag);
    m_ObserverTags.erase(observerTagPosition);</span>
  }
<span style = "background-color:#fdd">}</span>

void mitk::DisplayActionEventHandler::InitActions()
<span style = "background-color:#fdd">{
  if (m_ObservableBroadcast.IsExpired())</span>
  {
<span style = "background-color:#fdd">    mitkThrow() &lt;&lt; "No display action event broadcast class set to observe. Use 'SetObservableBroadcast' before initializing actions.";</span>
  }

<span style = "background-color:#fdd">  auto observableBroadcast = m_ObservableBroadcast.Lock();</span>
  // remove all current display action events as observer
<span style = "background-color:#fdd">  auto allObserverTags = GetAllObserverTags();
  for (const auto&amp; tag : allObserverTags)</span>
  {
<span style = "background-color:#fdd">    observableBroadcast-&gt;RemoveObserver(tag);
  }
  m_ObserverTags.clear();</span>

<span style = "background-color:#fdd">  InitActionsImpl();
}</span></pre>
	</body>
</html>