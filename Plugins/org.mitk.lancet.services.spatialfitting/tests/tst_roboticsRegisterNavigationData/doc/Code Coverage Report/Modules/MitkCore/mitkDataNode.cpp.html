<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkDataNode.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkDataNode.h"
#include "mitkCoreObjectFactory.h"
#include &lt;vtkTransform.h&gt;

#include "mitkGroupTagProperty.h"
#include "mitkProperties.h"
#include "mitkSmartPointerProperty.h"
#include "mitkStringProperty.h"
//#include "mitkMaterialProperty.h"
#include "mitkColorProperty.h"
#include "mitkCoreObjectFactory.h"
#include "mitkGenericProperty.h"
#include "mitkGeometry3D.h"
#include "mitkImageSource.h"
#include "mitkLevelWindowProperty.h"
#include "mitkRenderingManager.h"

namespace mitk
{
<span style = "background-color:#fdd">  itkEventMacroDefinition(InteractorChangedEvent, itk::AnyEvent);</span>
}

mitk::Mapper *mitk::DataNode::GetMapper(MapperSlotId id) const
<span style = "background-color:#fdd">{
  if ((id &gt;= m_Mappers.size()) || (m_Mappers[id].IsNull()))</span>
  {
<span style = "background-color:#fdd">    if (id &gt;= m_Mappers.capacity())</span>
    {
      //      int i, size=id-m_Mappers.capacity()+10;
<span style = "background-color:#fdd">      m_Mappers.resize(id + 10);</span>
    }
<span style = "background-color:#fdd">    m_Mappers[id] = CoreObjectFactory::GetInstance()-&gt;CreateMapper(const_cast&lt;DataNode *&gt;(this), id);</span>
  }
<span style = "background-color:#fdd">  return m_Mappers[id];
}</span>

mitk::BaseData *mitk::DataNode::GetData() const
<span style = "background-color:#fdd">{
  return m_Data;
}</span>

void mitk::DataNode::SetData(mitk::BaseData *baseData)
<span style = "background-color:#fdd">{
  if (m_Data != baseData)</span>
  {
<span style = "background-color:#fdd">    m_Mappers.clear();
    m_Mappers.resize(10);</span>

<span style = "background-color:#fdd">    if (m_Data.IsNotNull() &amp;&amp; baseData != nullptr)</span>
    {
      // Do previous and new data have same type? Keep existing properties.
<span style = "background-color:#fdd">      if (0 == strcmp(m_Data-&gt;GetNameOfClass(), baseData-&gt;GetNameOfClass()))</span>
      {
<span style = "background-color:#fdd">        m_Data = baseData;
      }</span>
      else
      {
<span style = "background-color:#fdd">        m_Data = baseData;
        this-&gt;GetPropertyList()-&gt;Clear();
        mitk::CoreObjectFactory::GetInstance()-&gt;SetDefaultProperties(this);</span>
      }
<span style = "background-color:#fdd">    }</span>
    else
    {
<span style = "background-color:#fdd">      m_Data = baseData;
      mitk::CoreObjectFactory::GetInstance()-&gt;SetDefaultProperties(this);</span>
    }

<span style = "background-color:#fdd">    m_DataReferenceChangedTime.Modified();
    Modified();</span>
  }
<span style = "background-color:#fdd">}</span>

mitk::DataNode::DataNode()
<span style = "background-color:#fdd">  : m_PropertyList(PropertyList::New()),
    m_PropertyListModifiedObserverTag(0)
{
  m_Mappers.resize(10);</span>

  // subscribe for modified event
<span style = "background-color:#fdd">  itk::MemberCommand&lt;mitk::DataNode&gt;::Pointer _PropertyListModifiedCommand = itk::MemberCommand&lt;mitk::DataNode&gt;::New();
  _PropertyListModifiedCommand-&gt;SetCallbackFunction(this, &amp;mitk::DataNode::PropertyListModified);
  m_PropertyListModifiedObserverTag = m_PropertyList-&gt;AddObserver(itk::ModifiedEvent(), _PropertyListModifiedCommand);
}</span>

mitk::DataNode::~DataNode()
<span style = "background-color:#fdd">{
  if (m_PropertyList.IsNotNull())
    m_PropertyList-&gt;RemoveObserver(m_PropertyListModifiedObserverTag);</span>

<span style = "background-color:#fdd">  m_Mappers.clear();
  m_Data = nullptr;
}</span>

mitk::DataNode &amp;mitk::DataNode::operator=(const DataNode &amp;right)
<span style = "background-color:#fdd">{
  mitk::DataNode *node = mitk::DataNode::New();
  node-&gt;SetData(right.GetData());
  return *node;
}</span>

mitk::DataNode &amp;mitk::DataNode::operator=(mitk::BaseData *right)
<span style = "background-color:#fdd">{
  mitk::DataNode *node = mitk::DataNode::New();
  node-&gt;SetData(right);
  return *node;
}</span>

#if (_MSC_VER &gt; 1200) || !defined(_MSC_VER)
std::istream &amp;mitk::operator&gt;&gt;(std::istream &amp;i, mitk::DataNode::Pointer &amp;dtn)
#endif
#if ((defined(_MSC_VER)) &amp;&amp; (_MSC_VER &lt;= 1200))
  std::istream &amp;
  operator&gt;&gt;(std::istream &amp;i, mitk::DataNode::Pointer &amp;dtn)
#endif
<span style = "background-color:#fdd">{
  dtn = mitk::DataNode::New();</span>
  // i &gt;&gt; av.get();
<span style = "background-color:#fdd">  return i;
}</span>

#if (_MSC_VER &gt; 1200) || !defined(_MSC_VER)
std::ostream &amp;mitk::operator&lt;&lt;(std::ostream &amp;o, mitk::DataNode::Pointer &amp;dtn)
#endif
#if ((defined(_MSC_VER)) &amp;&amp; (_MSC_VER &lt;= 1200))
  std::ostream &amp;
  operator&lt;&lt;(std::ostream &amp;o, mitk::DataNode::Pointer &amp;dtn)
#endif
<span style = "background-color:#fdd">{
  if (dtn-&gt;GetData() != nullptr)
    o &lt;&lt; dtn-&gt;GetData()-&gt;GetNameOfClass();</span>
  else
<span style = "background-color:#fdd">    o &lt;&lt; "empty data";
  return o;
}</span>

void mitk::DataNode::SetMapper(MapperSlotId id, mitk::Mapper *mapper)
<span style = "background-color:#fdd">{
  m_Mappers[id] = mapper;</span>

<span style = "background-color:#fdd">  if (mapper != nullptr)
    mapper-&gt;SetDataNode(this);
}</span>

void mitk::DataNode::UpdateOutputInformation()
<span style = "background-color:#fdd">{
  if (this-&gt;GetSource())</span>
  {
<span style = "background-color:#fdd">    this-&gt;GetSource()-&gt;UpdateOutputInformation();</span>
  }
<span style = "background-color:#fdd">}</span>

void mitk::DataNode::SetRequestedRegionToLargestPossibleRegion()
<span style = "background-color:#fdd">{
}</span>

bool mitk::DataNode::RequestedRegionIsOutsideOfTheBufferedRegion()
<span style = "background-color:#fdd">{
  return false;
}</span>

bool mitk::DataNode::VerifyRequestedRegion()
<span style = "background-color:#fdd">{
  return true;
}</span>

void mitk::DataNode::SetRequestedRegion(const itk::DataObject * /*data*/)
<span style = "background-color:#fdd">{
}</span>

mitk::DataNode::PropertyListKeyNames mitk::DataNode::GetPropertyListNames() const
<span style = "background-color:#fdd">{
  PropertyListKeyNames result;</span>

<span style = "background-color:#fdd">  for (const auto &amp;entries : m_MapOfPropertyLists)
    result.push_back(entries.first);</span>

<span style = "background-color:#fdd">  return result;
}</span>

void mitk::DataNode::CopyInformation(const itk::DataObject * /*data*/)
<span style = "background-color:#fdd">{
}</span>
mitk::PropertyList *mitk::DataNode::GetPropertyList(const mitk::BaseRenderer *renderer) const
<span style = "background-color:#fdd">{
  if (renderer == nullptr)
    return m_PropertyList;</span>

<span style = "background-color:#fdd">  return this-&gt;GetPropertyList(renderer-&gt;GetName());
}</span>

mitk::PropertyList *mitk::DataNode::GetPropertyList(const std::string &amp;rendererName) const
<span style = "background-color:#fdd">{
  if (rendererName.empty())
    return m_PropertyList;</span>

<span style = "background-color:#fdd">  mitk::PropertyList::Pointer &amp;propertyList = m_MapOfPropertyLists[rendererName];</span>

<span style = "background-color:#fdd">  if (propertyList.IsNull())
    propertyList = mitk::PropertyList::New();</span>

<span style = "background-color:#fdd">  assert(m_MapOfPropertyLists[rendererName].IsNotNull());</span>

<span style = "background-color:#fdd">  return propertyList;
}</span>

void mitk::DataNode::ConcatenatePropertyList(PropertyList *pList, bool replace)
<span style = "background-color:#fdd">{
  m_PropertyList-&gt;ConcatenatePropertyList(pList, replace);
}</span>

mitk::BaseProperty *mitk::DataNode::GetProperty(const char *propertyKey, const mitk::BaseRenderer *renderer, bool fallBackOnDataProperties) const
<span style = "background-color:#fdd">{
  if (nullptr == propertyKey)
    return nullptr;</span>

<span style = "background-color:#fdd">  if (nullptr != renderer)</span>
  {
<span style = "background-color:#fdd">    auto it = m_MapOfPropertyLists.find(renderer-&gt;GetName());</span>

<span style = "background-color:#fdd">    if (m_MapOfPropertyLists.end() != it)</span>
    {
<span style = "background-color:#fdd">      auto property = it-&gt;second-&gt;GetProperty(propertyKey);</span>

<span style = "background-color:#fdd">      if (nullptr != property)
        return property;</span>
    }
<span style = "background-color:#fdd">  }</span>

<span style = "background-color:#fdd">  auto property = m_PropertyList-&gt;GetProperty(propertyKey);</span>

<span style = "background-color:#fdd">  if (nullptr == property &amp;&amp; fallBackOnDataProperties &amp;&amp; m_Data.IsNotNull())
    property = m_Data-&gt;GetProperty(propertyKey);</span>

<span style = "background-color:#fdd">  return property;
}</span>

mitk::DataNode::GroupTagList mitk::DataNode::GetGroupTags() const
<span style = "background-color:#fdd">{
  GroupTagList groups;
  const PropertyList::PropertyMap *propertyMap = m_PropertyList-&gt;GetMap();</span>

<span style = "background-color:#fdd">  for (auto groupIter =</span>
         propertyMap-&gt;begin(); // m_PropertyList is created in the constructor, so we don't check it here
<span style = "background-color:#fdd">       groupIter != propertyMap-&gt;end();
       ++groupIter)</span>
  {
<span style = "background-color:#fdd">    const BaseProperty *bp = groupIter-&gt;second;
    if (dynamic_cast&lt;const GroupTagProperty *&gt;(bp))</span>
    {
<span style = "background-color:#fdd">      groups.insert(groupIter-&gt;first);
    }
  }</span>

<span style = "background-color:#fdd">  return groups;
}</span>

bool mitk::DataNode::GetBoolProperty(const char *propertyKey, bool &amp;boolValue, const mitk::BaseRenderer *renderer) const
<span style = "background-color:#fdd">{
  mitk::BoolProperty::Pointer boolprop = dynamic_cast&lt;mitk::BoolProperty *&gt;(GetProperty(propertyKey, renderer));
  if (boolprop.IsNull())
    return false;</span>

<span style = "background-color:#fdd">  boolValue = boolprop-&gt;GetValue();
  return true;
}</span>

bool mitk::DataNode::GetIntProperty(const char *propertyKey, int &amp;intValue, const mitk::BaseRenderer *renderer) const
<span style = "background-color:#fdd">{
  mitk::IntProperty::Pointer intprop = dynamic_cast&lt;mitk::IntProperty *&gt;(GetProperty(propertyKey, renderer));
  if (intprop.IsNull())
    return false;</span>

<span style = "background-color:#fdd">  intValue = intprop-&gt;GetValue();
  return true;
}</span>

bool mitk::DataNode::GetFloatProperty(const char *propertyKey,
                                      float &amp;floatValue,
                                      const mitk::BaseRenderer *renderer) const
<span style = "background-color:#fdd">{
  mitk::FloatProperty::Pointer floatprop = dynamic_cast&lt;mitk::FloatProperty *&gt;(GetProperty(propertyKey, renderer));
  if (floatprop.IsNull())
    return false;</span>

<span style = "background-color:#fdd">  floatValue = floatprop-&gt;GetValue();
  return true;
}</span>

bool mitk::DataNode::GetDoubleProperty(const char *propertyKey,
                                       double &amp;doubleValue,
                                       const mitk::BaseRenderer *renderer) const
<span style = "background-color:#fdd">{
  mitk::DoubleProperty::Pointer doubleprop = dynamic_cast&lt;mitk::DoubleProperty *&gt;(GetProperty(propertyKey, renderer));
  if (doubleprop.IsNull())</span>
  {
    // try float instead
<span style = "background-color:#fdd">    float floatValue = 0;
    if (this-&gt;GetFloatProperty(propertyKey, floatValue, renderer))</span>
    {
<span style = "background-color:#fdd">      doubleValue = floatValue;
      return true;</span>
    }
<span style = "background-color:#fdd">    return false;</span>
  }

<span style = "background-color:#fdd">  doubleValue = doubleprop-&gt;GetValue();
  return true;
}</span>

bool mitk::DataNode::GetStringProperty(const char *propertyKey,
                                       std::string &amp;string,
                                       const mitk::BaseRenderer *renderer) const
<span style = "background-color:#fdd">{
  mitk::StringProperty::Pointer stringProp = dynamic_cast&lt;mitk::StringProperty *&gt;(GetProperty(propertyKey, renderer));
  if (stringProp.IsNull())</span>
  {
<span style = "background-color:#fdd">    return false;
  }</span>
  else
  {
    // memcpy((void*)string, stringProp-&gt;GetValue(), strlen(stringProp-&gt;GetValue()) + 1 ); // looks dangerous
<span style = "background-color:#fdd">    string = stringProp-&gt;GetValue();
    return true;</span>
  }
<span style = "background-color:#fdd">}</span>

bool mitk::DataNode::GetColor(float rgb[3], const mitk::BaseRenderer *renderer, const char *propertyKey) const
<span style = "background-color:#fdd">{
  mitk::ColorProperty::Pointer colorprop = dynamic_cast&lt;mitk::ColorProperty *&gt;(GetProperty(propertyKey, renderer));
  if (colorprop.IsNull())
    return false;</span>

<span style = "background-color:#fdd">  memcpy(rgb, colorprop-&gt;GetColor().GetDataPointer(), 3 * sizeof(float));
  return true;
}</span>

bool mitk::DataNode::GetOpacity(float &amp;opacity, const mitk::BaseRenderer *renderer, const char *propertyKey) const
<span style = "background-color:#fdd">{
  mitk::FloatProperty::Pointer opacityprop = dynamic_cast&lt;mitk::FloatProperty *&gt;(GetProperty(propertyKey, renderer));
  if (opacityprop.IsNull())
    return false;</span>

<span style = "background-color:#fdd">  opacity = opacityprop-&gt;GetValue();
  return true;
}</span>

bool mitk::DataNode::GetLevelWindow(mitk::LevelWindow &amp;levelWindow,
                                    const mitk::BaseRenderer *renderer,
                                    const char *propertyKey) const
<span style = "background-color:#fdd">{
  mitk::LevelWindowProperty::Pointer levWinProp =</span>
    dynamic_cast&lt;mitk::LevelWindowProperty *&gt;(GetProperty(propertyKey, renderer));
<span style = "background-color:#fdd">  if (levWinProp.IsNull())
    return false;</span>

<span style = "background-color:#fdd">  levelWindow = levWinProp-&gt;GetLevelWindow();
  return true;
}</span>

void mitk::DataNode::SetColor(const mitk::Color &amp;color, const mitk::BaseRenderer *renderer, const char *propertyKey)
<span style = "background-color:#fdd">{
  mitk::ColorProperty::Pointer prop;
  prop = mitk::ColorProperty::New(color);
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, prop);
}</span>

void mitk::DataNode::SetColor(
  float red, float green, float blue, const mitk::BaseRenderer *renderer, const char *propertyKey)
<span style = "background-color:#fdd">{</span>
  float color[3];
<span style = "background-color:#fdd">  color[0] = red;
  color[1] = green;
  color[2] = blue;
  SetColor(color, renderer, propertyKey);
}</span>

void mitk::DataNode::SetColor(const float rgb[3], const mitk::BaseRenderer *renderer, const char *propertyKey)
<span style = "background-color:#fdd">{
  mitk::ColorProperty::Pointer prop;
  prop = mitk::ColorProperty::New(rgb);
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, prop);
}</span>

void mitk::DataNode::SetVisibility(bool visible, const mitk::BaseRenderer *renderer, const char *propertyKey)
<span style = "background-color:#fdd">{
  mitk::BoolProperty::Pointer prop;
  prop = mitk::BoolProperty::New(visible);
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, prop);
}</span>

void mitk::DataNode::SetOpacity(float opacity, const mitk::BaseRenderer *renderer, const char *propertyKey)
<span style = "background-color:#fdd">{
  mitk::FloatProperty::Pointer prop;
  prop = mitk::FloatProperty::New(opacity);
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, prop);
}</span>

void mitk::DataNode::SetLevelWindow(mitk::LevelWindow levelWindow,
                                    const mitk::BaseRenderer *renderer,
                                    const char *propertyKey)
<span style = "background-color:#fdd">{
  mitk::LevelWindowProperty::Pointer prop;
  prop = mitk::LevelWindowProperty::New(levelWindow);
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, prop);
}</span>

void mitk::DataNode::SetIntProperty(const char *propertyKey, int intValue, const mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, mitk::IntProperty::New(intValue));
}</span>
void mitk::DataNode::SetBoolProperty(const char *propertyKey,
                                     bool boolValue,
                                     const mitk::BaseRenderer *renderer /*=nullptr*/)
<span style = "background-color:#fdd">{
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, mitk::BoolProperty::New(boolValue));
}</span>

void mitk::DataNode::SetFloatProperty(const char *propertyKey,
                                      float floatValue,
                                      const mitk::BaseRenderer *renderer /*=nullptr*/)
<span style = "background-color:#fdd">{
  if (dynamic_cast&lt;DoubleProperty *&gt;(this-&gt;GetProperty(propertyKey, renderer)) != nullptr)</span>
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "Setting float property " &lt;&lt; propertyKey</span>
              &lt;&lt; " although a double property with the same name already exists";
  }
<span style = "background-color:#fdd">  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, mitk::FloatProperty::New(floatValue));
}</span>

void mitk::DataNode::SetDoubleProperty(const char *propertyKey, double doubleValue, const mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  if (dynamic_cast&lt;FloatProperty *&gt;(this-&gt;GetProperty(propertyKey, renderer)) != nullptr)</span>
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "Setting double property " &lt;&lt; propertyKey</span>
              &lt;&lt; " although a float property with the same name already exists";
  }
<span style = "background-color:#fdd">  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, mitk::DoubleProperty::New(doubleValue));
}</span>

void mitk::DataNode::SetStringProperty(const char *propertyKey,
                                       const char *stringValue,
                                       const mitk::BaseRenderer *renderer /*=nullptr*/)
<span style = "background-color:#fdd">{
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, mitk::StringProperty::New(stringValue));
}</span>

void mitk::DataNode::SetProperty(const char *propertyKey,
                                 BaseProperty *propertyValue,
                                 const mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  GetPropertyList(renderer)-&gt;SetProperty(propertyKey, propertyValue);
}</span>

void mitk::DataNode::ReplaceProperty(const char *propertyKey,
                                     BaseProperty *propertyValue,
                                     const mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  GetPropertyList(renderer)-&gt;ReplaceProperty(propertyKey, propertyValue);
}</span>

void mitk::DataNode::AddProperty(const char *propertyKey,
                                 BaseProperty *propertyValue,
                                 const mitk::BaseRenderer *renderer,
                                 bool overwrite)
<span style = "background-color:#fdd">{
  if ((overwrite) || (GetProperty(propertyKey, renderer) == nullptr))</span>
  {
<span style = "background-color:#fdd">    SetProperty(propertyKey, propertyValue, renderer);</span>
  }
<span style = "background-color:#fdd">}</span>

vtkLinearTransform *mitk::DataNode::GetVtkTransform(int t) const
<span style = "background-color:#fdd">{
  assert(m_Data.IsNotNull());</span>

<span style = "background-color:#fdd">  mitk::BaseGeometry *geometry = m_Data-&gt;GetGeometry(t);</span>

<span style = "background-color:#fdd">  if (geometry == nullptr)
    return nullptr;</span>

<span style = "background-color:#fdd">  return geometry-&gt;GetVtkTransform();
}</span>

itk::ModifiedTimeType mitk::DataNode::GetMTime() const
<span style = "background-color:#fdd">{
  auto time = Superclass::GetMTime();
  if (m_Data.IsNotNull())</span>
  {
<span style = "background-color:#fdd">    if ((time &lt; m_Data-&gt;GetMTime()) || ((m_Data-&gt;GetSource().IsNotNull()) &amp;&amp; (time &lt; m_Data-&gt;GetSource()-&gt;GetMTime())))</span>
    {
<span style = "background-color:#fdd">      Modified();
      return Superclass::GetMTime();</span>
    }
  }
<span style = "background-color:#fdd">  return time;
}</span>

void mitk::DataNode::SetSelected(bool selected, const mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  mitk::BoolProperty::Pointer selectedProperty = dynamic_cast&lt;mitk::BoolProperty *&gt;(GetProperty("selected"));</span>

<span style = "background-color:#fdd">  if (selectedProperty.IsNull())</span>
  {
<span style = "background-color:#fdd">    selectedProperty = mitk::BoolProperty::New();
    selectedProperty-&gt;SetValue(false);
    SetProperty("selected", selectedProperty, renderer);</span>
  }

<span style = "background-color:#fdd">  if (selectedProperty-&gt;GetValue() != selected)</span>
  {
<span style = "background-color:#fdd">    selectedProperty-&gt;SetValue(selected);
    itk::ModifiedEvent event;
    InvokeEvent(event);
  }
}</span>

/*
class SelectedEvent : public itk::ModifiedEvent
{
public:
  typedef SelectedEvent Self;
  typedef itk::ModifiedEvent Superclass;

  SelectedEvent(DataNode* dataNode)
    { m_DataNode = dataNode; };
  DataNode* GetDataNode()
    { return m_DataNode; };
  virtual const char * GetEventName() const
    { return "SelectedEvent"; }
  virtual bool CheckEvent(const ::itk::EventObject* e) const
    { return dynamic_cast&lt;const Self*&gt;(e); }
  virtual ::itk::EventObject* MakeObject() const
    { return new Self(m_DataNode); }
private:
  DataNode* m_DataNode;
  SelectedEvent(const Self&amp; event)
    { m_DataNode = event.m_DataNode; };
  void operator=(const Self&amp; event)
  { m_DataNode = event.m_DataNode; }
};
*/

bool mitk::DataNode::IsSelected(const mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{</span>
  bool selected;

<span style = "background-color:#fdd">  if (!GetBoolProperty("selected", selected, renderer))
    return false;</span>

<span style = "background-color:#fdd">  return selected;
}</span>

void mitk::DataNode::SetDataInteractor(const DataInteractor::Pointer interactor)
<span style = "background-color:#fdd">{
  if (m_DataInteractor == interactor)
    return;</span>

<span style = "background-color:#fdd">  m_DataInteractor = interactor;
  this-&gt;Modified();</span>

<span style = "background-color:#fdd">  InteractorChangedEvent changedEvent;
  this-&gt;InvokeEvent(changedEvent);
}</span>

mitk::DataInteractor::Pointer mitk::DataNode::GetDataInteractor() const
<span style = "background-color:#fdd">{
  return m_DataInteractor;
}</span>

void mitk::DataNode::PropertyListModified(const itk::Object * /*caller*/, const itk::EventObject &amp;)
<span style = "background-color:#fdd">{
  Modified();
}</span>

mitk::BaseProperty::ConstPointer mitk::DataNode::GetConstProperty(const std::string &amp;propertyKey, const std::string &amp;contextName, bool fallBackOnDefaultContext) const
<span style = "background-color:#fdd">{
  if (propertyKey.empty())
    return nullptr;</span>

<span style = "background-color:#fdd">  if (!contextName.empty())</span>
  {
<span style = "background-color:#fdd">    auto propertyListIter = m_MapOfPropertyLists.find(contextName);</span>

<span style = "background-color:#fdd">    if (m_MapOfPropertyLists.end() != propertyListIter)</span>
    {
<span style = "background-color:#fdd">      BaseProperty::ConstPointer property = propertyListIter-&gt;second-&gt;GetProperty(propertyKey);</span>

<span style = "background-color:#fdd">      if (property.IsNotNull())
        return property;
    }
  }</span>

<span style = "background-color:#fdd">  if (contextName.empty() || fallBackOnDefaultContext)</span>
  {
<span style = "background-color:#fdd">    BaseProperty::ConstPointer property = m_PropertyList-&gt;GetProperty(propertyKey);</span>

<span style = "background-color:#fdd">    if (property.IsNull() &amp;&amp; m_Data.IsNotNull())
      property = m_Data-&gt;GetProperty(propertyKey.c_str());</span>

<span style = "background-color:#fdd">    return property;</span>
  }

<span style = "background-color:#fdd">  return nullptr;
}</span>

mitk::BaseProperty * mitk::DataNode::GetNonConstProperty(const std::string &amp;propertyKey, const std::string &amp;contextName, bool fallBackOnDefaultContext)
<span style = "background-color:#fdd">{
  if (propertyKey.empty())
    return nullptr;</span>

<span style = "background-color:#fdd">  if (!contextName.empty())</span>
  {
<span style = "background-color:#fdd">    auto propertyListIter = m_MapOfPropertyLists.find(contextName);</span>

<span style = "background-color:#fdd">    if (m_MapOfPropertyLists.end() != propertyListIter)</span>
    {
<span style = "background-color:#fdd">      auto property = propertyListIter-&gt;second-&gt;GetProperty(propertyKey);</span>

<span style = "background-color:#fdd">      if (nullptr != property)
        return property;</span>
    }
<span style = "background-color:#fdd">  }</span>

<span style = "background-color:#fdd">  if (contextName.empty() || fallBackOnDefaultContext)</span>
  {
<span style = "background-color:#fdd">    auto property = m_PropertyList-&gt;GetProperty(propertyKey);</span>

<span style = "background-color:#fdd">    if (nullptr == property &amp;&amp; m_Data.IsNotNull())
      property = m_Data-&gt;GetProperty(propertyKey.c_str());</span>

<span style = "background-color:#fdd">    return property;</span>
  }

<span style = "background-color:#fdd">  return nullptr;
}</span>

void mitk::DataNode::SetProperty(const std::string &amp;propertyKey, BaseProperty *property, const std::string &amp;contextName, bool fallBackOnDefaultContext)
<span style = "background-color:#fdd">{
  if (propertyKey.empty())
    mitkThrow() &lt;&lt; "Property key is empty.";</span>

<span style = "background-color:#fdd">  if (!contextName.empty())</span>
  {
<span style = "background-color:#fdd">    auto propertyListIter = m_MapOfPropertyLists.find(contextName);</span>

<span style = "background-color:#fdd">    if (m_MapOfPropertyLists.end() != propertyListIter)</span>
    {
<span style = "background-color:#fdd">      propertyListIter-&gt;second-&gt;SetProperty(propertyKey, property);
      return;</span>
    }
<span style = "background-color:#fdd">  }</span>

<span style = "background-color:#fdd">  if (contextName.empty() || fallBackOnDefaultContext)</span>
  {
<span style = "background-color:#fdd">    m_PropertyList-&gt;SetProperty(propertyKey, property);
    return;</span>
  }

<span style = "background-color:#fdd">  mitkThrow() &lt;&lt; "Unknown property context.";
}</span>

void mitk::DataNode::RemoveProperty(const std::string &amp;propertyKey, const std::string &amp;contextName, bool fallBackOnDefaultContext)
<span style = "background-color:#fdd">{
  if (propertyKey.empty())
    mitkThrow() &lt;&lt; "Property key is empty.";</span>

<span style = "background-color:#fdd">  if (!contextName.empty())</span>
  {
<span style = "background-color:#fdd">    auto propertyListIter = m_MapOfPropertyLists.find(contextName);</span>

<span style = "background-color:#fdd">    if (m_MapOfPropertyLists.end() != propertyListIter)</span>
    {
<span style = "background-color:#fdd">      propertyListIter-&gt;second-&gt;RemoveProperty(propertyKey);
      return;</span>
    }
<span style = "background-color:#fdd">  }</span>

<span style = "background-color:#fdd">  if (contextName.empty() || fallBackOnDefaultContext)</span>
  {
<span style = "background-color:#fdd">    m_PropertyList-&gt;RemoveProperty(propertyKey);
    return;</span>
  }

<span style = "background-color:#fdd">  mitkThrow() &lt;&lt; "Unknown property context.";
}</span>

std::vector&lt;std::string&gt; mitk::DataNode::GetPropertyKeys(const std::string &amp;contextName, bool includeDefaultContext) const
<span style = "background-color:#fdd">{
  std::vector&lt;std::string&gt; propertyKeys;</span>

<span style = "background-color:#fdd">  if (contextName.empty())</span>
  {
<span style = "background-color:#fdd">    for (const auto &amp;property : *m_PropertyList-&gt;GetMap())
      propertyKeys.push_back(property.first);</span>

<span style = "background-color:#fdd">    return propertyKeys;</span>
  }

<span style = "background-color:#fdd">  auto propertyListIter = m_MapOfPropertyLists.find(contextName);</span>

<span style = "background-color:#fdd">  if (m_MapOfPropertyLists.end() != propertyListIter)</span>
  {
<span style = "background-color:#fdd">    for (const auto &amp;property : *propertyListIter-&gt;second-&gt;GetMap())
      propertyKeys.push_back(property.first);</span>
  }

<span style = "background-color:#fdd">  if (includeDefaultContext)</span>
  {
<span style = "background-color:#fdd">    for (const auto &amp;property : *m_PropertyList-&gt;GetMap())</span>
    {
<span style = "background-color:#fdd">      auto propertyKeyIter = std::find(propertyKeys.begin(), propertyKeys.end(), property.first);</span>

<span style = "background-color:#fdd">      if (propertyKeys.end() == propertyKeyIter)
        propertyKeys.push_back(property.first);
    }</span>
  }

<span style = "background-color:#fdd">  return propertyKeys;
}</span>

std::vector&lt;std::string&gt; mitk::DataNode::GetPropertyContextNames() const
<span style = "background-color:#fdd">{
  return this-&gt;GetPropertyListNames();
}</span></pre>
	</body>
</html>