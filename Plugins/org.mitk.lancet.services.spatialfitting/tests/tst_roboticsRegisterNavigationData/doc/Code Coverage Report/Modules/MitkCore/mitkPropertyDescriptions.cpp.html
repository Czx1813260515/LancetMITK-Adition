<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkPropertyDescriptions.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkPropertyDescriptions.h"
#include &lt;algorithm&gt;
#include &lt;regex&gt;
#include &lt;utility&gt;

mitk::PropertyDescriptions::PropertyDescriptions()
<span style = "background-color:#dfd">{
}</span>

mitk::PropertyDescriptions::~PropertyDescriptions()
<span style = "background-color:#dfd">{
}</span>

bool mitk::PropertyDescriptions::AddDescription(const std::string &amp;propertyName,
                                                const std::string &amp;description,
                                                const std::string &amp;className,
                                                bool overwrite)
<span style = "background-color:#dfd">{
  if (propertyName.empty())</span>
<span style = "background-color:#fdd">    return false;</span>

<span style = "background-color:#dfd">  DescriptionMap &amp;descriptions = m_Descriptions[className];
  std::pair&lt;DescriptionMapIterator, bool&gt; ret = descriptions.insert(std::make_pair(propertyName, description));</span>

<span style = "background-color:#dfd">  if (!ret.second &amp;&amp; overwrite)</span>
  {
<span style = "background-color:#fdd">    ret.first-&gt;second = description;
    ret.second = true;</span>
  }

<span style = "background-color:#dfd">  return ret.second;
}</span>

bool mitk::PropertyDescriptions::AddDescriptionRegEx(const std::string &amp;propertyRegEx,
                                                     const std::string &amp;description,
                                                     const std::string &amp;className,
                                                     bool overwrite)
<span style = "background-color:#dfd">{
  if (propertyRegEx.empty())</span>
<span style = "background-color:#fdd">    return false;</span>

  try
  {
<span style = "background-color:#dfd">    std::regex checker(propertyRegEx); // no exception =&gt; valid we can change the info
  }</span>
  catch (const std::regex_error &amp;)
<span style = "background-color:#fdd">  {
    return false;
  }</span>

<span style = "background-color:#dfd">  DescriptionMap &amp;descriptions = m_DescriptionsRegEx[className];
  std::pair&lt;DescriptionMapIterator, bool&gt; ret = descriptions.insert(std::make_pair(propertyRegEx, description));</span>

<span style = "background-color:#dfd">  if (!ret.second &amp;&amp; overwrite)</span>
  {
<span style = "background-color:#fdd">    ret.first-&gt;second = description;
    ret.second = true;</span>
  }

<span style = "background-color:#dfd">  return ret.second;
}</span>

std::string mitk::PropertyDescriptions::GetDescription(const std::string &amp;propertyName,
                                                       const std::string &amp;className,
                                                       bool allowNameRegEx) const
<span style = "background-color:#fdd">{
  if (!propertyName.empty())</span>
  {
<span style = "background-color:#fdd">    auto descriptionsIter = m_Descriptions.find(className);</span>

<span style = "background-color:#fdd">    if (descriptionsIter != m_Descriptions.cend())</span>
    {
<span style = "background-color:#fdd">      auto iter = descriptionsIter-&gt;second.find(propertyName);</span>

<span style = "background-color:#fdd">      if (iter != descriptionsIter-&gt;second.end())
        return iter-&gt;second;
    }
  }</span>

<span style = "background-color:#fdd">  if (allowNameRegEx &amp;&amp; !propertyName.empty())</span>
  {
<span style = "background-color:#fdd">    auto selector = [propertyName](const DescriptionMap::value_type &amp;x) {
      std::regex ex(x.first);
      return std::regex_match(propertyName, ex);
    };</span>

<span style = "background-color:#fdd">    auto descriptionsIter = m_DescriptionsRegEx.find(className);</span>

<span style = "background-color:#fdd">    if (descriptionsIter != m_DescriptionsRegEx.cend())</span>
    {
<span style = "background-color:#fdd">      auto finding = std::find_if(descriptionsIter-&gt;second.cbegin(), descriptionsIter-&gt;second.cend(), selector);</span>

<span style = "background-color:#fdd">      if (finding != descriptionsIter-&gt;second.cend())
        return finding-&gt;second;
    }
  }</span>

<span style = "background-color:#fdd">  return "";
}</span>

bool mitk::PropertyDescriptions::HasDescription(const std::string &amp;propertyName,
                                                const std::string &amp;className,
                                                bool allowNameRegEx) const
<span style = "background-color:#fdd">{
  if (!propertyName.empty())</span>
  {
<span style = "background-color:#fdd">    auto descriptionsIter = m_Descriptions.find(className);</span>

<span style = "background-color:#fdd">    if (descriptionsIter != m_Descriptions.cend())</span>
    {
<span style = "background-color:#fdd">      auto iter = descriptionsIter-&gt;second.find(propertyName);</span>

<span style = "background-color:#fdd">      if (iter != descriptionsIter-&gt;second.end())
        return true;
    }
  }</span>

<span style = "background-color:#fdd">  if (allowNameRegEx &amp;&amp; !propertyName.empty())</span>
  {
<span style = "background-color:#fdd">    auto selector = [propertyName](const DescriptionMap::value_type &amp;x) {
      std::regex ex(x.first);
      return std::regex_match(propertyName, ex);
    };</span>

<span style = "background-color:#fdd">    auto descriptionsIter = m_DescriptionsRegEx.find(className);</span>

<span style = "background-color:#fdd">    if (descriptionsIter != m_DescriptionsRegEx.cend())</span>
    {
<span style = "background-color:#fdd">      auto finding = std::find_if(descriptionsIter-&gt;second.cbegin(), descriptionsIter-&gt;second.cend(), selector);</span>

<span style = "background-color:#fdd">      if (finding != descriptionsIter-&gt;second.cend())
        return true;
    }
  }</span>

<span style = "background-color:#fdd">  return false;
}</span>

void mitk::PropertyDescriptions::RemoveAllDescriptions(const std::string &amp;className)
<span style = "background-color:#fdd">{
  m_Descriptions[className].clear();
  m_DescriptionsRegEx[className].clear();
}</span>

void mitk::PropertyDescriptions::RemoveDescription(const std::string &amp;propertyName, const std::string &amp;className)
<span style = "background-color:#fdd">{
  if (!propertyName.empty())</span>
  {
<span style = "background-color:#fdd">    m_Descriptions[className].erase(propertyName);
    m_DescriptionsRegEx[className].erase(propertyName);</span>
  }
<span style = "background-color:#fdd">}</span></pre>
	</body>
</html>