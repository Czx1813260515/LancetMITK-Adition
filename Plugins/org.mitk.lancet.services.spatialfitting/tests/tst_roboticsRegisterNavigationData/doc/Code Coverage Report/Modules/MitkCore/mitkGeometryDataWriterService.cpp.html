<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkGeometryDataWriterService.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkGeometryDataWriterService.h"
#include "mitkIOMimeTypes.h"

#include "mitkProportionalTimeGeometryToXML.h"

#include &lt;tinyxml2.h&gt;

#include &lt;mitkLocaleSwitch.h&gt;

mitk::GeometryDataWriterService::GeometryDataWriterService()
<span style = "background-color:#dfd">  : AbstractFileWriter(</span>
      GeometryData::GetStaticNameOfClass(), IOMimeTypes::GEOMETRY_DATA_MIMETYPE(), "MITK Geometry Data Writer")
<span style = "background-color:#dfd">{
  RegisterService();
}</span>

mitk::GeometryDataWriterService::GeometryDataWriterService(const mitk::GeometryDataWriterService &amp;other)
<span style = "background-color:#fdd">  : AbstractFileWriter(other)
{
}</span>

mitk::GeometryDataWriterService::~GeometryDataWriterService()
<span style = "background-color:#dfd">{
}</span>

void mitk::GeometryDataWriterService::Write()
<span style = "background-color:#fdd">{</span>
  /* using the stream interface produces files without line breaks or indentation..
     But before changing to file interface, need to understand the new I/O classes */
<span style = "background-color:#fdd">  OutputStream out(this);</span>

<span style = "background-color:#fdd">  if (!out.good())</span>
  {
<span style = "background-color:#fdd">    mitkThrow() &lt;&lt; "Stream not good.";</span>
  }

  // Switch the current locale to "C"
<span style = "background-color:#fdd">  LocaleSwitch localeSwitch("C");</span>

  // Open XML file using TinyXML,
  // loop over all inputs,
  //   call appropriate serializing functions

<span style = "background-color:#fdd">  tinyxml2::XMLDocument doc;
  doc.InsertEndChild(doc.NewDeclaration());</span>

<span style = "background-color:#fdd">  auto* rootNode = doc.NewElement("GeometryData");
  doc.InsertEndChild(rootNode);</span>

  // note version info
<span style = "background-color:#fdd">  auto *version = doc.NewElement("Version");
  version-&gt;SetAttribute("Writer", __FILE__);
  version-&gt;SetAttribute("FileVersion", 1);
  rootNode-&gt;InsertEndChild(version);</span>

<span style = "background-color:#fdd">  const auto *data = static_cast&lt;const GeometryData *&gt;(this-&gt;GetInput());</span>

<span style = "background-color:#fdd">  const ProportionalTimeGeometry *timeGeometry(nullptr);
  if ((timeGeometry = dynamic_cast&lt;const ProportionalTimeGeometry *&gt;(data-&gt;GetTimeGeometry())))</span>
  {
<span style = "background-color:#fdd">    auto *timeGeometryElement = ProportionalTimeGeometryToXML::ToXML(doc, timeGeometry);
    rootNode-&gt;InsertEndChild(timeGeometryElement);
  }</span>
  else
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "Serializing GeometryData that does not have a valid ProportionalTimeGeometry! Not implemented!";</span>
  }

  // Write out document
<span style = "background-color:#fdd">  tinyxml2::XMLPrinter printer;
  doc.Print(&amp;printer);
  out &lt;&lt; printer.CStr();
}</span>

mitk::GeometryDataWriterService *mitk::GeometryDataWriterService::Clone() const
<span style = "background-color:#fdd">{
  return new GeometryDataWriterService(*this);
}</span></pre>
	</body>
</html>