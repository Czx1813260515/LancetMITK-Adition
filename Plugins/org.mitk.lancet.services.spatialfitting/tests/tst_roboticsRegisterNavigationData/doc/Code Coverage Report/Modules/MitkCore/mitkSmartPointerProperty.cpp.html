<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkSmartPointerProperty.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkSmartPointerProperty.h"

<span style = "background-color:#dfd">mitk::SmartPointerProperty::ReferenceCountMapType mitk::SmartPointerProperty::m_ReferenceCount;
mitk::SmartPointerProperty::ReferencesUIDMapType mitk::SmartPointerProperty::m_ReferencesUID;
mitk::SmartPointerProperty::ReadInSmartPointersMapType mitk::SmartPointerProperty::m_ReadInInstances;
mitk::SmartPointerProperty::ReadInTargetsMapType mitk::SmartPointerProperty::m_ReadInTargets;
mitk::UIDGenerator mitk::SmartPointerProperty::m_UIDGenerator("POINTER_");</span>

void mitk::SmartPointerProperty::PostProcessXMLReading()
<span style = "background-color:#fdd">{
  for (auto iter = m_ReadInInstances.begin(); iter != m_ReadInInstances.end(); ++iter)</span>
  {
<span style = "background-color:#fdd">    if (m_ReadInTargets.find(iter-&gt;second) != m_ReadInTargets.end())</span>
    {
<span style = "background-color:#fdd">      iter-&gt;first-&gt;SetSmartPointer(m_ReadInTargets[iter-&gt;second]);
    }
  }</span>

<span style = "background-color:#fdd">  m_ReadInInstances.clear();
}</span>

/// \return The number of SmartPointerProperties that point to @param object
unsigned int mitk::SmartPointerProperty::GetReferenceCountFor(itk::Object *object)
<span style = "background-color:#fdd">{
  if (m_ReferenceCount.find(object) != m_ReferenceCount.end())</span>
  {
<span style = "background-color:#fdd">    return m_ReferenceCount[object];
  }</span>
  else
  {
<span style = "background-color:#fdd">    return 0;</span>
  }
<span style = "background-color:#fdd">}</span>

void mitk::SmartPointerProperty::RegisterPointerTarget(itk::Object *object, const std::string uid)
<span style = "background-color:#fdd">{
  m_ReadInTargets[uid] = object;
}</span>

std::string mitk::SmartPointerProperty::GetReferenceUIDFor(itk::Object *object)
<span style = "background-color:#fdd">{
  if (m_ReferencesUID.find(object) != m_ReferencesUID.end())</span>
  {
<span style = "background-color:#fdd">    return m_ReferencesUID[object];
  }</span>
  else
  {
<span style = "background-color:#fdd">    return std::string("invalid");</span>
  }
<span style = "background-color:#fdd">}</span>

bool mitk::SmartPointerProperty::IsEqual(const BaseProperty &amp;property) const
<span style = "background-color:#fdd">{
  return this-&gt;m_SmartPointer == static_cast&lt;const Self &amp;&gt;(property).m_SmartPointer;
}</span>

bool mitk::SmartPointerProperty::Assign(const BaseProperty &amp;property)
<span style = "background-color:#fdd">{
  this-&gt;m_SmartPointer = static_cast&lt;const Self &amp;&gt;(property).m_SmartPointer;
  return true;
}</span>

mitk::SmartPointerProperty::SmartPointerProperty(itk::Object *pointer)
<span style = "background-color:#fdd">{
  SetSmartPointer(pointer);
}</span>

mitk::SmartPointerProperty::SmartPointerProperty(const SmartPointerProperty &amp;other)
<span style = "background-color:#fdd">  : BaseProperty(other), m_SmartPointer(other.m_SmartPointer)
{
}</span>

itk::Object::Pointer mitk::SmartPointerProperty::GetSmartPointer() const
<span style = "background-color:#fdd">{
  return m_SmartPointer;
}</span>

itk::Object::Pointer mitk::SmartPointerProperty::GetValue() const
<span style = "background-color:#fdd">{
  return this-&gt;GetSmartPointer();
}</span>

void mitk::SmartPointerProperty::SetSmartPointer(itk::Object *pointer)
<span style = "background-color:#fdd">{
  if (m_SmartPointer.GetPointer() != pointer)</span>
  {
    // keep track of referenced objects
<span style = "background-color:#fdd">    if (m_SmartPointer.GetPointer() &amp;&amp;</span>
        --m_ReferenceCount[m_SmartPointer.GetPointer()] == 0) // if there is no reference left, delete entry
    {
<span style = "background-color:#fdd">      m_ReferenceCount.erase(m_SmartPointer.GetPointer());
      m_ReferencesUID.erase(m_SmartPointer.GetPointer());</span>
    }

<span style = "background-color:#fdd">    if (pointer &amp;&amp; ++m_ReferenceCount[pointer] == 1) // first reference --&gt; generate UID</span>
    {
<span style = "background-color:#fdd">      m_ReferencesUID[pointer] = m_UIDGenerator.GetUID();</span>
    }

    // change pointer
<span style = "background-color:#fdd">    m_SmartPointer = pointer;
    Modified();</span>
  }
<span style = "background-color:#fdd">}</span>

void mitk::SmartPointerProperty::SetValue(const ValueType &amp;value)
<span style = "background-color:#fdd">{
  this-&gt;SetSmartPointer(value.GetPointer());
}</span>

std::string mitk::SmartPointerProperty::GetValueAsString() const
<span style = "background-color:#fdd">{
  if (m_SmartPointer.IsNotNull())
    return m_ReferencesUID[m_SmartPointer.GetPointer()];</span>
  else
<span style = "background-color:#fdd">    return std::string("nullptr");
}</span>

itk::LightObject::Pointer mitk::SmartPointerProperty::InternalClone() const
<span style = "background-color:#fdd">{
  itk::LightObject::Pointer result(new Self(*this));
  result-&gt;UnRegister();
  return result;
}</span></pre>
	</body>
</html>