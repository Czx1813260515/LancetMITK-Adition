<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkScalarListLookupTablePropertySerializer.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkScalarListLookupTableProperty.h"
#include "mitkScalarListLookupTablePropertySerializer.h"
#include &lt;tinyxml2.h&gt;

tinyxml2::XMLElement* mitk::ScalarListLookupTablePropertySerializer::Serialize(tinyxml2::XMLDocument&amp; doc)
<span style = "background-color:#fdd">{
  const ScalarListLookupTableProperty* prop =</span>
    dynamic_cast&lt;const ScalarListLookupTableProperty*&gt;(m_Property.GetPointer());

<span style = "background-color:#fdd">  if (prop == nullptr)</span>
  {
<span style = "background-color:#fdd">    MITK_ERROR &lt;&lt; "Serialization: Property is NULL";
    return nullptr;</span>
  }

<span style = "background-color:#fdd">  ScalarListLookupTable lut = prop-&gt;GetValue();
  const ScalarListLookupTable::LookupTableType&amp; map = lut.GetLookupTable();</span>

<span style = "background-color:#fdd">  auto* mapElement = doc.NewElement("ScalarListLookupTable");</span>

<span style = "background-color:#fdd">  for (ScalarListLookupTable::LookupTableType::const_iterator mapIter = map.begin();
     mapIter != map.end(); ++mapIter)</span>
  {
<span style = "background-color:#fdd">    const ScalarListLookupTable::ValueType&amp; list = mapIter-&gt;second;
    auto* listElement = doc.NewElement("List");
    listElement-&gt;SetAttribute("name", mapIter-&gt;first.c_str());</span>

<span style = "background-color:#fdd">    for (ScalarListLookupTable::ValueType::const_iterator listIter =  list.begin();
       listIter != list.end(); ++listIter)</span>
    {
<span style = "background-color:#fdd">      auto* valueElement = doc.NewElement("Element");
      valueElement-&gt;SetAttribute("value", *listIter);
      listElement-&gt;InsertEndChild(valueElement);
    }</span>

<span style = "background-color:#fdd">    mapElement-&gt;InsertEndChild(listElement);
  }</span>

<span style = "background-color:#fdd">  return mapElement;
}</span>

mitk::BaseProperty::Pointer
mitk::ScalarListLookupTablePropertySerializer::Deserialize(const tinyxml2::XMLElement* element)
<span style = "background-color:#fdd">{
  if (!element)</span>
  {
<span style = "background-color:#fdd">    MITK_ERROR &lt;&lt; "Deserialization: Element is NULL";
    return nullptr;</span>
  }

<span style = "background-color:#fdd">  ScalarListLookupTable lut;</span>

<span style = "background-color:#fdd">  for (auto* listElement = element-&gt;FirstChildElement("List");
     listElement != nullptr; listElement = listElement-&gt;NextSiblingElement("List"))</span>
  {
<span style = "background-color:#fdd">    std::string name;</span>

<span style = "background-color:#fdd">    if (listElement-&gt;Attribute("name") != nullptr)</span>
    {
<span style = "background-color:#fdd">      name = listElement-&gt;Attribute("name");
    }</span>
    else
    {
<span style = "background-color:#fdd">      MITK_ERROR &lt;&lt; "Deserialization: No element with attribute 'name' found";
      return nullptr;</span>
    }

<span style = "background-color:#fdd">    ScalarListLookupTable::ValueType list;</span>

<span style = "background-color:#fdd">    for (auto* valueElement = listElement-&gt;FirstChildElement("Element");
       valueElement != nullptr;
       valueElement = valueElement-&gt;NextSiblingElement("Element"))</span>
    {
      double value;

<span style = "background-color:#fdd">      if (valueElement-&gt;QueryDoubleAttribute("value", &amp;value) != tinyxml2::XML_SUCCESS)</span>
      {
<span style = "background-color:#fdd">        MITK_ERROR &lt;&lt; "Deserialization: No element with attribute 'value' found";
        return nullptr;</span>
      }

<span style = "background-color:#fdd">      list.push_back(value);
    }</span>

<span style = "background-color:#fdd">    lut.SetTableValue(name, list);
  }</span>

<span style = "background-color:#fdd">  return ScalarListLookupTableProperty::New(lut).GetPointer();
}</span>

<span style = "background-color:#dfd">MITK_REGISTER_SERIALIZER(ScalarListLookupTablePropertySerializer);</span>

::std::string mitk::PropertyPersistenceSerialization::serializeScalarListLookupTablePropertyToXML(
  const mitk::BaseProperty *prop)
<span style = "background-color:#fdd">{
  mitk::ScalarListLookupTablePropertySerializer::Pointer lutSerializer = mitk::ScalarListLookupTablePropertySerializer::New();</span>

<span style = "background-color:#fdd">  lutSerializer-&gt;SetProperty(prop);</span>

<span style = "background-color:#fdd">  tinyxml2::XMLDocument doc;
  lutSerializer-&gt;Serialize(doc);</span>

<span style = "background-color:#fdd">  tinyxml2::XMLPrinter printer;
  doc.Print(&amp;printer);</span>

<span style = "background-color:#fdd">  return printer.CStr();
}</span>

mitk::BaseProperty::Pointer mitk::PropertyPersistenceDeserialization::deserializeXMLToScalarListLookupTableProperty(
  const std::string &amp;value)
<span style = "background-color:#fdd">{
  if (value.empty())</span>
  {
<span style = "background-color:#fdd">    return mitk::ScalarListLookupTableProperty::New().GetPointer();</span>
  }

<span style = "background-color:#fdd">  mitk::ScalarListLookupTablePropertySerializer::Pointer lutSerializer = mitk::ScalarListLookupTablePropertySerializer::New();</span>

<span style = "background-color:#fdd">  tinyxml2::XMLDocument doc;
  doc.Parse(value.c_str());
  return lutSerializer-&gt;Deserialize(doc.RootElement());
}</span></pre>
	</body>
</html>