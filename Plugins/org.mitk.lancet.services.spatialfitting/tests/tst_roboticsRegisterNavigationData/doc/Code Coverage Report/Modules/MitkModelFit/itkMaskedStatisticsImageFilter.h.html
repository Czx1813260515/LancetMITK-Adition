<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>itkMaskedStatisticsImageFilter.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*=========================================================================
*
*  Copyright Insight Software Consortium
*
*  Licensed under the Apache License, Version 2.0 (the "License");
*  you may not use this file except in compliance with the License.
*  You may obtain a copy of the License at
*
*         http://www.apache.org/licenses/LICENSE-2.0.txt
*
*  Unless required by applicable law or agreed to in writing, software
*  distributed under the License is distributed on an "AS IS" BASIS,
*  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
*  See the License for the specific language governing permissions and
*  limitations under the License.
*
*=========================================================================*/
#ifndef __itkMaskedStatisticsImageFilter_h
#define __itkMaskedStatisticsImageFilter_h

#include "itkImageToImageFilter.h"
#include "itkNumericTraits.h"
#include "itkArray.h"
#include "itkSimpleDataObjectDecorator.h"

namespace itk
{
  /** \class MaskedStatisticsImageFilter
  * \brief Compute min. max, variance and mean of an (masked) Image.
  *
  * MaskedStatisticsImageFilter computes the minimum, maximum, sum, mean, variance
  * sigma of an image.  The filter needs all of its input image.  It
  * behaves as a filter with an input and output. Thus it can be inserted
  * in a pipeline with other filters and the statistics will only be
  * recomputed if a downstream filter changes.
  *
  * The filter passes its input through unmodified.  The filter is
  * threaded. It computes statistics in each thread then combines them in
  * its AfterThreadedGenerate method.
  * \remark This filter differs from itk::StatisticsImageFilter by the fact that you can
  * specify an mask image. If set, only pixels within the mask (mask value &gt; 0) are taken
  * into account for the statistics.
  *
  * \ingroup MathematicalStatisticsImageFilters
  * \ingroup ITKImageStatistics
  *
  */
  template&lt; typename TInputImage , typename TMaskImage = ::itk::Image&lt;unsigned char, TInputImage::ImageDimension&gt; &gt;
  class MaskedStatisticsImageFilter:
    public ImageToImageFilter&lt; TInputImage, TInputImage &gt;
  {
  public:
    /** Standard Self typedef */
    typedef MaskedStatisticsImageFilter                          Self;
    typedef ImageToImageFilter&lt; TInputImage, TInputImage &gt; Superclass;
    typedef SmartPointer&lt; Self &gt;                           Pointer;
    typedef SmartPointer&lt; const Self &gt;                     ConstPointer;

    /** Method for creation through the object factory. */
<span style = "background-color:#fdd">    itkNewMacro(Self);</span>

    /** Runtime information support. */
<span style = "background-color:#fdd">    itkTypeMacro(MaskedStatisticsImageFilter, ImageToImageFilter);</span>

    /** Image related typedefs. */
    typedef typename Superclass::InputImageType InputImageType;
    typedef typename Superclass::InputImagePointer InputImagePointer;

    typedef typename TInputImage::RegionType RegionType;
    typedef typename TInputImage::SizeType   SizeType;
    typedef typename TInputImage::IndexType  IndexType;
    typedef typename TInputImage::PixelType  PixelType;

    /** Image related typedefs. */
    itkStaticConstMacro(ImageDimension, unsigned int,
      TInputImage::ImageDimension);

    /** Type to use for computations. */
    typedef typename NumericTraits&lt; PixelType &gt;::RealType RealType;

    /** Smart Pointer type to a DataObject. */
    typedef typename DataObject::Pointer DataObjectPointer;

    /** Type of DataObjects used for scalar outputs */
    typedef SimpleDataObjectDecorator&lt; RealType &gt;  RealObjectType;
    typedef SimpleDataObjectDecorator&lt; PixelType &gt; PixelObjectType;

    typedef TMaskImage MaskImageType;
    typedef typename MaskImageType::ConstPointer     MaskImageConstPointer;
    typedef typename MaskImageType::RegionType  MaskImageRegionType;

    /** Return the computed Minimum. */
    PixelType GetMinimum() const
<span style = "background-color:#fdd">    { return this-&gt;GetMinimumOutput()-&gt;Get(); }</span>
    PixelObjectType * GetMinimumOutput();

    const PixelObjectType * GetMinimumOutput() const;

    /** Return the computed Maximum. */
    PixelType GetMaximum() const
<span style = "background-color:#fdd">    { return this-&gt;GetMaximumOutput()-&gt;Get(); }</span>
    PixelObjectType * GetMaximumOutput();

    const PixelObjectType * GetMaximumOutput() const;

    /** Return the computed Mean. */
    RealType GetMean() const
<span style = "background-color:#fdd">    { return this-&gt;GetMeanOutput()-&gt;Get(); }</span>
    RealObjectType * GetMeanOutput();

    const RealObjectType * GetMeanOutput() const;

    /** Return the computed Standard Deviation. */
    RealType GetSigma() const
<span style = "background-color:#fdd">    { return this-&gt;GetSigmaOutput()-&gt;Get(); }</span>
    RealObjectType * GetSigmaOutput();

    const RealObjectType * GetSigmaOutput() const;

    /** Return the computed Variance. */
    RealType GetVariance() const
<span style = "background-color:#fdd">    { return this-&gt;GetVarianceOutput()-&gt;Get(); }</span>
    RealObjectType * GetVarianceOutput();

    const RealObjectType * GetVarianceOutput() const;

    /** Return the compute Sum. */
    RealType GetSum() const
<span style = "background-color:#fdd">    { return this-&gt;GetSumOutput()-&gt;Get(); }</span>
    RealObjectType * GetSumOutput();

    const RealObjectType * GetSumOutput() const;

    /** Make a DataObject of the correct type to be used as the specified
    * output. */
    typedef ProcessObject::DataObjectPointerArraySizeType DataObjectPointerArraySizeType;
    using Superclass::MakeOutput;
    DataObjectPointer MakeOutput(DataObjectPointerArraySizeType idx) override;

<span style = "background-color:#fdd">    itkSetConstObjectMacro(Mask, MaskImageType);
    itkGetConstObjectMacro(Mask, MaskImageType);</span>

#ifdef ITK_USE_CONCEPT_CHECKING
    // Begin concept checking
    itkConceptMacro( InputHasNumericTraitsCheck,
      ( Concept::HasNumericTraits&lt; PixelType &gt; ) );
    // End concept checking
#endif

  protected:
    MaskedStatisticsImageFilter();
<span style = "background-color:#fdd">    ~MaskedStatisticsImageFilter() override{}</span>
    void PrintSelf(std::ostream &amp; os, Indent indent) const override;

    /** Pass the input through unmodified. Do this by Grafting in the
    *  AllocateOutputs method.
    */
    void AllocateOutputs() override;

    /** Initialize some accumulators before the threads run. */
    void BeforeThreadedGenerateData() override;

    /** Do final mean and variance computation from data accumulated in threads.
    */
    void AfterThreadedGenerateData() override;

    /** Multi-thread version GenerateData. */
    void  ThreadedGenerateData(const RegionType &amp;
      outputRegionForThread,
      ThreadIdType threadId) override;

    // Override since the filter needs all the data for the algorithm
    void GenerateInputRequestedRegion() override;

    // Override since the filter produces all of its output
    void EnlargeOutputRequestedRegion(DataObject *data) override;

  private:
    MaskedStatisticsImageFilter(const Self &amp;); //purposely not implemented
    void operator=(const Self &amp;);        //purposely not implemented

    Array&lt; RealType &gt;       m_ThreadSum;
    Array&lt; RealType &gt;       m_SumOfSquares;
    Array&lt; SizeValueType &gt;  m_Count;
    Array&lt; PixelType &gt;      m_ThreadMin;
    Array&lt; PixelType &gt;      m_ThreadMax;
    MaskImageConstPointer        m_Mask;
  }; // end of class
} // end namespace itk

#ifndef ITK_MANUAL_INSTANTIATION
#include "itkMaskedStatisticsImageFilter.hxx"
#endif

#endif</pre>
	</body>
</html>