<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkPropertyListDeserializer.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkPropertyListDeserializer.h"

#include &lt;tinyxml2.h&gt;

mitk::PropertyListDeserializer::PropertyListDeserializer()
<span style = "background-color:#fdd">{
}</span>

mitk::PropertyListDeserializer::~PropertyListDeserializer()
<span style = "background-color:#fdd">{
}</span>

bool mitk::PropertyListDeserializer::Deserialize()
<span style = "background-color:#fdd">{
  bool error(false);</span>

<span style = "background-color:#fdd">  tinyxml2::XMLDocument document;
  if (tinyxml2::XML_SUCCESS != document.LoadFile(m_Filename.c_str()))</span>
  {
<span style = "background-color:#fdd">    MITK_ERROR &lt;&lt; "Could not open/read/parse " &lt;&lt; m_Filename &lt;&lt; "\nTinyXML reports: " &lt;&lt; document.ErrorStr()</span>
               &lt;&lt; std::endl;
<span style = "background-color:#fdd">    return false;</span>
  }

  // find version node --&gt; note version in some variable
<span style = "background-color:#fdd">  int fileVersion = 1;
  auto *versionObject = document.FirstChildElement("Version");
  if (versionObject)</span>
  {
<span style = "background-color:#fdd">    if (versionObject-&gt;QueryIntAttribute("FileVersion", &amp;fileVersion) != tinyxml2::XML_SUCCESS)</span>
    {
<span style = "background-color:#fdd">      MITK_ERROR &lt;&lt; "Property file " &lt;&lt; m_Filename &lt;&lt; " does not contain version information! Trying version 1 format."</span>
                 &lt;&lt; std::endl;
    }
  }

<span style = "background-color:#fdd">  std::stringstream propertyListDeserializerClassName;
  propertyListDeserializerClassName &lt;&lt; "PropertyListDeserializerV" &lt;&lt; fileVersion;</span>

<span style = "background-color:#fdd">  std::list&lt;itk::LightObject::Pointer&gt; readers =</span>
    itk::ObjectFactoryBase::CreateAllInstance(propertyListDeserializerClassName.str().c_str());
<span style = "background-color:#fdd">  if (readers.size() &lt; 1)</span>
  {
<span style = "background-color:#fdd">    MITK_ERROR &lt;&lt; "No property list reader found for file version " &lt;&lt; fileVersion;</span>
  }
<span style = "background-color:#fdd">  if (readers.size() &gt; 1)</span>
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "Multiple property list readers found for file version " &lt;&lt; fileVersion</span>
              &lt;&lt; ". Using arbitrary first one.";
  }

<span style = "background-color:#fdd">  for (auto iter = readers.begin(); iter != readers.end(); ++iter)</span>
  {
<span style = "background-color:#fdd">    if (auto *reader = dynamic_cast&lt;PropertyListDeserializer *&gt;(iter-&gt;GetPointer()))</span>
    {
<span style = "background-color:#fdd">      reader-&gt;SetFilename(m_Filename);
      bool success = reader-&gt;Deserialize();
      error |= !success;
      m_PropertyList = reader-&gt;GetOutput();</span>

<span style = "background-color:#fdd">      if (error)</span>
      {
<span style = "background-color:#fdd">        MITK_ERROR &lt;&lt; "There were errors while loading property list file " &lt;&lt; m_Filename</span>
                   &lt;&lt; ". Your data may be corrupted";
      }
<span style = "background-color:#fdd">      break;
    }
  }</span>

<span style = "background-color:#fdd">  return !error;
}</span>

mitk::PropertyList::Pointer mitk::PropertyListDeserializer::GetOutput()
<span style = "background-color:#fdd">{
  return m_PropertyList;
}</span></pre>
	</body>
</html>