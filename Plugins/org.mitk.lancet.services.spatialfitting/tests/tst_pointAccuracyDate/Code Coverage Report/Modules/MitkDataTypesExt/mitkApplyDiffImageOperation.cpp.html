<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkApplyDiffImageOperation.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkApplyDiffImageOperation.h"

#include &lt;itkCommand.h&gt;

mitk::ApplyDiffImageOperation::ApplyDiffImageOperation(OperationType operationType,
                                                       Image *image,
                                                       Image *diffImage,
                                                       unsigned int timeStep,
                                                       unsigned int sliceDimension,
                                                       unsigned int sliceIndex)
<span style = "background-color:#fdd">  : Operation(operationType),
    m_Image(image),
    m_SliceIndex(sliceIndex),
    m_SliceDimension(sliceDimension),
    m_TimeStep(timeStep),
    m_Factor(1.0),
    m_ImageStillValid(false),
    m_DeleteTag(0)
{
  if (image &amp;&amp; diffImage)</span>
  {
    // observe 3D image for DeleteEvent
<span style = "background-color:#fdd">    m_ImageStillValid = true;</span>

<span style = "background-color:#fdd">    itk::SimpleMemberCommand&lt;ApplyDiffImageOperation&gt;::Pointer command =</span>
      itk::SimpleMemberCommand&lt;ApplyDiffImageOperation&gt;::New();
<span style = "background-color:#fdd">    command-&gt;SetCallbackFunction(this, &amp;ApplyDiffImageOperation::OnImageDeleted);
    m_DeleteTag = image-&gt;AddObserver(itk::DeleteEvent(), command);</span>

    // keep a compressed version of the image
<span style = "background-color:#fdd">    m_CompressedImageContainer.CompressImage(diffImage);
  }
}</span>

mitk::ApplyDiffImageOperation::~ApplyDiffImageOperation()
<span style = "background-color:#fdd">{
  if (m_ImageStillValid)</span>
  {
<span style = "background-color:#fdd">    m_Image-&gt;RemoveObserver(m_DeleteTag);</span>
  }
<span style = "background-color:#fdd">}</span>

void mitk::ApplyDiffImageOperation::OnImageDeleted()
<span style = "background-color:#fdd">{
  m_ImageStillValid = false;
}</span>

mitk::Image::Pointer mitk::ApplyDiffImageOperation::GetDiffImage()
<span style = "background-color:#fdd">{</span>
  // uncompress image to create a valid mitk::Image
<span style = "background-color:#fdd">  return m_CompressedImageContainer.DecompressImage();
}</span></pre>
	</body>
</html>