<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkSinglePointDataInteractor.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkSinglePointDataInteractor.h"
#include "mitkMouseMoveEvent.h"

#include "mitkInteractionConst.h" // TODO: refactor file
#include "mitkInternalEvent.h"
#include "mitkOperationEvent.h"
#include "mitkRenderingManager.h"
#include &lt;mitkPointOperation.h&gt;
//
#include "mitkBaseRenderer.h"
#include "mitkDispatcher.h"

#include "mitkUndoController.h"

mitk::SinglePointDataInteractor::SinglePointDataInteractor()
<span style = "background-color:#fdd">{
  this-&gt;SetMaxPoints(1);
}</span>

mitk::SinglePointDataInteractor::~SinglePointDataInteractor()
<span style = "background-color:#fdd">{
}</span>

void mitk::SinglePointDataInteractor::AddPoint(StateMachineAction * /*stateMachineAction*/,
                                               InteractionEvent *interactionEvent)
<span style = "background-color:#fdd">{
  unsigned int timeStep = interactionEvent-&gt;GetSender()-&gt;GetTimeStep(GetDataNode()-&gt;GetData());
  ScalarType timeInMs = interactionEvent-&gt;GetSender()-&gt;GetTime();</span>

  // To add a point the minimal information is the position, this method accepts all InteractionsPositionEvents
<span style = "background-color:#fdd">  auto *positionEvent = dynamic_cast&lt;InteractionPositionEvent *&gt;(interactionEvent);
  if (positionEvent != nullptr)</span>
  {
    PointOperation *doOp;
    PointOperation *undoOp;

<span style = "background-color:#fdd">    if (m_PointSet-&gt;IndexExists(0, timeStep))</span>
    {
<span style = "background-color:#fdd">      PointSet::PointType pt = m_PointSet-&gt;GetPoint(0, timeStep);
      Point3D itkPoint;
      itkPoint[0] = pt[0];
      itkPoint[1] = pt[1];
      itkPoint[2] = pt[2];</span>

<span style = "background-color:#fdd">      doOp = new mitk::PointOperation(OpMOVE, timeInMs, positionEvent-&gt;GetPositionInWorld(), 0);
      undoOp = new mitk::PointOperation(OpMOVE, timeInMs, itkPoint, 0);
    }</span>
    else
    {
<span style = "background-color:#fdd">      doOp = new mitk::PointOperation(OpINSERT, timeInMs, positionEvent-&gt;GetPositionInWorld(), 0);
      undoOp = new mitk::PointOperation(OpREMOVE, timeInMs, positionEvent-&gt;GetPositionInWorld(), 0);</span>
    }

<span style = "background-color:#fdd">    if (m_UndoEnabled)</span>
    {
<span style = "background-color:#fdd">      OperationEvent *operationEvent = new OperationEvent(m_PointSet, doOp, undoOp, "Move point");
      OperationEvent::IncCurrObjectEventId();</span>

<span style = "background-color:#fdd">      m_UndoController-&gt;SetOperationEvent(operationEvent);</span>
    }
    // execute the Operation
<span style = "background-color:#fdd">    m_PointSet-&gt;ExecuteOperation(doOp);</span>

<span style = "background-color:#fdd">    if (!m_UndoEnabled)
      delete doOp;</span>

<span style = "background-color:#fdd">    RenderingManager::GetInstance()-&gt;RequestUpdateAll();</span>
  }
<span style = "background-color:#fdd">}</span>

/*
 * Check whether the DataNode contains a pointset, if not create one and add it.
 */
void mitk::SinglePointDataInteractor::DataNodeChanged()
<span style = "background-color:#fdd">{
  if (GetDataNode() != nullptr)</span>
  {
<span style = "background-color:#fdd">    auto *points = dynamic_cast&lt;PointSet *&gt;(GetDataNode()-&gt;GetData());
    if (points == nullptr)</span>
    {
<span style = "background-color:#fdd">      m_PointSet = PointSet::New();
      GetDataNode()-&gt;SetData(m_PointSet);
    }</span>
    else
    {
<span style = "background-color:#fdd">      points-&gt;Clear();
      m_PointSet = points;</span>
    }
  }
<span style = "background-color:#fdd">}</span>

void mitk::SinglePointDataInteractor::SetMaxPoints(unsigned int)
<span style = "background-color:#fdd">{
}</span></pre>
	</body>
</html>