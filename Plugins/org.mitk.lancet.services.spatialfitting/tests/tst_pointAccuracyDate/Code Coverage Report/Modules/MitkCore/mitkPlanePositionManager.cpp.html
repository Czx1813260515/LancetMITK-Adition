<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkPlanePositionManager.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/
#include "mitkPlanePositionManager.h"
#include "mitkInteractionConst.h"

mitk::PlanePositionManagerService::PlanePositionManagerService()
<span style = "background-color:#dfd">{
}</span>

mitk::PlanePositionManagerService::~PlanePositionManagerService()
<span style = "background-color:#dfd">{
  for (unsigned int i = 0; i &lt; m_PositionList.size(); ++i)</span>
<span style = "background-color:#fdd">    delete m_PositionList[i];</span>
<span style = "background-color:#dfd">}</span>

unsigned int mitk::PlanePositionManagerService::AddNewPlanePosition(const PlaneGeometry *plane, unsigned int sliceIndex)
<span style = "background-color:#fdd">{
  for (unsigned int i = 0; i &lt; m_PositionList.size(); ++i)</span>
  {
<span style = "background-color:#fdd">    if (m_PositionList[i] != nullptr)</span>
    {
<span style = "background-color:#fdd">      bool isSameMatrix(true);
      bool isSameOffset(true);
      isSameOffset =</span>
        mitk::Equal(m_PositionList[i]-&gt;GetTransform()-&gt;GetOffset(), plane-&gt;GetIndexToWorldTransform()-&gt;GetOffset());
<span style = "background-color:#fdd">      if (!isSameOffset || sliceIndex != m_PositionList[i]-&gt;GetPos())
        continue;
      isSameMatrix = mitk::MatrixEqualElementWise(m_PositionList[i]-&gt;GetTransform()-&gt;GetMatrix(),</span>
                                                  plane-&gt;GetIndexToWorldTransform()-&gt;GetMatrix());
<span style = "background-color:#fdd">      if (isSameMatrix)
        return i;</span>
    }
<span style = "background-color:#fdd">  }</span>

<span style = "background-color:#fdd">  AffineTransform3D::Pointer transform = AffineTransform3D::New();
  Matrix3D matrix;
  matrix.GetVnlMatrix().set_column(0, plane-&gt;GetIndexToWorldTransform()-&gt;GetMatrix().GetVnlMatrix().get_column(0));
  matrix.GetVnlMatrix().set_column(1, plane-&gt;GetIndexToWorldTransform()-&gt;GetMatrix().GetVnlMatrix().get_column(1));
  matrix.GetVnlMatrix().set_column(2, plane-&gt;GetIndexToWorldTransform()-&gt;GetMatrix().GetVnlMatrix().get_column(2));
  transform-&gt;SetMatrix(matrix);
  transform-&gt;SetOffset(plane-&gt;GetIndexToWorldTransform()-&gt;GetOffset());</span>

<span style = "background-color:#fdd">  mitk::Vector3D direction;
  direction[0] = plane-&gt;GetIndexToWorldTransform()-&gt;GetMatrix().GetVnlMatrix().get_column(2)[0];
  direction[1] = plane-&gt;GetIndexToWorldTransform()-&gt;GetMatrix().GetVnlMatrix().get_column(2)[1];
  direction[2] = plane-&gt;GetIndexToWorldTransform()-&gt;GetMatrix().GetVnlMatrix().get_column(2)[2];
  direction.Normalize();</span>

<span style = "background-color:#fdd">  mitk::RestorePlanePositionOperation *newOp = new mitk::RestorePlanePositionOperation(OpRESTOREPLANEPOSITION,</span>
                                                                                       plane-&gt;GetExtent(0),
                                                                                       plane-&gt;GetExtent(1),
                                                                                       plane-&gt;GetSpacing(),
                                                                                       sliceIndex,
                                                                                       direction,
                                                                                       transform);

<span style = "background-color:#fdd">  m_PositionList.push_back(newOp);
  return GetNumberOfPlanePositions() - 1;
}</span>

bool mitk::PlanePositionManagerService::RemovePlanePosition(unsigned int ID)
<span style = "background-color:#fdd">{
  if (m_PositionList.size() &gt; ID)</span>
  {
<span style = "background-color:#fdd">    delete m_PositionList[ID];
    m_PositionList.erase(m_PositionList.begin() + ID);
    return true;
  }</span>
  else
  {
<span style = "background-color:#fdd">    return false;</span>
  }
<span style = "background-color:#fdd">}</span>

mitk::RestorePlanePositionOperation *mitk::PlanePositionManagerService::GetPlanePosition(unsigned int ID)
<span style = "background-color:#fdd">{
  if (ID &lt; m_PositionList.size())</span>
  {
<span style = "background-color:#fdd">    return m_PositionList[ID];
  }</span>
  else
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "GetPlanePosition returned nullptr!";
    return nullptr;</span>
  }
<span style = "background-color:#fdd">}</span>

unsigned int mitk::PlanePositionManagerService::GetNumberOfPlanePositions()
<span style = "background-color:#fdd">{
  return m_PositionList.size();
}</span>

void mitk::PlanePositionManagerService::RemoveAllPlanePositions()
<span style = "background-color:#fdd">{
  for (unsigned int i = 0; i &lt; m_PositionList.size(); ++i)
    delete m_PositionList[i];</span>

<span style = "background-color:#fdd">  m_PositionList.clear();
}</span></pre>
	</body>
</html>