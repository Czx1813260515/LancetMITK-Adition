<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkImageTimeSelector.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkImageTimeSelector.h"

<span style = "background-color:#fdd">mitk::ImageTimeSelector::ImageTimeSelector() : m_TimeNr(0), m_ChannelNr(0)
{
}</span>

mitk::ImageTimeSelector::~ImageTimeSelector()
<span style = "background-color:#fdd">{
}</span>

void mitk::ImageTimeSelector::GenerateOutputInformation()
<span style = "background-color:#fdd">{
  Image::ConstPointer input = this-&gt;GetInput();
  Image::Pointer output = this-&gt;GetOutput();</span>

<span style = "background-color:#fdd">  itkDebugMacro(&lt;&lt; "GenerateOutputInformation()");</span>

<span style = "background-color:#fdd">  int dim = (input-&gt;GetDimension() &lt; 3 ? input-&gt;GetDimension() : 3);
  output-&gt;Initialize(input-&gt;GetPixelType(), dim, input-&gt;GetDimensions());</span>

<span style = "background-color:#fdd">  if ((unsigned int)m_TimeNr &gt;= input-&gt;GetDimension(3))</span>
  {
<span style = "background-color:#fdd">    m_TimeNr = input-&gt;GetDimension(3) - 1;</span>
  }

  // initialize geometry
<span style = "background-color:#fdd">  mitk::SlicedGeometry3D::Pointer sliced_geo = input-&gt;GetSlicedGeometry(m_TimeNr);
  if (sliced_geo.IsNull())</span>
  {
<span style = "background-color:#fdd">    mitkThrow() &lt;&lt; "Failed to retrieve SlicedGeometry from input at timestep " &lt;&lt; m_TimeNr;</span>
  }

<span style = "background-color:#fdd">  mitk::SlicedGeometry3D::Pointer sliced_geo_clone = sliced_geo-&gt;Clone();
  if (sliced_geo_clone.IsNull())</span>
  {
<span style = "background-color:#fdd">    mitkThrow() &lt;&lt; "Failed to clone the retrieved sliced geometry.";</span>
  }

<span style = "background-color:#fdd">  mitk::BaseGeometry::Pointer geom_3d = dynamic_cast&lt;BaseGeometry *&gt;(sliced_geo_clone.GetPointer());
  if (geom_3d.IsNotNull())</span>
  {
<span style = "background-color:#fdd">    output-&gt;SetGeometry(geom_3d.GetPointer());
  }</span>
  else
  {
<span style = "background-color:#fdd">    mitkThrow() &lt;&lt; "Failed to cast the retrieved SlicedGeometry to a Geometry3D object.";</span>
  }

<span style = "background-color:#fdd">  output-&gt;SetPropertyList(input-&gt;GetPropertyList()-&gt;Clone());
}</span>

void mitk::ImageTimeSelector::GenerateData()
<span style = "background-color:#fdd">{
  const Image::RegionType &amp;requestedRegion = this-&gt;GetOutput()-&gt;GetRequestedRegion();</span>

  // do we really need a complete volume at a time?
<span style = "background-color:#fdd">  if (requestedRegion.GetSize(2) &gt; 1)</span>
  {
<span style = "background-color:#fdd">    mitk::ImageDataItem::Pointer im = this-&gt;GetVolumeData(m_TimeNr, m_ChannelNr)-&gt;Clone();
    im-&gt;SetTimestep(0);
    im-&gt;SetManageMemory(false);
    this-&gt;SetVolumeItem(im, 0);
  }</span>
  else
    // no, so take just a slice!
<span style = "background-color:#fdd">    this-&gt;SetSliceItem(</span>
      this-&gt;GetSliceData(requestedRegion.GetIndex(2), m_TimeNr, m_ChannelNr), requestedRegion.GetIndex(2), 0);
<span style = "background-color:#fdd">}</span>

void mitk::ImageTimeSelector::GenerateInputRequestedRegion()
<span style = "background-color:#fdd">{
  Superclass::GenerateInputRequestedRegion();</span>

<span style = "background-color:#fdd">  ImageToImageFilter::InputImagePointer input = this-&gt;GetInput();
  Image::Pointer output = this-&gt;GetOutput();</span>

<span style = "background-color:#fdd">  Image::RegionType requestedRegion;
  requestedRegion = output-&gt;GetRequestedRegion();
  requestedRegion.SetIndex(3, m_TimeNr);
  requestedRegion.SetIndex(4, m_ChannelNr);
  requestedRegion.SetSize(3, 1);
  requestedRegion.SetSize(4, 1);</span>

<span style = "background-color:#fdd">  input-&gt;SetRequestedRegion(&amp;requestedRegion);
}</span></pre>
	</body>
</html>