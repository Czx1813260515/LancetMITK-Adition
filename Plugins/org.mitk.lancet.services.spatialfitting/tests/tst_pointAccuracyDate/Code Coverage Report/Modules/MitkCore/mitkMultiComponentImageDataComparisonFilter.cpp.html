<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkMultiComponentImageDataComparisonFilter.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

// mitk includes
#include "mitkMultiComponentImageDataComparisonFilter.h"
#include "mitkImagePixelReadAccessor.h"
#include "mitkImageReadAccessor.h"

// other includes
// #include &lt;omp.h&gt;

namespace mitk
{
  MultiComponentImageDataComparisonFilter::MultiComponentImageDataComparisonFilter()
<span style = "background-color:#fdd">    : ImageToImageFilter(), m_Tolerance(0.0f), m_CompareResult(false), m_CompareDetails(nullptr)
  {
    this-&gt;SetNumberOfRequiredInputs(2);
  }</span>

<span style = "background-color:#fdd">  MultiComponentImageDataComparisonFilter::~MultiComponentImageDataComparisonFilter() {}</span>
  bool MultiComponentImageDataComparisonFilter::GetResult(double threshold)
<span style = "background-color:#fdd">  {
    if (!m_CompareResult)</span>
    {
<span style = "background-color:#fdd">      return false;</span>
    }

<span style = "background-color:#fdd">    if (m_CompareDetails-&gt;m_PixelsWithDifference &gt; threshold)</span>
    {
<span style = "background-color:#fdd">      return false;</span>
    }

<span style = "background-color:#fdd">    return true;
  }</span>

<span style = "background-color:#fdd">  void MultiComponentImageDataComparisonFilter::SetValidImage(const Image *_arg) { this-&gt;SetInput(0, _arg); }
  void MultiComponentImageDataComparisonFilter::SetTestImage(const Image *_arg) { this-&gt;SetInput(1, _arg); }
  const Image *MultiComponentImageDataComparisonFilter::GetValidImage() { return this-&gt;GetInput(0); }
  const Image *MultiComponentImageDataComparisonFilter::GetTestImage() { return this-&gt;GetInput(1); }</span>
  void MultiComponentImageDataComparisonFilter::SetCompareFilterResult(CompareFilterResults *results)
<span style = "background-color:#fdd">  {
    m_CompareDetails = results;
  }</span>

<span style = "background-color:#fdd">  CompareFilterResults *MultiComponentImageDataComparisonFilter::GetCompareFilterResult() { return m_CompareDetails; }</span>
  void MultiComponentImageDataComparisonFilter::GenerateData()
<span style = "background-color:#fdd">  {</span>
    // check inputs
<span style = "background-color:#fdd">    const Image *testInput = this-&gt;GetTestImage();
    const Image *validInput = this-&gt;GetValidImage();</span>

    // Generally this filter is part of the mitk::Image::Equal() method and only checks the equality of the image data
    // so no further image type comparison is performed!
    // CAVE: If the images differ in a parameter other then the image data, the filter may fail!!

<span style = "background-color:#fdd">    PixelType type = validInput-&gt;GetPixelType();</span>

<span style = "background-color:#fdd">    if (type.GetComponentType() == itk::IOComponentEnum::CHAR)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;char&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::UCHAR)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;unsigned char&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::INT)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;int&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::UINT)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;unsigned int&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::SHORT)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;short&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::USHORT)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;unsigned short&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::LONG)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;long&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::ULONG)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;unsigned long&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::FLOAT)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;float&gt;(testInput, validInput);
    }
    else if (type.GetComponentType() == itk::IOComponentEnum::DOUBLE)</span>
    {
<span style = "background-color:#fdd">      CompareMultiComponentImage&lt;double&gt;(testInput, validInput);
    }</span>
    else
    {
<span style = "background-color:#fdd">      mitkThrow() &lt;&lt; "Pixel component type not supported!";</span>
    }
<span style = "background-color:#fdd">  }</span>

  template &lt;typename TPixel&gt;
  void mitk::MultiComponentImageDataComparisonFilter::CompareMultiComponentImage(const Image *testImage,
                                                                                 const Image *validImage)
<span style = "background-color:#fdd">  {
    unsigned int noOfTimes = validImage-&gt;GetDimension(3);
    unsigned int noOfPixels = validImage-&gt;GetDimension(0) * validImage-&gt;GetDimension(1) * validImage-&gt;GetDimension(2);
    unsigned int noOfComponents = validImage-&gt;GetPixelType().GetNumberOfComponents();</span>

<span style = "background-color:#fdd">    for (unsigned int t = 0; t &lt; noOfTimes; ++t)</span>
    {
<span style = "background-color:#fdd">      ImageReadAccessor readAccTImage(testImage, testImage-&gt;GetVolumeData(t));
      ImageReadAccessor readAccVImage(validImage, validImage-&gt;GetVolumeData(t));</span>

<span style = "background-color:#fdd">      for (unsigned int p = 0; p &lt; noOfPixels * noOfComponents; ++p)</span>
      {
<span style = "background-color:#fdd">        TPixel vDataItem = static_cast&lt;TPixel *&gt;(const_cast&lt;void *&gt;(readAccVImage.GetData()))[p];
        TPixel tDataItem = static_cast&lt;TPixel *&gt;(const_cast&lt;void *&gt;(readAccTImage.GetData()))[p];</span>

<span style = "background-color:#fdd">        if (std::abs(static_cast&lt;double&gt;(tDataItem - vDataItem)) &gt; m_Tolerance)</span>
        {
<span style = "background-color:#fdd">          ++m_CompareDetails-&gt;m_PixelsWithDifference;</span>

<span style = "background-color:#fdd">          m_CompareDetails-&gt;m_MaximumDifference =</span>
            std::max(m_CompareDetails-&gt;m_MaximumDifference, std::abs(static_cast&lt;double&gt;(tDataItem - vDataItem)));

<span style = "background-color:#fdd">          double min =</span>
            std::min(m_CompareDetails-&gt;m_MinimumDifference, std::abs(static_cast&lt;double&gt;(tDataItem - vDataItem)));

<span style = "background-color:#fdd">          if (min != 0.0f) // a difference of zero is not a difference!
            m_CompareDetails-&gt;m_MinimumDifference = min;</span>

<span style = "background-color:#fdd">          m_CompareDetails-&gt;m_TotalDifference += std::abs(static_cast&lt;double&gt;(tDataItem - vDataItem));</span>
        }
<span style = "background-color:#fdd">      }
    }
    if (m_CompareDetails-&gt;m_PixelsWithDifference &gt; 0)</span>
    {
<span style = "background-color:#fdd">      m_CompareDetails-&gt;m_MeanDifference =</span>
        m_CompareDetails-&gt;m_TotalDifference / m_CompareDetails-&gt;m_PixelsWithDifference;
<span style = "background-color:#fdd">      m_CompareResult = false;
    }</span>
    else
    {
<span style = "background-color:#fdd">      m_CompareResult = true;</span>
    }
<span style = "background-color:#fdd">    m_CompareDetails-&gt;m_FilterCompleted = true;
  }</span>

} // end namespace mitk</pre>
	</body>
</html>