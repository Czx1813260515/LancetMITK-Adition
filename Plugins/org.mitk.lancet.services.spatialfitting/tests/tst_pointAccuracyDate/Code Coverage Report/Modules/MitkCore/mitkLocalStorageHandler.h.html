<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkLocalStorageHandler.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#ifndef LOCALSTORAGEHANDLER_H_HEADER_INCLUDED_C1E6EA08
#define LOCALSTORAGEHANDLER_H_HEADER_INCLUDED_C1E6EA08

#include "mitkBaseRenderer.h"
#include "mitkCommon.h"
#include "mitkLevelWindow.h"
#include "mitkVtkPropRenderer.h"
#include &lt;MitkCoreExports.h&gt;

#include &lt;itkObject.h&gt;
#include &lt;itkWeakPointer.h&gt;

class vtkWindow;
class vtkProp;

namespace mitk
{
  /** \brief Interface for accessing (templated) LocalStorageHandler instances.
   */
  class BaseLocalStorageHandler
  {
  public:
<span style = "background-color:#fdd">    virtual ~BaseLocalStorageHandler() {}</span>
    virtual void ClearLocalStorage(mitk::BaseRenderer *renderer, bool unregisterFromBaseRenderer = true) = 0;
  };

  /** \brief Templated class for management of LocalStorage implementations in Mappers.
   *
   * The LocalStorageHandler is responsible for providing a LocalStorage to a
   * concrete mitk::Mapper subclass. Each RenderWindow / mitk::BaseRenderer is
   * assigned its own LocalStorage instance so that all contained ressources
   * (actors, shaders, textures, ...) are provided individually per window.
   *
   */
  template &lt;class L&gt;
  class LocalStorageHandler : public mitk::BaseLocalStorageHandler
  {
  protected:
    std::map&lt;mitk::BaseRenderer *, L *&gt; m_BaseRenderer2LS;

  public:
    /** \brief deallocates a local storage for a specifc BaseRenderer (if the
     * BaseRenderer is itself deallocating it in its destructor, it has to set
     * unregisterFromBaseRenderer=false)
     */
    void ClearLocalStorage(mitk::BaseRenderer *renderer, bool unregisterFromBaseRenderer = true) override
<span style = "background-color:#fdd">    {</span>
      // MITK_INFO &lt;&lt; "deleting a localstorage on a mapper request";
<span style = "background-color:#fdd">      if (unregisterFromBaseRenderer)
        renderer-&gt;UnregisterLocalStorageHandler(this);
      L *l = m_BaseRenderer2LS[renderer];
      m_BaseRenderer2LS.erase(renderer);
      delete l;
    }</span>

    std::vector&lt;mitk::BaseRenderer *&gt; GetRegisteredBaseRenderer()
<span style = "background-color:#fdd">    {
      std::vector&lt;mitk::BaseRenderer *&gt; baserenderers;
      typename std::map&lt;mitk::BaseRenderer *, L *&gt;::iterator it;
      for (it = m_BaseRenderer2LS.begin(); it != m_BaseRenderer2LS.end(); ++it)</span>
      {
<span style = "background-color:#fdd">        baserenderers.push_back(it-&gt;first);
      }
      return baserenderers;
    }</span>

    /** \brief Retrieves a LocalStorage for a specific BaseRenderer.
     *
     * Should be used by mappers in GenerateDataForRenderer()
     */
    L *GetLocalStorage(mitk::BaseRenderer *forRenderer)
<span style = "background-color:#fdd">    {
      L *l = m_BaseRenderer2LS[forRenderer];
      if (!l)</span>
      {
        // MITK_INFO &lt;&lt; "creating new localstorage";
<span style = "background-color:#fdd">        l = new L;
        m_BaseRenderer2LS[forRenderer] = l;
        forRenderer-&gt;RegisterLocalStorageHandler(this);</span>
      }
<span style = "background-color:#fdd">      return l;
    }</span>

    ~LocalStorageHandler() override
<span style = "background-color:#fdd">    {
      typename std::map&lt;mitk::BaseRenderer *, L *&gt;::iterator it;</span>

<span style = "background-color:#fdd">      for (it = m_BaseRenderer2LS.begin(); it != m_BaseRenderer2LS.end(); it++)</span>
      {
<span style = "background-color:#fdd">        (*it).first-&gt;UnregisterLocalStorageHandler(this);
        delete (*it).second;
      }</span>

<span style = "background-color:#fdd">      m_BaseRenderer2LS.clear();
    }</span>
  };

} // namespace mitk

#endif /* LOCALSTORAGEHANDLER_H_HEADER_INCLUDED_C1E6EA08 */</pre>
	</body>
</html>