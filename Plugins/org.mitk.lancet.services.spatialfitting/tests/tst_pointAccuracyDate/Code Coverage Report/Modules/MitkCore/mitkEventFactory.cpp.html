<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkEventFactory.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkEventFactory.h"
#include &lt;algorithm&gt;
#include &lt;mitkInteractionEventConst.h&gt;
#include &lt;mitkInteractionKeyEvent.h&gt;
#include &lt;mitkInteractionPositionEvent.h&gt;
#include &lt;mitkInternalEvent.h&gt;
#include &lt;mitkMouseDoubleClickEvent.h&gt;
#include &lt;mitkMouseMoveEvent.h&gt;
#include &lt;mitkMousePressEvent.h&gt;
#include &lt;mitkMouseReleaseEvent.h&gt;
#include &lt;mitkMouseWheelEvent.h&gt;
#include &lt;sstream&gt;
#include &lt;string&gt;

namespace
{
  std::vector&lt;std::string&gt; &amp;split(const std::string &amp;s, char delim, std::vector&lt;std::string&gt; &amp;elems)
<span style = "background-color:#fdd">  {
    std::stringstream ss(s);
    std::string item;
    while (std::getline(ss, item, delim))</span>
    {
<span style = "background-color:#fdd">      elems.push_back(item);
    }
    return elems;
  }</span>

  std::vector&lt;std::string&gt; split(const std::string &amp;s, char delim)
<span style = "background-color:#fdd">  {
    std::vector&lt;std::string&gt; elems;
    return split(s, delim, elems);
  }</span>
}

/**
 * @brief GetEventButton Return EventButton as String
 * @param event
 * @return
 */
static std::string GetButtonState(mitk::InteractionEvent *event)
<span style = "background-color:#fdd">{
  mitk::InteractionEvent::MouseButtons buttonState = mitk::InteractionEvent::NoButton;
  std::string eventClass = event-&gt;GetNameOfClass();
  std::transform(eventClass.cbegin(), eventClass.cend(), eventClass.begin(), ::toupper);</span>

<span style = "background-color:#fdd">  std::string strButtonState = "";
  if (eventClass == "MOUSEPRESSEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MousePressEvent *&gt;(event);
    buttonState = mme-&gt;GetButtonStates();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSERELEASEEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseReleaseEvent *&gt;(event);
    buttonState = mme-&gt;GetButtonStates();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEDOUBLECLICKEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseDoubleClickEvent *&gt;(event);
    buttonState = mme-&gt;GetButtonStates();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEMOVEEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseMoveEvent *&gt;(event);
    buttonState = mme-&gt;GetButtonStates();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEWHEELEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseWheelEvent *&gt;(event);
    buttonState = mme-&gt;GetButtonStates();</span>
  }

<span style = "background-color:#fdd">  if (buttonState &amp; mitk::InteractionEvent::LeftMouseButton)</span>
  {
<span style = "background-color:#fdd">    strButtonState = "LeftMouseButton";</span>
  }
<span style = "background-color:#fdd">  if (buttonState &amp; mitk::InteractionEvent::RightMouseButton)</span>
  {
<span style = "background-color:#fdd">    if (strButtonState != "")
      strButtonState += ",";</span>

<span style = "background-color:#fdd">    strButtonState += "RightMouseButton";</span>
  }
<span style = "background-color:#fdd">  if (buttonState &amp; mitk::InteractionEvent::MiddleMouseButton)</span>
  {
<span style = "background-color:#fdd">    if (strButtonState != "")
      strButtonState += ",";</span>

<span style = "background-color:#fdd">    strButtonState += "MiddleMouseButton";</span>
  }
<span style = "background-color:#fdd">  return strButtonState;
}</span>

/**
 * @brief GetModifierState Return ModifierState as String
 * @param event
 * @return
 */
static std::string GetModifierState(mitk::InteractionEvent *event)
<span style = "background-color:#fdd">{
  mitk::InteractionEvent::ModifierKeys modifierKeys = mitk::InteractionEvent::NoKey;
  std::string eventClass = event-&gt;GetNameOfClass();
  std::transform(eventClass.cbegin(), eventClass.cend(), eventClass.begin(), ::toupper);
  std::string strModKeys = "";</span>
  // TODO Add InteractionKey
<span style = "background-color:#fdd">  if (eventClass == "MOUSEPRESSEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MousePressEvent *&gt;(event);
    modifierKeys = mme-&gt;GetModifiers();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSERELEASEEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseReleaseEvent *&gt;(event);
    modifierKeys = mme-&gt;GetModifiers();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEDOUBLECLICKEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseDoubleClickEvent *&gt;(event);
    modifierKeys = mme-&gt;GetModifiers();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEMOVEEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseMoveEvent *&gt;(event);
    modifierKeys = mme-&gt;GetModifiers();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEWHEELEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseWheelEvent *&gt;(event);
    modifierKeys = mme-&gt;GetModifiers();</span>
  }

<span style = "background-color:#fdd">  if (modifierKeys &amp; mitk::InteractionEvent::ShiftKey)</span>
  {
<span style = "background-color:#fdd">    strModKeys = "SHIFT";</span>
  }
<span style = "background-color:#fdd">  if (modifierKeys &amp; mitk::InteractionEvent::ControlKey)</span>
  {
<span style = "background-color:#fdd">    if (strModKeys != "")
      strModKeys += ",";</span>

<span style = "background-color:#fdd">    strModKeys += "CTRL";</span>
  }
<span style = "background-color:#fdd">  if (modifierKeys &amp; mitk::InteractionEvent::AltKey)</span>
  {
<span style = "background-color:#fdd">    if (strModKeys != "")
      strModKeys += ",";</span>

<span style = "background-color:#fdd">    strModKeys += "ALT";</span>
  }
<span style = "background-color:#fdd">  return strModKeys;
}</span>

/**
 * @brief GetEventButton Return EventButton as String
 * @param event
 * @return
 */
static std::string GetEventButton(mitk::InteractionEvent *event)
<span style = "background-color:#fdd">{
  mitk::InteractionEvent::MouseButtons button = mitk::InteractionEvent::NoButton;
  std::string eventClass = event-&gt;GetNameOfClass();
  std::transform(eventClass.cbegin(), eventClass.cend(), eventClass.begin(), ::toupper);
  std::string stdButton = "";</span>
  // TODO Add InteractionKey
<span style = "background-color:#fdd">  if (eventClass == "MOUSEPRESSEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MousePressEvent *&gt;(event);
    button = mme-&gt;GetEventButton();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSERELEASEEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseReleaseEvent *&gt;(event);
    button = mme-&gt;GetEventButton();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEDOUBLECLICKEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *mme = dynamic_cast&lt;mitk::MouseDoubleClickEvent *&gt;(event);
    button = mme-&gt;GetEventButton();</span>
  }

<span style = "background-color:#fdd">  if (button &amp; mitk::InteractionEvent::LeftMouseButton)</span>
  {
<span style = "background-color:#fdd">    stdButton = "LeftMouseButton";</span>
  }
<span style = "background-color:#fdd">  if (button &amp; mitk::InteractionEvent::RightMouseButton)</span>
  {
<span style = "background-color:#fdd">    stdButton = "RightMouseButton";</span>
  }
<span style = "background-color:#fdd">  if (button &amp; mitk::InteractionEvent::MiddleMouseButton)</span>
  {
<span style = "background-color:#fdd">    stdButton = "MiddleMouseButton";</span>
  }
<span style = "background-color:#fdd">  return stdButton;
}</span>

/**
 * @brief GetPosition Return World Position as String
 * @param event
 * @return
 */
static std::string GetPositionInWorld(mitk::InteractionEvent *event)
<span style = "background-color:#fdd">{
  std::stringstream ss;
  auto *pe = dynamic_cast&lt;mitk::InteractionPositionEvent *&gt;(event);
  if (pe != nullptr)</span>
  {
<span style = "background-color:#fdd">    mitk::Point3D p = pe-&gt;GetPositionInWorld();
    ss &lt;&lt; p[0] &lt;&lt; "," &lt;&lt; p[1] &lt;&lt; "," &lt;&lt; p[2];</span>
  }
<span style = "background-color:#fdd">  return ss.str();
}</span>

/**
 * @brief GetPositionOnScreen Return PositionOnScreen as String
 * @param event
 * @return
 */
static std::string GetPositionOnScreen(mitk::InteractionEvent *event)
<span style = "background-color:#fdd">{
  std::stringstream ss;
  auto *pe = dynamic_cast&lt;mitk::InteractionPositionEvent *&gt;(event);
  if (pe != nullptr)</span>
  {
<span style = "background-color:#fdd">    mitk::Point2D p = pe-&gt;GetPointerPositionOnScreen();
    ss &lt;&lt; p[0] &lt;&lt; "," &lt;&lt; p[1];</span>
  }
<span style = "background-color:#fdd">  return ss.str();
}</span>

mitk::InteractionEvent::Pointer mitk::EventFactory::CreateEvent(PropertyList::Pointer list)
<span style = "background-color:#fdd">{</span>
  //
<span style = "background-color:#fdd">  std::string eventClass, eventVariant;
  list-&gt;GetStringProperty(InteractionEventConst::xmlParameterEventClass().c_str(), eventClass);
  list-&gt;GetStringProperty(InteractionEventConst::xmlParameterEventVariant().c_str(), eventVariant);</span>

  // Query all possible attributes, if they are not present, set their default values.
  // Position Events &amp; Key Events
<span style = "background-color:#fdd">  std::string strModifiers;
  InteractionEvent::ModifierKeys modifiers = InteractionEvent::NoKey;
  std::string strEventButton;
  InteractionEvent::MouseButtons eventButton = InteractionEvent::NoButton;
  std::string strButtonState;
  InteractionEvent::MouseButtons buttonState = InteractionEvent::NoButton;
  std::string strKey;
  std::string key;
  std::string strWheelDelta;</span>
  int wheelDelta;
<span style = "background-color:#fdd">  std::string strSignalName = "";</span>

<span style = "background-color:#fdd">  Point2D pos;
  pos.Fill(0);
  std::string strPos;</span>

  // Position on screen
<span style = "background-color:#fdd">  if (list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertyPositionOnScreen().c_str(), strPos))</span>
  {
    // split comma separated string
    int commaPos;
<span style = "background-color:#fdd">    commaPos = strPos.find_first_of(',');</span>

<span style = "background-color:#fdd">    pos[0] = static_cast&lt;mitk::ScalarType&gt;(std::atof(strPos.substr(0, commaPos).c_str()));
    pos[1] = static_cast&lt;mitk::ScalarType&gt;(std::atof(strPos.substr(commaPos + 1, strPos.length()).c_str()));</span>
  }

<span style = "background-color:#fdd">  std::string strWorld;
  Point3D worldPos;
  worldPos.Fill(0);</span>
  // Position in world coordinates
<span style = "background-color:#fdd">  if (list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertyPositionInWorld().c_str(), strWorld))</span>
  {
<span style = "background-color:#fdd">    const std::vector&lt;std::string&gt; coords = split(strWorld, ',');
    int i = 0;
    for (auto it = coords.cbegin(); it != coords.cend(); ++it, ++i)</span>
    {
<span style = "background-color:#fdd">      worldPos[i] = atof((*it).c_str());
    }
  }</span>

  // Parse modifier information
<span style = "background-color:#fdd">  if (list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertyModifier().c_str(), strModifiers))</span>
  {
<span style = "background-color:#fdd">    std::vector&lt;std::string&gt; mods = split(strModifiers, ',');
    for (auto it = mods.begin(); it != mods.end(); ++it)</span>
    {
<span style = "background-color:#fdd">      std::transform((*it).cbegin(), (*it).cend(), (*it).begin(), ::toupper);
      if (*it == "CTRL")</span>
      {
<span style = "background-color:#fdd">        modifiers = modifiers | InteractionEvent::ControlKey;
      }
      else if (*it == "ALT")</span>
      {
<span style = "background-color:#fdd">        modifiers = modifiers | InteractionEvent::AltKey;
      }
      else if (*it == "SHIFT")</span>
      {
<span style = "background-color:#fdd">        modifiers = modifiers | InteractionEvent::ShiftKey;
      }</span>
      else
      {
<span style = "background-color:#fdd">        MITK_WARN &lt;&lt; "mitkEventFactory: Invalid event modifier in config file :" &lt;&lt; (*it);
      }
    }
  }</span>

  // Set EventButton
<span style = "background-color:#fdd">  if (list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertyEventButton().c_str(), strEventButton))</span>
  {
<span style = "background-color:#fdd">    std::transform(strEventButton.cbegin(), strEventButton.cend(), strEventButton.begin(), ::toupper);
    if (strEventButton == "MIDDLEMOUSEBUTTON")</span>
    {
<span style = "background-color:#fdd">      eventButton = InteractionEvent::MiddleMouseButton;
    }
    else if (strEventButton == "LEFTMOUSEBUTTON")</span>
    {
<span style = "background-color:#fdd">      eventButton = InteractionEvent::LeftMouseButton;
    }
    else if (strEventButton == "RIGHTMOUSEBUTTON")</span>
    {
<span style = "background-color:#fdd">      eventButton = InteractionEvent::RightMouseButton;
    }</span>
    else
    {
<span style = "background-color:#fdd">      MITK_WARN &lt;&lt; "mitkEventFactory: Invalid event button in config file: " &lt;&lt; strEventButton;</span>
    }
  }

  // Parse ButtonStates
<span style = "background-color:#fdd">  if (list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertyButtonState().c_str(), strButtonState))</span>
  {
<span style = "background-color:#fdd">    std::vector&lt;std::string&gt; mods = split(strButtonState, ',');
    for (auto it = mods.begin(); it != mods.end(); ++it)</span>
    {
<span style = "background-color:#fdd">      std::transform((*it).cbegin(), (*it).cend(), (*it).begin(), ::toupper);
      if (*it == "MIDDLEMOUSEBUTTON")</span>
      {
<span style = "background-color:#fdd">        buttonState = buttonState | InteractionEvent::MiddleMouseButton;
      }
      else if (*it == "LEFTMOUSEBUTTON")</span>
      {
<span style = "background-color:#fdd">        buttonState = buttonState | InteractionEvent::LeftMouseButton;
      }
      else if (*it == "RIGHTMOUSEBUTTON")</span>
      {
<span style = "background-color:#fdd">        buttonState = buttonState | InteractionEvent::RightMouseButton;
      }</span>
      else
      {
<span style = "background-color:#fdd">        MITK_WARN &lt;&lt; "mitkEventFactory: Invalid event buttonstate in config file:" &lt;&lt; (*it);
      }
    }
  }</span>

  // Key
<span style = "background-color:#fdd">  if (!list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertyKey().c_str(), strKey))</span>
  {
<span style = "background-color:#fdd">    key = "";
  }</span>
  else
  {
<span style = "background-color:#fdd">    key = strKey;</span>
  }
  // WheelDelta
<span style = "background-color:#fdd">  if (!list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertyScrollDirection().c_str(), strWheelDelta))</span>
  {
<span style = "background-color:#fdd">    wheelDelta = 0;
  }</span>
  else
  {
<span style = "background-color:#fdd">    std::transform(strWheelDelta.cbegin(), strWheelDelta.cend(), strWheelDelta.begin(), ::toupper);
    if (strWheelDelta == "DOWN")</span>
    {
<span style = "background-color:#fdd">      wheelDelta = -1;
    }</span>
    else
    {
<span style = "background-color:#fdd">      wheelDelta = 1;</span>
    }
  }
  // Internal Signals Name
<span style = "background-color:#fdd">  list-&gt;GetStringProperty(InteractionEventConst::xmlEventPropertySignalName().c_str(), strSignalName);</span>

  // Get BaseRenderer by name
<span style = "background-color:#fdd">  mitk::BaseRenderer *renderer = nullptr;
  std::string strRenderer;</span>

  // only search for a renderer if there is at least one renderer registered
<span style = "background-color:#fdd">  if (mitk::BaseRenderer::baseRendererMap.size() &gt; 0)</span>
  {
<span style = "background-color:#fdd">    if (list-&gt;GetStringProperty(mitk::InteractionEventConst::xmlEventPropertyRendererName().c_str(), strRenderer))</span>
    {
      // look up for renderer registered with the name in xml file
<span style = "background-color:#fdd">      renderer = mitk::BaseRenderer::GetByName(strRenderer);</span>
    }

    // if not found always use first registered renderer
<span style = "background-color:#fdd">    if (renderer == nullptr)
      renderer = (*(mitk::BaseRenderer::baseRendererMap.cbegin())).second;</span>
  }

  /*
   * Here the objects are created
   */

<span style = "background-color:#fdd">  mitk::InteractionEvent::Pointer event;
  std::transform(eventClass.cbegin(), eventClass.cend(), eventClass.begin(), ::toupper);</span>

<span style = "background-color:#fdd">  if (eventClass == "MOUSEPRESSEVENT")</span>
  {
    // buttonstates incorporate the event button (as in Qt)
<span style = "background-color:#fdd">    buttonState = buttonState | eventButton;
    event = MousePressEvent::New(renderer, pos, buttonState, modifiers, eventButton);
  }
  else if (eventClass == "MOUSEDOUBLECLICKEVENT")</span>
  {
<span style = "background-color:#fdd">    buttonState = buttonState | eventButton;
    event = MouseDoubleClickEvent::New(renderer, pos, buttonState, modifiers, eventButton);
  }
  else if (eventClass == "MOUSEMOVEEVENT")</span>
  {
<span style = "background-color:#fdd">    event = MouseMoveEvent::New(renderer, pos, buttonState, modifiers);
  }
  else if (eventClass == "MOUSERELEASEEVENT")</span>
  {
<span style = "background-color:#fdd">    event = MouseReleaseEvent::New(renderer, pos, buttonState, modifiers, eventButton);
  }
  else if (eventClass == "INTERACTIONKEYEVENT")</span>
  {
<span style = "background-color:#fdd">    event = InteractionKeyEvent::New(renderer, key, modifiers);
  }
  else if (eventClass == "MOUSEWHEELEVENT")</span>
  {
<span style = "background-color:#fdd">    event = MouseWheelEvent::New(renderer, pos, buttonState, modifiers, wheelDelta);
  }
  else if (eventClass == "INTERACTIONPOSITIONEVENT")</span>
  {
<span style = "background-color:#fdd">    event = InteractionPositionEvent::New(renderer, pos);
  }
  else if (eventClass == "INTERNALEVENT")</span>
  {
<span style = "background-color:#fdd">    event = InternalEvent::New(renderer, nullptr, strSignalName);
  }
  else if (eventClass == "INTERACTIONEVENT")</span>
  {
<span style = "background-color:#fdd">    event = InteractionEvent::New(renderer);</span>
  }
<span style = "background-color:#fdd">  if (event.IsNull())</span>
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "Event couldn't be constructed. Please check your StateMachine patterns and config files\n for the "</span>
                 "following event class, which is not valid: "
              &lt;&lt; eventClass;
<span style = "background-color:#fdd">    return nullptr;</span>
  }
<span style = "background-color:#fdd">  return event;
}</span>

std::string mitk::EventFactory::EventToXML(mitk::InteractionEvent *event)
<span style = "background-color:#fdd">{
  auto *ie = dynamic_cast&lt;InternalEvent *&gt;(event);
  if (ie != nullptr)
    return "";</span>

<span style = "background-color:#fdd">  std::string eventClass = event-&gt;GetNameOfClass();
  std::string eventXML =</span>
    "&lt;" + InteractionEventConst::xmlTagEventVariant() + " " + InteractionEventConst::xmlParameterEventClass() + "=\"";

<span style = "background-color:#fdd">  std::transform(eventClass.cbegin(), eventClass.cend(), eventClass.begin(), ::toupper);</span>

<span style = "background-color:#fdd">  eventXML += eventClass + "\" &gt;\n";</span>
  // here follow event specific attributes
  if (eventClass == "MOUSEPRESSEVENT" || eventClass == "MOUSERELEASEEVENT" || eventClass == "MOUSEDOUBLECLICKEVENT" ||
<span style = "background-color:#fdd">      eventClass == "MOUSEMOVEEVENT" || eventClass == "MOUSEWHEELEVENT")</span>
  {
<span style = "background-color:#fdd">    if (!(eventClass == "MOUSEMOVEEVENT") &amp;&amp; !(eventClass == "MOUSEWHEELEVENT"))</span>
    {
      // EventButton
<span style = "background-color:#fdd">      eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                  "=\"" + InteractionEventConst::xmlEventPropertyEventButton() + "\" ";
<span style = "background-color:#fdd">      eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
      eventXML += GetEventButton(event);
      eventXML += "\"/&gt;\n";</span>
    }
    // ButtonState
<span style = "background-color:#fdd">    if (GetButtonState(event) != "")</span>
    {
<span style = "background-color:#fdd">      eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                  "=\"" + InteractionEventConst::xmlEventPropertyButtonState() + "\" ";
<span style = "background-color:#fdd">      eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
      eventXML += GetButtonState(event);
      eventXML += "\"/&gt;\n";</span>
    }

    // Modifiers
<span style = "background-color:#fdd">    if (GetModifierState(event) != "")</span>
    {
<span style = "background-color:#fdd">      eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                  "=\"" + InteractionEventConst::xmlEventPropertyModifier() + "\" ";
<span style = "background-color:#fdd">      eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
      eventXML += GetModifierState(event);
      eventXML += "\"/&gt;\n";</span>
    }

    // Position on Screen
<span style = "background-color:#fdd">    eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                "=\"" + InteractionEventConst::xmlEventPropertyPositionOnScreen() + "\" ";
<span style = "background-color:#fdd">    eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
    eventXML += GetPositionOnScreen(event);
    eventXML += "\"/&gt;\n";</span>

    // Position in World
<span style = "background-color:#fdd">    eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                "=\"" + InteractionEventConst::xmlEventPropertyPositionInWorld() + "\" ";
<span style = "background-color:#fdd">    eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
    eventXML += GetPositionInWorld(event);
    eventXML += "\"/&gt;\n";
  }
  else if (eventClass == "INTERACTIONKEYEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *ke = dynamic_cast&lt;mitk::InteractionKeyEvent *&gt;(event);</span>

    // key
<span style = "background-color:#fdd">    eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                "=\"" + InteractionEventConst::xmlEventPropertyKey() + "\" ";
<span style = "background-color:#fdd">    eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
    eventXML += ke-&gt;GetKey();
    eventXML += "\"/&gt;\n";
  }</span>
  else
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "Event not recognized, discarding event of type " &lt;&lt; event-&gt;GetNameOfClass();</span>
  }
<span style = "background-color:#fdd">  if (eventClass == "MOUSEWHEELEVENT")</span>
  {
<span style = "background-color:#fdd">    auto *we = dynamic_cast&lt;MouseWheelEvent *&gt;(event);
    int delta = we-&gt;GetWheelDelta();</span>

<span style = "background-color:#fdd">    std::stringstream ss;
    ss &lt;&lt; delta;</span>

<span style = "background-color:#fdd">    eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                "=\"" + InteractionEventConst::xmlEventPropertyWheelDelta() + "\" ";
<span style = "background-color:#fdd">    eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
    eventXML += ss.str();
    eventXML += "\"/&gt;\n";</span>

<span style = "background-color:#fdd">    eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
                "=\"" + InteractionEventConst::xmlEventPropertyScrollDirection() + "\" ";
<span style = "background-color:#fdd">    eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
    eventXML += delta &lt; 0 ? "DOWN" : "UP";
    eventXML += "\"/&gt;\n";
  }</span>

  // Renderer name
<span style = "background-color:#fdd">  eventXML += " &lt;" + InteractionEventConst::xmlTagAttribute() + " " + InteractionEventConst::xmlParameterName() +</span>
              "=\"" + InteractionEventConst::xmlEventPropertyRendererName() + "\" ";
<span style = "background-color:#fdd">  eventXML += InteractionEventConst::xmlParameterValue() + "=\"";
  eventXML += event-&gt;GetSender()-&gt;GetName();
  eventXML += "\"/&gt;\n";</span>

  // closing tag:
<span style = "background-color:#fdd">  eventXML += "&lt;/" + InteractionEventConst::xmlTagEventVariant() + "&gt;";
  return eventXML;
}</span></pre>
	</body>
</html>