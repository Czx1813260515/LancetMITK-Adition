<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkHistogramStatisticsCalculator.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include &lt;mitkHistogramStatisticsCalculator.h&gt;
#include &lt;stdexcept&gt;

namespace mitk {

HistogramStatisticsCalculator::HistogramStatisticsCalculator():
<span style = "background-color:#fdd">    m_Uniformity(0), m_UPP(0), m_Entropy(0), m_Median(0), m_StatisticsCalculated(false)
{</span>

<span style = "background-color:#fdd">}</span>

void HistogramStatisticsCalculator::SetHistogram(HistogramType::Pointer histogram)
<span style = "background-color:#fdd">{
    if (m_Histogram != histogram)</span>
    {
<span style = "background-color:#fdd">        m_Histogram = histogram;
        m_StatisticsCalculated = false;</span>
    }
<span style = "background-color:#fdd">}</span>

HistogramStatisticsCalculator::MeasurementType HistogramStatisticsCalculator::GetEntropy()
<span style = "background-color:#fdd">{
    if (!m_StatisticsCalculated)</span>
    {
<span style = "background-color:#fdd">        MITK_WARN("Statistics have not yet been calculated, running calculation now...");
        CalculateStatistics();</span>
    }
<span style = "background-color:#fdd">    return m_Entropy;
}</span>

HistogramStatisticsCalculator::MeasurementType HistogramStatisticsCalculator::GetMedian()
<span style = "background-color:#fdd">{
    if (!m_StatisticsCalculated)</span>
    {
<span style = "background-color:#fdd">        MITK_WARN("Statistics have not yet been calculated, running calculation now...");
        CalculateStatistics();</span>
    }
<span style = "background-color:#fdd">    return m_Median;
}</span>

HistogramStatisticsCalculator::MeasurementType HistogramStatisticsCalculator::GetUniformity()
<span style = "background-color:#fdd">{
    if (!m_StatisticsCalculated)</span>
    {
<span style = "background-color:#fdd">        MITK_WARN("Statistics have not yet been calculated, running calculation now...");
        CalculateStatistics();</span>
    }
<span style = "background-color:#fdd">    return m_Uniformity;
}</span>

HistogramStatisticsCalculator::MeasurementType HistogramStatisticsCalculator::GetUPP()
<span style = "background-color:#fdd">{
    if (!m_StatisticsCalculated)</span>
    {
<span style = "background-color:#fdd">        MITK_WARN("Statistics have not yet been calculated, running calculation now...");
        CalculateStatistics();</span>
    }
<span style = "background-color:#fdd">    return m_UPP;
}</span>

void HistogramStatisticsCalculator::CalculateStatistics()
<span style = "background-color:#fdd">{
    if (m_Histogram.IsNull())</span>
    {
<span style = "background-color:#fdd">        throw std::runtime_error("Histogram not set in HistogramStatisticsCalculator::CalculateStatistics()");</span>
    }

<span style = "background-color:#fdd">    unsigned int nBins = m_Histogram-&gt;GetSize()[0];
    m_Uniformity = 0;
    m_Entropy = 0;
    m_UPP = 0;
    m_Median = 0;</span>

<span style = "background-color:#fdd">    MeasurementType cumulativeProbability = 0.0;
    bool medianFound(false);</span>

<span style = "background-color:#fdd">    for (unsigned int i = 0; i &lt; nBins; i++)</span>
    {
<span style = "background-color:#fdd">      MeasurementType partialProbability = m_Histogram-&gt;GetFrequency(i, 0) / double( m_Histogram-&gt;GetTotalFrequency() );
        cumulativeProbability += partialProbability;</span>

<span style = "background-color:#fdd">        if (partialProbability != 0)</span>
        {
<span style = "background-color:#fdd">            m_Entropy -= partialProbability * (std::log2( partialProbability ));
            m_Uniformity += std::pow(partialProbability, 2);</span>

<span style = "background-color:#fdd">            if (m_Histogram-&gt;GetMeasurement(i, 0) &gt; 0)</span>
            {
<span style = "background-color:#fdd">                m_UPP += std::pow(partialProbability, 2);</span>
            }

        }

<span style = "background-color:#fdd">        if (cumulativeProbability &gt;= 0.5 &amp;&amp; !medianFound)</span>
        {
<span style = "background-color:#fdd">            MeasurementType binMin = m_Histogram-&gt;GetBinMin(0, i);
            MeasurementType binMax = m_Histogram-&gt;GetBinMax(0, i);
            m_Median = (binMax + binMin) / 2.0;
            medianFound = true;</span>
        }

<span style = "background-color:#fdd">    }
    m_StatisticsCalculated = true;
}</span>

}
</pre>
	</body>
</html>