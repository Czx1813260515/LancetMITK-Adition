<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkImageMaskGenerator.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include &lt;mitkImageMaskGenerator.h&gt;
#include &lt;mitkImageTimeSelector.h&gt;
#include &lt;stdexcept&gt;

namespace mitk {

void ImageMaskGenerator::SetImageMask(Image::Pointer maskImage)
<span style = "background-color:#fdd">{
    if (m_internalMaskImage != maskImage)</span>
    {
<span style = "background-color:#fdd">        m_internalMaskImage = maskImage;
        this-&gt;Modified();</span>
    }
<span style = "background-color:#fdd">}</span>

void ImageMaskGenerator::SetTimeStep(unsigned int timeStep)
<span style = "background-color:#fdd">{
    if (timeStep != m_TimeStep)</span>
    {
<span style = "background-color:#fdd">        m_TimeStep = timeStep;
        UpdateInternalMask();</span>
    }
<span style = "background-color:#fdd">}</span>

void ImageMaskGenerator::UpdateInternalMask()
<span style = "background-color:#fdd">{</span>
    unsigned int timeStepForExtraction;

<span style = "background-color:#fdd">    if (m_TimeStep &gt;= m_internalMaskImage-&gt;GetTimeSteps())</span>
    {
<span style = "background-color:#fdd">        MITK_WARN &lt;&lt; "Warning: time step &gt; number of time steps in mask image, using last time step";
        timeStepForExtraction = m_internalMaskImage-&gt;GetTimeSteps() - 1;
    }</span>
    else
    {
<span style = "background-color:#fdd">        timeStepForExtraction = m_TimeStep;</span>
    }
<span style = "background-color:#fdd">    ImageTimeSelector::Pointer imageTimeSelector = ImageTimeSelector::New();
    imageTimeSelector-&gt;SetInput(m_internalMaskImage);
    imageTimeSelector-&gt;SetTimeNr(timeStepForExtraction);
    imageTimeSelector-&gt;UpdateLargestPossibleRegion();</span>

<span style = "background-color:#fdd">    m_InternalMask = mitk::Image::New();
    m_InternalMask = imageTimeSelector-&gt;GetOutput();
}</span>


mitk::Image::Pointer ImageMaskGenerator::GetMask()
<span style = "background-color:#fdd">{
    if (m_internalMaskImage.IsNull())</span>
    {
<span style = "background-color:#fdd">        MITK_ERROR &lt;&lt; "Mask Image is nullptr";</span>
    }
<span style = "background-color:#fdd">    if (IsUpdateRequired())</span>
    {
<span style = "background-color:#fdd">        UpdateInternalMask();</span>
    }

<span style = "background-color:#fdd">    return m_InternalMask;
}</span>

bool ImageMaskGenerator::IsUpdateRequired() const
<span style = "background-color:#fdd">{
    unsigned long internalMaskTimeStamp = m_InternalMask-&gt;GetMTime();
    unsigned long maskImageTimeStamp = m_internalMaskImage-&gt;GetMTime();</span>

<span style = "background-color:#fdd">    if (maskImageTimeStamp &gt; internalMaskTimeStamp) // inputs have changed</span>
    {
<span style = "background-color:#fdd">        return true;</span>
    }

<span style = "background-color:#fdd">    if (this-&gt;GetMTime() &gt; maskImageTimeStamp) // input has changed</span>
    {
<span style = "background-color:#fdd">        return true;</span>
    }

<span style = "background-color:#fdd">    return false;
}</span>

}





</pre>
	</body>
</html>