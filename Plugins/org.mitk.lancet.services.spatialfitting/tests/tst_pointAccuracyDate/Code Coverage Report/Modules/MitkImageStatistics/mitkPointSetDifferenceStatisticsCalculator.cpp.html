<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkPointSetDifferenceStatisticsCalculator.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/


#include "mitkPointSetDifferenceStatisticsCalculator.h"
#include "mitkImageStatisticsConstants.h"

mitk::PointSetDifferenceStatisticsCalculator::PointSetDifferenceStatisticsCalculator() :
<span style = "background-color:#fdd">  m_StatisticsCalculated(false)
{
  m_PointSet1 = mitk::PointSet::New();
  m_PointSet2 = mitk::PointSet::New();</span>
  //m_Statistics.Reset();
<span style = "background-color:#fdd">}</span>

mitk::PointSetDifferenceStatisticsCalculator::PointSetDifferenceStatisticsCalculator(mitk::PointSet::Pointer pSet1, mitk::PointSet::Pointer pSet2)
<span style = "background-color:#fdd">{
  m_PointSet1 = pSet1;
  m_PointSet2 = pSet2;
  m_StatisticsCalculated = false;</span>
  //m_Statistics.Reset();
<span style = "background-color:#fdd">}</span>

mitk::PointSetDifferenceStatisticsCalculator::~PointSetDifferenceStatisticsCalculator()
<span style = "background-color:#fdd">{
}</span>

void mitk::PointSetDifferenceStatisticsCalculator::SetPointSets(mitk::PointSet::Pointer pSet1, mitk::PointSet::Pointer pSet2)
<span style = "background-color:#fdd">{
  if (pSet1.IsNotNull())</span>
  {
<span style = "background-color:#fdd">    m_PointSet1 = pSet1;</span>
  }
<span style = "background-color:#fdd">  if (pSet2.IsNotNull())</span>
  {
<span style = "background-color:#fdd">    m_PointSet2 = pSet2;</span>
  }
<span style = "background-color:#fdd">  m_StatisticsCalculated = false;</span>
  //m_Statistics.Reset();
<span style = "background-color:#fdd">}</span>

std::vector&lt;double&gt; mitk::PointSetDifferenceStatisticsCalculator::GetDifferences()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_DifferencesVector;
}</span>

std::vector&lt;double&gt; mitk::PointSetDifferenceStatisticsCalculator::GetSquaredDifferences()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_SquaredDifferencesVector;
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetMean()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::RealType&gt;(mitk::ImageStatisticsConstants::MEAN());
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetSD()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::RealType&gt;(mitk::ImageStatisticsConstants::STANDARDDEVIATION());
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetVariance()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::RealType&gt;(mitk::ImageStatisticsConstants::VARIANCE());
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetRMS()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::RealType&gt;(mitk::ImageStatisticsConstants::RMS());
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetMedian()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::RealType&gt;(mitk::ImageStatisticsConstants::MEDIAN());
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetMax()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::RealType&gt;(mitk::ImageStatisticsConstants::MAXIMUM());
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetMin()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::RealType&gt;(mitk::ImageStatisticsConstants::MINIMUM());
}</span>

double mitk::PointSetDifferenceStatisticsCalculator::GetNumberOfPoints()
<span style = "background-color:#fdd">{
  if (!m_StatisticsCalculated)</span>
  {
<span style = "background-color:#fdd">    this-&gt;ComputeStatistics();</span>
  }
<span style = "background-color:#fdd">  return m_Statistics.GetValueConverted&lt;ImageStatisticsContainer::VoxelCountType&gt;(mitk::ImageStatisticsConstants::NUMBEROFVOXELS());
}</span>

void mitk::PointSetDifferenceStatisticsCalculator::ComputeStatistics()
<span style = "background-color:#fdd">{
  if ((m_PointSet1.IsNull())||(m_PointSet2.IsNull()))</span>
  {
<span style = "background-color:#fdd">    itkExceptionMacro("Point sets specified are not valid. Please specify correct Point sets");
  }
  else if (m_PointSet1-&gt;GetSize()!=m_PointSet2-&gt;GetSize())</span>
  {
<span style = "background-color:#fdd">    itkExceptionMacro("PointSets are not equal. Please make sure that your PointSets have the same size and hold corresponding points.");
  }
  else if (m_PointSet1-&gt;GetSize()==0)</span>
  {
<span style = "background-color:#fdd">    itkExceptionMacro("There are no points in the PointSets. Please make sure that the PointSets contain points");
  }</span>
  else
  {
<span style = "background-color:#fdd">    double mean = 0.0;
    double sd = 0.0;
    double rms= 0.0;</span>

<span style = "background-color:#fdd">    std::vector&lt;double&gt; differencesVector;
    mitk::Point3D point1;
    mitk::Point3D point2;
    auto numberOfPoints = static_cast&lt;mitk::ImageStatisticsContainer::VoxelCountType&gt;(m_PointSet1-&gt;GetSize());</span>

    //Iterate over both pointsets in order to compare all points pair-wise
<span style = "background-color:#fdd">    mitk::PointSet::PointsIterator end = m_PointSet1-&gt;End();
    for( mitk::PointSet::PointsIterator pointSetIterator = m_PointSet1-&gt;Begin(), pointSetIterator2 = m_PointSet2-&gt;Begin();
         pointSetIterator != end; ++pointSetIterator, ++pointSetIterator2) //iterate simultaneously over both sets</span>
    {
<span style = "background-color:#fdd">      point1 = pointSetIterator.Value();
      point2 = pointSetIterator2.Value();</span>

<span style = "background-color:#fdd">      double squaredDistance = point1.SquaredEuclideanDistanceTo(point2);
      mean+=sqrt(squaredDistance);
      rms+=squaredDistance;
      this-&gt;m_SquaredDifferencesVector.push_back(squaredDistance);
      differencesVector.push_back(sqrt(squaredDistance));
    }</span>

<span style = "background-color:#fdd">    m_DifferencesVector = differencesVector;
    mean = mean/static_cast&lt;double&gt;(numberOfPoints);
    rms = sqrt(rms/ static_cast&lt;double&gt;(numberOfPoints));
    for (std::vector&lt;double&gt;::size_type i=0; i&lt;differencesVector.size(); i++)</span>
    {
<span style = "background-color:#fdd">      sd+=(differencesVector.at(i)-mean)*(differencesVector.at(i)-mean);
    }
    double variance = sd/ static_cast&lt;double&gt;(numberOfPoints);
    sd = sqrt(variance);
    std::sort(differencesVector.begin(),differencesVector.end());
    double median = 0.0;
    if (numberOfPoints%2 == 0)</span>
    {
<span style = "background-color:#fdd">      median = (differencesVector.at(numberOfPoints/2)+differencesVector.at(numberOfPoints/2-1))/2;
    }</span>
    else
    {
<span style = "background-color:#fdd">      median = differencesVector.at((numberOfPoints-1)/2+1);</span>
    }
<span style = "background-color:#fdd">    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::MEAN(), mean);
    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::STANDARDDEVIATION(), sd);
    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::VARIANCE(), sd*sd);
    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::RMS(), rms);
    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::MINIMUM(), differencesVector.at(0));
    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::MAXIMUM(), differencesVector.at(numberOfPoints - 1));
    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::MEDIAN(), median);
    m_Statistics.AddStatistic(mitk::ImageStatisticsConstants::NUMBEROFVOXELS(), numberOfPoints);</span>

<span style = "background-color:#fdd">    m_StatisticsCalculated = true;
  }
}</span></pre>
	</body>
</html>