<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkLabelStatisticsImageFilter.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

// This file is based on ITK's itkLabelStatisticsImageFilter.h

#ifndef mitkLabelStatisticsImageFilter_h
#define mitkLabelStatisticsImageFilter_h

#include &lt;itkCompensatedSummation.h&gt;
#include &lt;itkHistogram.h&gt;
#include &lt;itkImageSink.h&gt;
#include &lt;itkNumericTraits.h&gt;
#include &lt;itkSimpleDataObjectDecorator.h&gt;

#include &lt;mutex&gt;
#include &lt;unordered_map&gt;
#include &lt;vector&gt;

#include &lt;mitkLabel.h&gt;

namespace mitk
{
  template &lt;typename TInputImage&gt;
  class LabelStatisticsImageFilter : public itk::ImageSink&lt;TInputImage&gt;
  {
  public:
    using Self = LabelStatisticsImageFilter;
    using Superclass = itk::ImageSink&lt;TInputImage&gt;;
    using Pointer = itk::SmartPointer&lt;Self&gt;;
    using ConstPointer = itk::SmartPointer&lt;const Self&gt;;

<span style = "background-color:#fdd">    itkFactorylessNewMacro(Self);</span>

<span style = "background-color:#fdd">    itkTypeMacro(LabelStatisticsImageFilter, itk::ImageSink);</span>

    using IndexType = typename TInputImage::IndexType;
    using SizeType = typename TInputImage::SizeType;
    using RegionType = typename TInputImage::RegionType;
    using PixelType = typename TInputImage::PixelType;
    using LabelPixelType = typename mitk::Label::PixelType;

    static constexpr unsigned int ImageDimension = TInputImage::ImageDimension;

    using RealType = typename itk::NumericTraits&lt;PixelType&gt;::RealType;

    using DataObjectPointer = typename itk::DataObject::Pointer;

    using RealObjectType = itk::SimpleDataObjectDecorator&lt;RealType&gt;;

    using BoundingBoxType = std::vector&lt;itk::IndexValueType&gt;;

    using HistogramType = itk::Statistics::Histogram&lt;RealType&gt;;
    using HistogramPointer = typename HistogramType::Pointer;

    class LabelStatistics
    {
    public:
      LabelStatistics();
      LabelStatistics(unsigned int size, RealType lowerBound, RealType upperBound);
      ~LabelStatistics();

      itk::SizeValueType m_Count;
      itk::SizeValueType m_CountOfPositivePixels;
      RealType m_Min;
      RealType m_Max;
      RealType m_Mean;
      itk::CompensatedSummation&lt;RealType&gt; m_Sum;
      itk::CompensatedSummation&lt;RealType&gt; m_SumOfPositivePixels;
      itk::CompensatedSummation&lt;RealType&gt; m_SumOfSquares;
      itk::CompensatedSummation&lt;RealType&gt; m_SumOfCubes;
      itk::CompensatedSummation&lt;RealType&gt; m_SumOfQuadruples;
      RealType m_Sigma;
      RealType m_Variance;
      RealType m_MPP;
      RealType m_Median;
      RealType m_Uniformity;
      RealType m_UPP;
      RealType m_Entropy;
      RealType m_Skewness;
      RealType m_Kurtosis;
      BoundingBoxType m_BoundingBox;
      HistogramPointer m_Histogram;
    };

    using MapType = std::unordered_map&lt;LabelPixelType, LabelStatistics&gt;;
    using MapIterator = typename MapType::iterator;
    using MapConstIterator = typename MapType::const_iterator;

    using ValidLabelValuesContainerType = std::vector&lt;LabelPixelType&gt;;
    const ValidLabelValuesContainerType&amp; GetValidLabelValues() const;

    void SetHistogramParameters(
      const std::unordered_map&lt;LabelPixelType, unsigned int&gt;&amp; sizes,
      const std::unordered_map&lt;LabelPixelType, RealType&gt;&amp; lowerBounds,
      const std::unordered_map&lt;LabelPixelType, RealType&gt;&amp; upperBounds);

    using LabelImageType = itk::Image&lt;LabelPixelType, ImageDimension&gt;;
    using ProcessObject = itk::ProcessObject;

<span style = "background-color:#fdd">    itkSetInputMacro(LabelInput, LabelImageType);
    itkGetInputMacro(LabelInput, LabelImageType);</span>

    bool HasLabel(LabelPixelType label) const;
    unsigned int GetNumberOfObjects() const;
    unsigned int GetNumberOfLabels() const;

    PixelType GetMinimum(LabelPixelType label) const;
    PixelType GetMaximum(LabelPixelType label) const;
    RealType GetMean(LabelPixelType label) const;
    RealType GetSigma(LabelPixelType label) const;
    RealType GetVariance(LabelPixelType label) const;
    BoundingBoxType GetBoundingBox(LabelPixelType label) const;
    RegionType GetRegion(LabelPixelType label) const;
    RealType GetSum(LabelPixelType label) const;
    RealType GetSumOfSquares(LabelPixelType label) const;
    RealType GetSumOfCubes(LabelPixelType label) const;
    RealType GetSumOfQuadruples(LabelPixelType label) const;
    RealType GetSkewness(LabelPixelType label) const;
    RealType GetKurtosis(LabelPixelType label) const;
    RealType GetMPP(LabelPixelType label) const;
    itk::SizeValueType GetCount(LabelPixelType label) const;
    HistogramPointer GetHistogram(LabelPixelType label) const;
    RealType GetEntropy(LabelPixelType label) const;
    RealType GetUniformity(LabelPixelType label) const;
    RealType GetUPP(LabelPixelType label) const;
    RealType GetMedian(LabelPixelType label) const;

  protected:
    LabelStatisticsImageFilter();
    ~LabelStatisticsImageFilter();

    void BeforeStreamedGenerateData() override;
    void ThreadedStreamedGenerateData(const RegionType&amp;) override;
    void AfterStreamedGenerateData() override;

    void PrintSelf(std::ostream&amp; os, itk::Indent indent) const override;

  private:
    const LabelStatistics&amp; GetLabelStatistics(LabelPixelType label) const;
    const LabelStatistics&amp; GetLabelHistogramStatistics(LabelPixelType label) const;

    void MergeMap(MapType&amp; map1, MapType&amp; map2) const;

    MapType m_LabelStatistics;
    ValidLabelValuesContainerType m_ValidLabelValues;

    bool m_ComputeHistograms;
    std::unordered_map&lt;LabelPixelType, unsigned int&gt; m_HistogramSizes;
    std::unordered_map&lt;LabelPixelType, RealType&gt; m_HistogramLowerBounds;
    std::unordered_map&lt;LabelPixelType, RealType&gt; m_HistogramUpperBounds;

    std::mutex m_Mutex;
  };
}

#ifndef ITK_MANUAL_INSTANTIATION
#include &lt;mitkLabelStatisticsImageFilter.hxx&gt;
#endif

#endif</pre>
	</body>
</html>