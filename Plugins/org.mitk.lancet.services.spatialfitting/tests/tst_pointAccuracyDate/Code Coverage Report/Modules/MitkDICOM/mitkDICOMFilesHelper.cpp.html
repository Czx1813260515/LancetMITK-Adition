<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkDICOMFilesHelper.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkDICOMFilesHelper.h"

#include &lt;itkGDCMImageIO.h&gt;
#include &lt;itksys/SystemTools.hxx&gt;
#include &lt;gdcmDirectory.h&gt;
#include &lt;gdcmScanner.h&gt;

mitk::DICOMFilePathList mitk::GetDICOMFilesInSameDirectory(const std::string&amp; filePath)
<span style = "background-color:#fdd">{
  DICOMFilePathList result;</span>

<span style = "background-color:#fdd">  if (!filePath.empty())</span>
  {

<span style = "background-color:#fdd">    std::string dir = filePath;
    if (!itksys::SystemTools::FileIsDirectory(filePath))</span>
    {
<span style = "background-color:#fdd">      dir = itksys::SystemTools::GetFilenamePath(filePath);</span>
    }

<span style = "background-color:#fdd">    gdcm::Directory directoryLister;
    directoryLister.Load(dir.c_str(), false); // non-recursive
    result = FilterForDICOMFiles(directoryLister.GetFilenames());
  }</span>

<span style = "background-color:#fdd">  return result;
};</span>

mitk::DICOMFilePathList mitk::FilterForDICOMFiles(const DICOMFilePathList&amp; fileList)
<span style = "background-color:#fdd">{
  mitk::DICOMFilePathList result;</span>

<span style = "background-color:#fdd">  itk::GDCMImageIO::Pointer io = itk::GDCMImageIO::New();
  for (const auto &amp;aFile : fileList)</span>
  {
<span style = "background-color:#fdd">    if (io-&gt;CanReadFile(aFile.c_str()))</span>
    {
<span style = "background-color:#fdd">      result.push_back(aFile);</span>
    }
<span style = "background-color:#fdd">  }</span>

<span style = "background-color:#fdd">  return result;
};</span>

mitk::DICOMFilePathList mitk::FilterDICOMFilesForSameSeries(const std::string&amp; refFilePath, const DICOMFilePathList&amp; fileList)
<span style = "background-color:#fdd">{
  auto dicomFiles = FilterForDICOMFiles(fileList);</span>

  //use the gdcm scanner directly instead of our wrapping classes, as it is a very simple task
  //and I want to spare the indirection/overhead.
<span style = "background-color:#fdd">  gdcm::Scanner scanner;</span>

<span style = "background-color:#fdd">  const gdcm::Tag seriesInstanceUIDTag(0x0020, 0x000e);</span>

<span style = "background-color:#fdd">  scanner.AddTag(seriesInstanceUIDTag); //Series Instance UID;</span>

<span style = "background-color:#fdd">  scanner.Scan({ refFilePath });
  auto uid = scanner.GetValue(refFilePath.c_str(), seriesInstanceUIDTag);</span>
  
<span style = "background-color:#fdd">  if (uid != nullptr)</span>
  {
<span style = "background-color:#fdd">    const std::string refUID = uid;
    scanner.Scan(dicomFiles);
    return scanner.GetAllFilenamesFromTagToValue(seriesInstanceUIDTag, refUID.c_str());</span>
  }

<span style = "background-color:#fdd">  return mitk::DICOMFilePathList();
}</span></pre>
	</body>
</html>