<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkLabelSetImageSurfaceStampFilter.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkLabelSetImageSurfaceStampFilter.h"

#include "mitkImageAccessByItk.h"
#include "mitkImageCast.h"

#include &lt;mitkLabelSetImage.h&gt;
#include &lt;mitkLabelSetImage.h&gt;
#include &lt;mitkSurface.h&gt;
#include &lt;mitkSurfaceToImageFilter.h&gt;

<span style = "background-color:#fdd">mitk::LabelSetImageSurfaceStampFilter::LabelSetImageSurfaceStampFilter() : m_ForceOverwrite(false)
{
  this-&gt;SetNumberOfIndexedInputs(1);
  this-&gt;SetNumberOfRequiredInputs(1);
}</span>

mitk::LabelSetImageSurfaceStampFilter::~LabelSetImageSurfaceStampFilter()
<span style = "background-color:#fdd">{
}</span>

void mitk::LabelSetImageSurfaceStampFilter::GenerateData()
<span style = "background-color:#fdd">{</span>
  // GenerateOutputInformation();
<span style = "background-color:#fdd">  this-&gt;SetNthOutput(0, this-&gt;GetInput(0));</span>

<span style = "background-color:#fdd">  mitk::Image::Pointer inputImage = this-&gt;GetInput(0);</span>

<span style = "background-color:#fdd">  if (m_Surface.IsNull())</span>
  {
<span style = "background-color:#fdd">    MITK_ERROR &lt;&lt; "Input surface is nullptr.";
    return;</span>
  }

<span style = "background-color:#fdd">  mitk::SurfaceToImageFilter::Pointer surfaceToImageFilter = mitk::SurfaceToImageFilter::New();
  surfaceToImageFilter-&gt;MakeOutputBinaryOn();
  surfaceToImageFilter-&gt;SetInput(m_Surface);
  surfaceToImageFilter-&gt;SetImage(inputImage);
  surfaceToImageFilter-&gt;Update();
  mitk::Image::Pointer resultImage = surfaceToImageFilter-&gt;GetOutput();</span>

<span style = "background-color:#fdd">  AccessByItk_1(inputImage, ItkImageProcessing, resultImage);
  inputImage-&gt;DisconnectPipeline();
}</span>

template &lt;typename TPixel, unsigned int VImageDimension&gt;
void mitk::LabelSetImageSurfaceStampFilter::ItkImageProcessing(itk::Image&lt;TPixel, VImageDimension&gt; *itkImage,
                                                               mitk::Image::Pointer resultImage)
<span style = "background-color:#fdd">{</span>
  typedef itk::Image&lt;TPixel, VImageDimension&gt; ImageType;
<span style = "background-color:#fdd">  mitk::LabelSetImage::Pointer LabelSetInputImage = dynamic_cast&lt;LabelSetImage *&gt;(GetInput());</span>
  try
  {
<span style = "background-color:#fdd">    typename ImageType::Pointer itkResultImage = ImageType::New();
    mitk::CastToItkImage(resultImage, itkResultImage);</span>

    typedef itk::ImageRegionConstIterator&lt;ImageType&gt; SourceIteratorType;
    typedef itk::ImageRegionIterator&lt;ImageType&gt; TargetIteratorType;

<span style = "background-color:#fdd">    SourceIteratorType sourceIter(itkResultImage, itkResultImage-&gt;GetLargestPossibleRegion());
    sourceIter.GoToBegin();</span>

<span style = "background-color:#fdd">    TargetIteratorType targetIter(itkImage, itkImage-&gt;GetLargestPossibleRegion());
    targetIter.GoToBegin();</span>

<span style = "background-color:#fdd">    int activeLabel = (LabelSetInputImage-&gt;GetActiveLabel(LabelSetInputImage-&gt;GetActiveLayer()))-&gt;GetValue();</span>

<span style = "background-color:#fdd">    while (!sourceIter.IsAtEnd())</span>
    {
<span style = "background-color:#fdd">      auto sourceValue = static_cast&lt;int&gt;(sourceIter.Get());
      auto targetValue = static_cast&lt;int&gt;(targetIter.Get());</span>

<span style = "background-color:#fdd">      if ((sourceValue != 0) &amp;&amp;</span>
          (m_ForceOverwrite ||
           !LabelSetInputImage-&gt;GetLabel(targetValue)-&gt;GetLocked())) // skip exterior and locked labels
      {
<span style = "background-color:#fdd">        targetIter.Set(activeLabel);</span>
      }
<span style = "background-color:#fdd">      ++sourceIter;
      ++targetIter;
    }
  }</span>
  catch (itk::ExceptionObject &amp;e)
<span style = "background-color:#fdd">  {
    mitkThrow() &lt;&lt; e.GetDescription();
  }
  this-&gt;Modified();
}</span>

void mitk::LabelSetImageSurfaceStampFilter::GenerateOutputInformation()
<span style = "background-color:#fdd">{
  mitk::Image::Pointer inputImage = (mitk::Image *)this-&gt;GetInput();
  mitk::Image::Pointer output = this-&gt;GetOutput();
  itkDebugMacro(&lt;&lt; "GenerateOutputInformation()");
  if (inputImage.IsNull())
    return;
}</span></pre>
	</body>
</html>