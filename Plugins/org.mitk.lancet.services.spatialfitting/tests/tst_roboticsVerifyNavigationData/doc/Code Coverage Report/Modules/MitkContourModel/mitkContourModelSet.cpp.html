<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkContourModelSet.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/
#include &lt;algorithm&gt;
#include &lt;mitkContourModelSet.h&gt;
#include &lt;vtkMath.h&gt;

<span style = "background-color:#fdd">mitk::ContourModelSet::ContourModelSet() : m_Contours(), m_UpdateBoundingBox(true)
{
  this-&gt;InitializeEmpty();
}</span>

mitk::ContourModelSet::ContourModelSet(const mitk::ContourModelSet &amp;other)
<span style = "background-color:#fdd">  : mitk::BaseData(other), m_Contours(other.m_Contours)
{
  this-&gt;InitializeTimeGeometry(1);
}</span>

mitk::ContourModelSet::~ContourModelSet()
<span style = "background-color:#fdd">{
  this-&gt;m_Contours.clear();
}</span>

void mitk::ContourModelSet::InitializeEmpty()
<span style = "background-color:#fdd">{
  this-&gt;InitializeTimeGeometry(1);
  m_Contours.resize(0);
}</span>

void mitk::ContourModelSet::AddContourModel(mitk::ContourModel &amp;contourModel)
<span style = "background-color:#fdd">{
  this-&gt;m_Contours.push_back(&amp;contourModel);
  m_UpdateBoundingBox = true;
}</span>

void mitk::ContourModelSet::AddContourModel(mitk::ContourModel::Pointer contourModel)
<span style = "background-color:#fdd">{
  this-&gt;m_Contours.push_back(contourModel);
  m_UpdateBoundingBox = true;
}</span>

mitk::ContourModel *mitk::ContourModelSet::GetContourModelAt(int index) const
<span style = "background-color:#fdd">{
  if (index &gt;= 0 &amp;&amp; static_cast&lt;ContourModelListType::size_type&gt;(index) &lt; this-&gt;m_Contours.size())</span>
  {
<span style = "background-color:#fdd">    return this-&gt;m_Contours.at(index).GetPointer();
  }</span>
  else
  {
<span style = "background-color:#fdd">    return nullptr;</span>
  }
<span style = "background-color:#fdd">}</span>

bool mitk::ContourModelSet::IsEmpty() const
<span style = "background-color:#fdd">{
  return this-&gt;m_Contours.empty();
}</span>

mitk::ContourModelSet::ContourModelListType *mitk::ContourModelSet::GetContourModelList()
<span style = "background-color:#fdd">{
  return &amp;(this-&gt;m_Contours);
}</span>

bool mitk::ContourModelSet::RemoveContourModel(mitk::ContourModel *contourModel)
<span style = "background-color:#fdd">{
  auto it = this-&gt;m_Contours.begin();</span>

<span style = "background-color:#fdd">  auto end = this-&gt;m_Contours.end();</span>

  // search for ContourModel and remove it if exists
<span style = "background-color:#fdd">  while (it != end)</span>
  {
<span style = "background-color:#fdd">    if ((*it) == contourModel)</span>
    {
<span style = "background-color:#fdd">      this-&gt;m_Contours.erase(it);
      m_UpdateBoundingBox = true;
      return true;</span>
    }

<span style = "background-color:#fdd">    it++;
  }</span>

<span style = "background-color:#fdd">  return false;
}</span>

bool mitk::ContourModelSet::RemoveContourModelAt(int index)
<span style = "background-color:#fdd">{
  if (index &gt;= 0 &amp;&amp; static_cast&lt;ContourModelListType::size_type&gt;(index) &lt; this-&gt;m_Contours.size())</span>
  {
<span style = "background-color:#fdd">    this-&gt;m_Contours.erase(this-&gt;m_Contours.begin() + index);
    m_UpdateBoundingBox = true;
    return true;
  }</span>
  else
  {
<span style = "background-color:#fdd">    return false;</span>
  }
<span style = "background-color:#fdd">}</span>

void mitk::ContourModelSet::Clear()
<span style = "background-color:#fdd">{
  this-&gt;m_Contours.clear();
  m_UpdateBoundingBox = true;
}</span>

void mitk::ContourModelSet::UpdateOutputInformation()
<span style = "background-color:#fdd">{
  if (this-&gt;GetSource())</span>
  {
<span style = "background-color:#fdd">    this-&gt;GetSource()-&gt;UpdateOutputInformation();</span>
  }

<span style = "background-color:#fdd">  if (this-&gt;m_UpdateBoundingBox)</span>
  {
    // update the bounds of the geometry according to the stored vertices
    mitk::ScalarType mitkBounds[6];

    // calculate the boundingbox at each timestep
    typedef itk::BoundingBox&lt;unsigned long, 3, ScalarType&gt; BoundingBoxType;
    typedef BoundingBoxType::PointsContainer PointsContainer;

<span style = "background-color:#fdd">    int timesteps = this-&gt;GetTimeSteps();</span>

    // iterate over the timesteps
<span style = "background-color:#fdd">    for (int currenTimeStep = 0; currenTimeStep &lt; timesteps; currenTimeStep++)</span>
    {
      // only update bounds if the contour was modified
<span style = "background-color:#fdd">      if (this-&gt;GetMTime() &gt; this-&gt;GetGeometry(currenTimeStep)-&gt;GetBoundingBox()-&gt;GetMTime())</span>
      {
<span style = "background-color:#fdd">        mitkBounds[0] = 0.0;
        mitkBounds[1] = 0.0;
        mitkBounds[2] = 0.0;
        mitkBounds[3] = 0.0;
        mitkBounds[4] = 0.0;
        mitkBounds[5] = 0.0;</span>

<span style = "background-color:#fdd">        BoundingBoxType::Pointer boundingBox = BoundingBoxType::New();</span>

<span style = "background-color:#fdd">        PointsContainer::Pointer points = PointsContainer::New();</span>

<span style = "background-color:#fdd">        auto contoursIt = this-&gt;Begin();
        auto contoursEnd = this-&gt;End();</span>

<span style = "background-color:#fdd">        while (contoursIt != contoursEnd)</span>
        {
<span style = "background-color:#fdd">          auto it = contoursIt-&gt;GetPointer()-&gt;Begin(currenTimeStep);
          auto end = contoursIt-&gt;GetPointer()-&gt;End(currenTimeStep);</span>

          // fill the boundingbox with the points
<span style = "background-color:#fdd">          while (it != end)</span>
          {
<span style = "background-color:#fdd">            Point3D currentP = (*it)-&gt;Coordinates;</span>
            BoundingBoxType::PointType p;
<span style = "background-color:#fdd">            p.CastFrom(currentP);
            points-&gt;InsertElement(points-&gt;Size(), p);</span>

<span style = "background-color:#fdd">            it++;
          }</span>

<span style = "background-color:#fdd">          ++contoursIt;
        }</span>

        // construct the new boundingBox
<span style = "background-color:#fdd">        boundingBox-&gt;SetPoints(points);
        boundingBox-&gt;ComputeBoundingBox();
        BoundingBoxType::BoundsArrayType tmp = boundingBox-&gt;GetBounds();
        mitkBounds[0] = tmp[0];
        mitkBounds[1] = tmp[1];
        mitkBounds[2] = tmp[2];
        mitkBounds[3] = tmp[3];
        mitkBounds[4] = tmp[4];
        mitkBounds[5] = tmp[5];</span>

        // set boundingBox at current timestep
<span style = "background-color:#fdd">        BaseGeometry *geometry3d = this-&gt;GetGeometry(currenTimeStep);
        geometry3d-&gt;SetBounds(mitkBounds);
      }
    }</span>

<span style = "background-color:#fdd">    this-&gt;m_UpdateBoundingBox = false;</span>
  }
<span style = "background-color:#fdd">  GetTimeGeometry()-&gt;Update();
}</span></pre>
	</body>
</html>