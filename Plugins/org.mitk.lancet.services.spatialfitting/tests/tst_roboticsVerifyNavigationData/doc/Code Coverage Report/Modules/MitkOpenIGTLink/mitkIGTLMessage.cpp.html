<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkIGTLMessage.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkIGTLMessage.h"
#include "mitkException.h"
#include "mitkIGTLMessageCommon.h"

<span style = "background-color:#fdd">mitk::IGTLMessage::IGTLMessage() : itk::DataObject(),
  m_DataValid(false), m_IGTTimeStamp(0), m_Name()
{
  m_Message = igtl::MessageBase::New();
}</span>


mitk::IGTLMessage::IGTLMessage(const mitk::IGTLMessage&amp; toCopy) :
<span style = "background-color:#fdd">  itk::DataObject()
{</span>
  // TODO SW: Graft does the same, remove code duplications, set Graft to
  // deprecated, remove duplication in tescode
<span style = "background-color:#fdd">  this-&gt;Graft(&amp;toCopy);
}</span>

mitk::IGTLMessage::~IGTLMessage()
<span style = "background-color:#fdd">{
}</span>

mitk::IGTLMessage::IGTLMessage(igtl::MessageBase::Pointer message)
<span style = "background-color:#fdd">{
  this-&gt;SetMessage(message);
  this-&gt;SetName(message-&gt;GetDeviceName());
}</span>

void mitk::IGTLMessage::Graft( const DataObject *data )
<span style = "background-color:#fdd">{</span>
  // Attempt to cast data to an IGTLMessage
  const Self* msg;
  try
  {
<span style = "background-color:#fdd">    msg = dynamic_cast&lt;const Self *&gt;(data);</span>
  }
  catch( ... )
<span style = "background-color:#fdd">  {
    itkExceptionMacro( &lt;&lt; "mitk::IGTLMessage::Graft cannot cast "</span>
                       &lt;&lt; typeid(data).name() &lt;&lt; " to "
                       &lt;&lt; typeid(const Self *).name() );
<span style = "background-color:#fdd">    return;
  }
  if (!msg)</span>
  {
    // pointer could not be cast back down
<span style = "background-color:#fdd">    itkExceptionMacro( &lt;&lt; "mitk::IGTLMessage::Graft cannot cast "</span>
                       &lt;&lt; typeid(data).name() &lt;&lt; " to "
                       &lt;&lt; typeid(const Self *).name() );
<span style = "background-color:#fdd">    return;</span>
  }
  // Now copy anything that is needed
<span style = "background-color:#fdd">  this-&gt;SetMessage(msg-&gt;GetMessage());
  this-&gt;SetDataValid(msg-&gt;IsDataValid());
  this-&gt;SetIGTTimeStamp(msg-&gt;GetIGTTimeStamp());
  this-&gt;SetName(msg-&gt;GetName());
}</span>

void mitk::IGTLMessage::SetMessage(igtl::MessageBase::Pointer msg)
<span style = "background-color:#fdd">{
  m_Message = msg;
  unsigned int ts = 0;
  unsigned int frac = 0;
  m_Message-&gt;GetTimeStamp(&amp;ts, &amp;frac); //ts = seconds / frac = nanoseconds
  this-&gt;SetName(m_Message-&gt;GetDeviceName());
  double timestamp = ts * 1000.0 + frac;
  this-&gt;SetIGTTimeStamp(timestamp);
  this-&gt;SetDataValid(true);
}</span>

bool mitk::IGTLMessage::IsDataValid() const
<span style = "background-color:#fdd">{
  return m_DataValid;
}</span>


void mitk::IGTLMessage::PrintSelf(std::ostream&amp; os, itk::Indent indent) const
<span style = "background-color:#fdd">{
  os &lt;&lt; indent &lt;&lt; "name: "           &lt;&lt; this-&gt;GetName() &lt;&lt; std::endl;
  os &lt;&lt; indent &lt;&lt; "type: "           &lt;&lt; this-&gt;GetIGTLMessageType() &lt;&lt; std::endl;
  os &lt;&lt; indent &lt;&lt; "valid: "     &lt;&lt; this-&gt;IsDataValid() &lt;&lt; std::endl;
  os &lt;&lt; indent &lt;&lt; "timestamp: "      &lt;&lt; this-&gt;GetIGTTimeStamp() &lt;&lt; std::endl;
  os &lt;&lt; indent &lt;&lt; "OpenIGTLinkMessage: " &lt;&lt; std::endl;
  m_Message-&gt;Print(os);
  this-&gt;Superclass::PrintSelf(os, indent);
}</span>

std::string mitk::IGTLMessage::ToString() const
<span style = "background-color:#fdd">{
  std::stringstream output;
  this-&gt;Print(output);
  return output.str();
}</span>


void mitk::IGTLMessage::CopyInformation( const DataObject* data )
<span style = "background-color:#fdd">{
  this-&gt;Superclass::CopyInformation( data );</span>

<span style = "background-color:#fdd">  const Self * nd = nullptr;</span>
  try
  {
<span style = "background-color:#fdd">    nd = dynamic_cast&lt;const Self*&gt;(data);</span>
  }
  catch( ... )
<span style = "background-color:#fdd">  {</span>
    // data could not be cast back down
<span style = "background-color:#fdd">    itkExceptionMacro(&lt;&lt; "mitk::IGTLMessage::CopyInformation() cannot cast "</span>
                      &lt;&lt; typeid(data).name() &lt;&lt; " to "
                      &lt;&lt; typeid(Self*).name() );
<span style = "background-color:#fdd">  }
  if ( !nd )</span>
  {
    // pointer could not be cast back down
<span style = "background-color:#fdd">    itkExceptionMacro(&lt;&lt; "mitk::IGTLMessage::CopyInformation() cannot cast "</span>
                      &lt;&lt; typeid(data).name() &lt;&lt; " to "
                      &lt;&lt; typeid(Self*).name() );
  }
  /* copy all meta data */
<span style = "background-color:#fdd">}</span>

bool mitk::Equal(const mitk::IGTLMessage&amp; leftHandSide,
                 const mitk::IGTLMessage&amp; rightHandSide,
                 ScalarType /*eps*/, bool verbose)
<span style = "background-color:#fdd">{
  bool returnValue = true;</span>

<span style = "background-color:#fdd">  if( std::string(rightHandSide.GetName()) != std::string(leftHandSide.GetName()) )</span>
  {
<span style = "background-color:#fdd">    if(verbose)</span>
    {
<span style = "background-color:#fdd">      MITK_INFO &lt;&lt; "[( IGTLMessage )] Name differs.";
      MITK_INFO &lt;&lt; "leftHandSide is " &lt;&lt; leftHandSide.GetName()</span>
                &lt;&lt; "rightHandSide is " &lt;&lt; rightHandSide.GetName();
    }
<span style = "background-color:#fdd">    returnValue = false;</span>
  }

<span style = "background-color:#fdd">  if( rightHandSide.GetIGTTimeStamp() != leftHandSide.GetIGTTimeStamp() )</span>
  {
<span style = "background-color:#fdd">    if(verbose)</span>
    {
<span style = "background-color:#fdd">      MITK_INFO &lt;&lt; "[( IGTLMessage )] IGTTimeStamp differs.";
      MITK_INFO &lt;&lt; "leftHandSide is " &lt;&lt; leftHandSide.GetIGTTimeStamp()</span>
                &lt;&lt; "rightHandSide is " &lt;&lt; rightHandSide.GetIGTTimeStamp();
    }
<span style = "background-color:#fdd">    returnValue = false;</span>
  }

<span style = "background-color:#fdd">  return returnValue;
}</span>

const char* mitk::IGTLMessage::GetIGTLMessageType() const
<span style = "background-color:#fdd">{
  return this-&gt;m_Message-&gt;GetDeviceType();
}</span>

template &lt; typename IGTLMessageType &gt;
IGTLMessageType* mitk::IGTLMessage::GetMessage() const
{
  return dynamic_cast&lt;IGTLMessageType*&gt;(this-&gt;m_Message);
}</pre>
	</body>
</html>