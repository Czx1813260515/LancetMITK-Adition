<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkRTPlanReaderService.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/


#include &lt;mitkRTPlanReaderService.h&gt;

#include &lt;mitkImage.h&gt;
#include &lt;mitkDICOMDCMTKTagScanner.h&gt;
#include &lt;mitkIOMimeTypes.h&gt;
#include &lt;mitkDICOMIOHelper.h&gt;
#include &lt;mitkDICOMTagPath.h&gt;
#include &lt;mitkIDICOMTagsOfInterest.h&gt;
#include &lt;mitkDICOMDatasetAccessingImageFrameInfo.h&gt;
#include &lt;mitkDICOMRTMimeTypes.h&gt;


namespace mitk
{

<span style = "background-color:#dfd">  RTPlanReaderService::RTPlanReaderService() : AbstractFileReader(CustomMimeType(mitk::DICOMRTMimeTypes::DICOMRT_PLAN_MIMETYPE_NAME()), mitk::DICOMRTMimeTypes::DICOMRT_PLAN_MIMETYPE_DESCRIPTION()) {
    m_FileReaderServiceReg = RegisterService();</span>

<span style = "background-color:#dfd">  }</span>

<span style = "background-color:#fdd">  RTPlanReaderService::RTPlanReaderService(const RTPlanReaderService&amp; other) : mitk::AbstractFileReader(other)
  {
  }</span>

<span style = "background-color:#dfd">  RTPlanReaderService::~RTPlanReaderService() {}</span>

  std::vector&lt;itk::SmartPointer&lt;BaseData&gt; &gt; RTPlanReaderService::DoRead()
<span style = "background-color:#fdd">  {
    std::vector&lt;itk::SmartPointer&lt;mitk::BaseData&gt; &gt; result;
    auto DICOMTagsOfInterestService = GetDicomTagsOfInterestService();
    auto tagsOfInterest = DICOMTagsOfInterestService-&gt;GetTagsOfInterest();
    DICOMTagPathList tagsOfInterestList;
    for (const auto&amp; tag : tagsOfInterest) {
      tagsOfInterestList.push_back(tag.first);
    }</span>

<span style = "background-color:#fdd">    std::string location = GetInputLocation();
    mitk::StringList files = { location };
    mitk::DICOMDCMTKTagScanner::Pointer scanner = mitk::DICOMDCMTKTagScanner::New();
    scanner-&gt;SetInputFiles(files);
    scanner-&gt;AddTagPaths(tagsOfInterestList);
    scanner-&gt;Scan();</span>

<span style = "background-color:#fdd">    mitk::DICOMDatasetAccessingImageFrameList frames = scanner-&gt;GetFrameInfoList();
    if (frames.empty()) {
      MITK_ERROR &lt;&lt; "Error reading the RTPLAN file" &lt;&lt; std::endl;
      return result;</span>
    }

<span style = "background-color:#fdd">    auto findings = ExtractPathsOfInterest(tagsOfInterestList, frames);</span>

    //just create empty image. No image information available in RTPLAN. But properties will be attached.
<span style = "background-color:#fdd">    Image::Pointer dummyImage = Image::New();
    mitk::PixelType pt = mitk::MakeScalarPixelType&lt;int&gt;();
    unsigned int dim[] = { 1,1};
    dummyImage-&gt;Initialize(pt, 2, dim);
    SetProperties(dummyImage, findings);</span>

<span style = "background-color:#fdd">    result.push_back(dummyImage.GetPointer());</span>

<span style = "background-color:#fdd">    return result;
  }</span>

  RTPlanReaderService* RTPlanReaderService::Clone() const
<span style = "background-color:#fdd">  {
    return new RTPlanReaderService(*this);
  }</span>

}</pre>
	</body>
</html>