<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkCoreServices.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#ifndef MITKCORESERVICES_H
#define MITKCORESERVICES_H

#include "MitkCoreExports.h"

#include &lt;mitkCommon.h&gt;
#include &lt;mitkLogMacros.h&gt;

#include &lt;mitkServiceInterface.h&gt;
#include &lt;usGetModuleContext.h&gt;
#include &lt;usModuleContext.h&gt;
#include &lt;usServiceReference.h&gt;

#include &lt;cassert&gt;

namespace mitk
{
  struct IMimeTypeProvider;
  class IPropertyAliases;
  class IPropertyDescriptions;
  class IPropertyExtensions;
  class IPropertyFilters;
  class IPropertyPersistence;
  class IPropertyRelations;

  /**
   * @brief Access MITK core services.
   *
   * This class can be used to conveniently access common
   * MITK Core service objects. Some getter methods where implementations
   * exist in the core library are guaranteed to return a non-nullptr service object.
   *
   * To ensure that CoreServices::Unget() is called after the caller
   * has finished using a service object, you should use the CoreServicePointer
   * helper class which calls Unget() when it goes out of scope:
   *
   * \code
   * CoreServicePointer&lt;IShaderRepository&gt; shaderRepo(CoreServices::GetShaderRepository());
   * // Do something with shaderRepo
   * \endcode
   *
   * @see CoreServicePointer
   */
  class MITKCORE_EXPORT CoreServices
  {
  public:

    /**
     * @brief Get an IPropertyAliases instance.
     * @param context The module context of the module getting the service.
     * @return A non-nullptr IPropertyAliases instance.
     */
    static IPropertyAliases *GetPropertyAliases(us::ModuleContext *context = us::GetModuleContext());

    /**
     * @brief Get an IPropertyDescriptions instance.
     * @param context The module context of the module getting the service.
     * @return A non-nullptr IPropertyDescriptions instance.
     */
    static IPropertyDescriptions *GetPropertyDescriptions(us::ModuleContext *context = us::GetModuleContext());

    /**
     * @brief Get an IPropertyExtensions instance.
     * @param context The module context of the module getting the service.
     * @return A non-nullptr IPropertyExtensions instance.
     */
    static IPropertyExtensions *GetPropertyExtensions(us::ModuleContext *context = us::GetModuleContext());

    /**
     * @brief Get an IPropertyFilters instance.
     * @param context The module context of the module getting the service.
     * @return A non-nullptr IPropertyFilters instance.
     */
    static IPropertyFilters *GetPropertyFilters(us::ModuleContext *context = us::GetModuleContext());

    /**
    * @brief Get an IPropertyPersistence instance.
    * @param context The module context of the module getting the service.
    * @return A non-nullptr IPropertyPersistence instance.
    */
    static IPropertyPersistence *GetPropertyPersistence(us::ModuleContext *context = us::GetModuleContext());

    /**
    * @brief Get an IPropertyRelations instance.
    * @param context The module context of the module getting the service.
    * @return A non-nullptr IPropertyRelations instance.
    */
    static IPropertyRelations *GetPropertyRelations(us::ModuleContext *context = us::GetModuleContext());

    /**
     * @brief Get an IMimeTypeProvider instance.
     * @param context The module context of the module getting the service.
     * @return A non-nullptr IMimeTypeProvider instance.
     */
    static IMimeTypeProvider *GetMimeTypeProvider(us::ModuleContext *context = us::GetModuleContext());

    /**
     * @brief Unget a previously acquired service instance.
     * @param service The service instance to be released.
     * @param context
     * @return \c true if ungetting the service was successful, \c false otherwise.
     */
    template &lt;class S&gt;
    static bool Unget(S *service, us::ModuleContext *context = us::GetModuleContext())
<span style = "background-color:#dfd">    {
      return Unget(context, us_service_interface_iid&lt;S&gt;(), service);
    }</span>

  private:
    static bool Unget(us::ModuleContext *context, const std::string &amp;interfaceId, void *service);

    // purposely not implemented
    CoreServices();
    CoreServices(const CoreServices &amp;);
    CoreServices &amp;operator=(const CoreServices &amp;);
  };

  /**
   * @brief A RAII helper class for core service objects.
   *
   * This is class is intended for usage in local scopes; it calls
   * CoreServices::Unget(S*) in its destructor. You should not construct
   * multiple CoreServicePointer instances using the same service pointer,
   * unless it is retrieved by a new call to a CoreServices getter method.
   *
   * @see CoreServices
   */
  template &lt;class S&gt;
  class MITK_LOCAL CoreServicePointer
  {
  public:
    explicit CoreServicePointer(S *service, us::ModuleContext* context = us::GetModuleContext())
<span style = "background-color:#dfd">      : m_Service(service),
        m_Context(context)
    {
      assert(service);
    }</span>

    ~CoreServicePointer()
<span style = "background-color:#dfd">    {</span>
      try
      {
<span style = "background-color:#dfd">        CoreServices::Unget(m_Service, m_Context);</span>
      }
      catch (const std::exception &amp;e)
<span style = "background-color:#fdd">      {
        MITK_ERROR &lt;&lt; e.what();
      }</span>
      catch (...)
<span style = "background-color:#fdd">      {
        MITK_ERROR &lt;&lt; "Ungetting core service failed.";
      }</span>
<span style = "background-color:#dfd">    }</span>

    S *operator-&gt;() const
<span style = "background-color:#dfd">    {
      return m_Service;
    }</span>

  private:
    S *const m_Service;
    us::ModuleContext* m_Context;
  };
}

#endif // MITKCORESERVICES_H</pre>
	</body>
</html>