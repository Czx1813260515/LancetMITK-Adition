<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkVtkGLMapperWrapper.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkVtkGLMapperWrapper.h"

// mitk includes
#include "mitkDataNode.h"
#include "mitkGL.h"
#include "vtkGLMapperProp.h"

// constructor LocalStorage
mitk::VtkGLMapperWrapper::LocalStorage::LocalStorage()
<span style = "background-color:#fdd">{
  m_GLMapperProp = vtkSmartPointer&lt;vtkGLMapperProp&gt;::New();
}</span>
// destructor LocalStorage
mitk::VtkGLMapperWrapper::LocalStorage::~LocalStorage()
<span style = "background-color:#fdd">{
}</span>

// constructor VtkGLMapperWrapper
mitk::VtkGLMapperWrapper::VtkGLMapperWrapper(GLMapper::Pointer mitkGLMapper)
<span style = "background-color:#fdd">{
  m_MitkGLMapper = mitkGLMapper;
}</span>

// destructor
mitk::VtkGLMapperWrapper::~VtkGLMapperWrapper()
<span style = "background-color:#fdd">{
}</span>

// returns propassembly
vtkProp *mitk::VtkGLMapperWrapper::GetVtkProp(mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  LocalStorage *ls = m_LSH.GetLocalStorage(renderer);
  return ls-&gt;m_GLMapperProp;
}</span>

void mitk::VtkGLMapperWrapper::GenerateDataForRenderer(mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  LocalStorage *ls = m_LSH.GetLocalStorage(renderer);
  ls-&gt;m_GLMapperProp-&gt;SetBaseRenderer(renderer);
  ls-&gt;m_GLMapperProp-&gt;SetWrappedGLMapper(m_MitkGLMapper);
}</span>

void mitk::VtkGLMapperWrapper::ApplyColorAndOpacityProperties(mitk::BaseRenderer *renderer, vtkActor *actor)
<span style = "background-color:#fdd">{
  m_MitkGLMapper-&gt;ApplyColorAndOpacityProperties(renderer, actor);
}</span>

void mitk::VtkGLMapperWrapper::MitkRender(mitk::BaseRenderer *renderer, mitk::VtkPropRenderer::RenderType type)
<span style = "background-color:#fdd">{
  if (type != mitk::VtkPropRenderer::Opaque)
    return;
  Enable2DOpenGL(renderer);
  Superclass::MitkRender(renderer, type);
  Disable2DOpenGL();
}</span>

void mitk::VtkGLMapperWrapper::Update(mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  Superclass::Update(renderer);
  m_MitkGLMapper-&gt;Update(renderer);
}</span>

void mitk::VtkGLMapperWrapper::SetDataNode(mitk::DataNode *node)
<span style = "background-color:#fdd">{
  m_MitkGLMapper-&gt;SetDataNode(node);
}</span>

mitk::DataNode *mitk::VtkGLMapperWrapper::GetDataNode() const
<span style = "background-color:#fdd">{
  return m_MitkGLMapper-&gt;GetDataNode();
}</span>

/*!
\brief
Enable2DOpenGL() and Disable2DOpenGL() are used to switch between 2D rendering (orthographic projection) and 3D
rendering (perspective projection)
*/
void mitk::VtkGLMapperWrapper::Enable2DOpenGL(mitk::BaseRenderer *)
<span style = "background-color:#fdd">{</span>
  GLint vp[4];

  // Get a copy of the viewport
<span style = "background-color:#fdd">  glGetIntegerv(GL_VIEWPORT, vp);</span>

  // Save a copy of the projection matrix so that we can restore it
  // when it's time to do 3D rendering again.
<span style = "background-color:#fdd">  glMatrixMode(GL_PROJECTION);
  glPushMatrix();
  glLoadIdentity();</span>

<span style = "background-color:#fdd">  glOrtho(vp[0], vp[2] + vp[0], vp[1], vp[3] + vp[1], -2000, 2000);</span>

<span style = "background-color:#fdd">  glMatrixMode(GL_MODELVIEW);
  glPushMatrix();
  glLoadIdentity();</span>

  // Make sure depth testing and lighting are disabled for 2D rendering until
  // we are finished rendering in 2D
<span style = "background-color:#fdd">  glPushAttrib(GL_DEPTH_BUFFER_BIT | GL_LIGHTING_BIT);
  glDisable(GL_DEPTH_TEST);
  glDisable(GL_LIGHTING);</span>
  // disable the texturing here so crosshair is painted in the correct colors
  // vtk will reenable texturing every time it is needed
<span style = "background-color:#fdd">  glDisable(GL_TEXTURE_1D);
  glDisable(GL_TEXTURE_2D);
  glLineWidth(1.0);
}</span>

/*!
\brief Initialize the VtkPropRenderer

Enable2DOpenGL() and Disable2DOpenGL() are used to switch between 2D rendering (orthographic projection) and 3D
rendering (perspective projection)
*/
void mitk::VtkGLMapperWrapper::Disable2DOpenGL()
<span style = "background-color:#fdd">{
  glPopAttrib();
  glMatrixMode(GL_PROJECTION);
  glPopMatrix();
  glMatrixMode(GL_MODELVIEW);
  glPopMatrix();
}</span></pre>
	</body>
</html>