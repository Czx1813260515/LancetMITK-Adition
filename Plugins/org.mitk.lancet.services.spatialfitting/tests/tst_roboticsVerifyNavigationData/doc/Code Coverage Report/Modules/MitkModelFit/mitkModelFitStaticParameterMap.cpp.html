<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkModelFitStaticParameterMap.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include &lt;algorithm&gt;

#include "mitkModelFitStaticParameterMap.h"
#include "mitkModelFitException.h"

void mitk::modelFit::StaticParameterMap::Add(const std::string&amp; name, const ValueType&amp; newList)
<span style = "background-color:#fdd">{
	MapType::const_iterator mapIter = m_map.find(name);</span>

	// Only add if the name doesn't exist yet
<span style = "background-color:#fdd">	if (mapIter == m_map.end())</span>
	{
		// If the new list contains more than one values, make sure it contains the same number of
		// values as other lists that contain more than one value
<span style = "background-color:#fdd">		if (newList.size() &gt; 1)</span>
		{
<span style = "background-color:#fdd">			if (m_numValues &gt; 1 &amp;&amp; newList.size() != m_numValues)</span>
			{
<span style = "background-color:#fdd">				mitkThrowException(ModelFitException) &lt;&lt; "Unable to add variable '" &lt;&lt; name</span>
													  &lt;&lt; "' to StaticParameterMap: It contains "
													  &lt;&lt; newList.size() &lt;&lt; "values (should be "
													  &lt;&lt; m_numValues;
<span style = "background-color:#fdd">			}
			else if (m_numValues == 1)</span>
			{
<span style = "background-color:#fdd">				m_numValues = newList.size();</span>
			}
		}

<span style = "background-color:#fdd">		m_map.insert(StaticParameterType(name, newList));</span>
	}
<span style = "background-color:#fdd">}</span>

const mitk::modelFit::StaticParameterMap::ValueType&amp;
mitk::modelFit::StaticParameterMap::Get(const std::string&amp; name) const
<span style = "background-color:#fdd">{
	MapType::const_iterator mapIter = m_map.find(name);</span>

<span style = "background-color:#fdd">	if (mapIter != m_map.end())</span>
	{
<span style = "background-color:#fdd">		return mapIter-&gt;second;</span>
	}

<span style = "background-color:#fdd">	throw std::range_error("'" + name + "' does not exist in InputStaticParameterMap");
}</span>

void mitk::modelFit::StaticParameterMap::Sort(const std::string&amp; name /* = "" */)
<span style = "background-color:#fdd">{
	if (m_map.empty() || m_numValues == 1)</span>
	{
<span style = "background-color:#fdd">		return;</span>
	}

	// Copy the actual map and operate on the copy to fulfill exception guarantees.
<span style = "background-color:#fdd">	MapType localMap = m_map;</span>

	// Copy map contents to a m*n matrix where n is the number of values and m is the number of
	// variables
<span style = "background-color:#fdd">	std::vector&lt;ValueType&gt; temp;</span>

<span style = "background-color:#fdd">	for (size_t i = 0; i &lt; m_numValues; ++i)</span>
	{
<span style = "background-color:#fdd">		temp.push_back(ValueType());
	}</span>

	{
<span style = "background-color:#fdd">		MapType::const_iterator foundPair = localMap.find(name);</span>

<span style = "background-color:#fdd">		if (!name.empty())</span>
		{
<span style = "background-color:#fdd">			if (foundPair != localMap.end())</span>
			{
				// An existing variable name has been given, so make sure its values are in the
				// first row of the matrix
<span style = "background-color:#fdd">				const ValueType&amp; list = foundPair-&gt;second;</span>

<span style = "background-color:#fdd">				if (list.size() &gt; 1) // only copy lists that have more than one value</span>
				{
<span style = "background-color:#fdd">					for (size_t i = 0; i &lt; list.size(); ++i)</span>
					{
<span style = "background-color:#fdd">						temp[i].push_back(list[i]);
					}</span>
				}
			}
		}

		// Copy the rest of the values to the matrix
<span style = "background-color:#fdd">		for (MapType::const_iterator mapIter = localMap.begin(); mapIter != localMap.end();
			 ++mapIter)</span>
		{
<span style = "background-color:#fdd">			if (!name.empty() &amp;&amp; name == mapIter-&gt;first)</span>
			{
				// Skip this variable since it was already added (in the first row)
<span style = "background-color:#fdd">				continue;</span>
			}

<span style = "background-color:#fdd">			const ValueType&amp; list = mapIter-&gt;second;</span>

<span style = "background-color:#fdd">			if (list.size() &gt; 1) // only copy lists that have more than one value</span>
			{
<span style = "background-color:#fdd">				for (size_t i = 0; i &lt; list.size(); ++i)</span>
				{
<span style = "background-color:#fdd">					temp[i].push_back(list[i]);
				}
			}
		}
	}</span>

	// Sort the matrix
<span style = "background-color:#fdd">	std::sort(temp.begin(), temp.end());</span>

	// Copy the matrix contents back to the map
	{
<span style = "background-color:#fdd">		int i = 0;
		MapType::iterator foundPair = localMap.find(name);</span>

<span style = "background-color:#fdd">		if (foundPair != localMap.end())</span>
		{
			// An existing variable name has been given, so make sure the first row of the matrix is
			// copied back to that variable
<span style = "background-color:#fdd">			ValueType&amp; list = foundPair-&gt;second;</span>

<span style = "background-color:#fdd">			if (list.size() &gt; 1) // only copy lists that have more than one value</span>
			{
<span style = "background-color:#fdd">				list.clear();</span>

<span style = "background-color:#fdd">				for (size_t j = 0; j &lt; temp.size(); ++j)</span>
				{
<span style = "background-color:#fdd">					list.push_back(temp[j][i]);
				}</span>

<span style = "background-color:#fdd">				++i;</span>
			}
		}

		// Copy the rest of the matrix back to the map
<span style = "background-color:#fdd">		for (MapType::iterator mapIter = localMap.begin(); mapIter != localMap.end(); ++mapIter)</span>
		{
<span style = "background-color:#fdd">			if (!name.empty() &amp;&amp; name == mapIter-&gt;first)</span>
			{
				// Skip this variable since it was already filled (from the first row)
<span style = "background-color:#fdd">				continue;</span>
			}

<span style = "background-color:#fdd">			ValueType&amp; list = mapIter-&gt;second;</span>

<span style = "background-color:#fdd">			if (list.size() &gt; 1) // only copy lists that have more than one value</span>
			{
<span style = "background-color:#fdd">				list.clear();</span>

<span style = "background-color:#fdd">				for (size_t j = 0; j &lt; temp.size(); ++j)</span>
				{
<span style = "background-color:#fdd">					list.push_back(temp[j][i]);
				}</span>

<span style = "background-color:#fdd">				++i;
			}
		}
	}</span>

	// Write the now sorted copy back to the actual map
<span style = "background-color:#fdd">	m_map = localMap;
}</span>

void mitk::modelFit::StaticParameterMap::Clear()
<span style = "background-color:#fdd">{
	m_map.clear();
	m_numValues = 1;
}</span></pre>
	</body>
</html>