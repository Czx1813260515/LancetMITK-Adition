<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkMapper.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkMapper.h"
#include "mitkBaseRenderer.h"
#include "mitkDataNode.h"
#include "mitkProperties.h"

<span style = "background-color:#fdd">mitk::Mapper::Mapper() : m_DataNode(nullptr), m_TimeStep(0)
{
}</span>

mitk::Mapper::~Mapper()
<span style = "background-color:#fdd">{
}</span>

mitk::BaseData *mitk::Mapper::GetData() const
<span style = "background-color:#fdd">{
  return m_DataNode == nullptr ? nullptr : m_DataNode-&gt;GetData();
}</span>

mitk::DataNode *mitk::Mapper::GetDataNode() const
<span style = "background-color:#fdd">{
  return this-&gt;m_DataNode;
}</span>

bool mitk::Mapper::GetColor(float rgb[3], mitk::BaseRenderer *renderer, const char *name) const
<span style = "background-color:#fdd">{
  const mitk::DataNode *node = GetDataNode();
  if (node == nullptr)
    return false;</span>

<span style = "background-color:#fdd">  return node-&gt;GetColor(rgb, renderer, name);
}</span>

bool mitk::Mapper::GetVisibility(bool &amp;visible, mitk::BaseRenderer *renderer, const char *name) const
<span style = "background-color:#fdd">{
  const mitk::DataNode *node = GetDataNode();
  if (node == nullptr)
    return false;</span>

<span style = "background-color:#fdd">  return node-&gt;GetVisibility(visible, renderer, name);
}</span>

bool mitk::Mapper::GetOpacity(float &amp;opacity, mitk::BaseRenderer *renderer, const char *name) const
<span style = "background-color:#fdd">{
  const mitk::DataNode *node = GetDataNode();
  if (node == nullptr)
    return false;</span>

<span style = "background-color:#fdd">  return node-&gt;GetOpacity(opacity, renderer, name);
}</span>

bool mitk::Mapper::GetLevelWindow(mitk::LevelWindow &amp;levelWindow, mitk::BaseRenderer *renderer, const char *name) const
<span style = "background-color:#fdd">{
  const mitk::DataNode *node = GetDataNode();
  if (node == nullptr)
    return false;</span>

<span style = "background-color:#fdd">  return node-&gt;GetLevelWindow(levelWindow, renderer, name);
}</span>

bool mitk::Mapper::IsVisible(mitk::BaseRenderer *renderer, const char *name) const
<span style = "background-color:#fdd">{
  bool visible = true;
  GetDataNode()-&gt;GetVisibility(visible, renderer, name);
  return visible;
}</span>

void mitk::Mapper::CalculateTimeStep(mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  if ((renderer != nullptr) &amp;&amp; (m_DataNode != nullptr))</span>
  {
<span style = "background-color:#fdd">    m_TimeStep = renderer-&gt;GetTimeStep(m_DataNode-&gt;GetData());
  }</span>
  else
  {
<span style = "background-color:#fdd">    m_TimeStep = 0;</span>
  }
<span style = "background-color:#fdd">}</span>

void mitk::Mapper::Update(mitk::BaseRenderer *renderer)
<span style = "background-color:#fdd">{
  const DataNode *node = GetDataNode();</span>

<span style = "background-color:#fdd">  assert(node != nullptr);</span>

<span style = "background-color:#fdd">  auto *data = static_cast&lt;mitk::BaseData *&gt;(node-&gt;GetData());</span>

<span style = "background-color:#fdd">  if (!data)
    return;</span>

  // Calculate time step of the input data for the specified renderer (integer value)
<span style = "background-color:#fdd">  this-&gt;CalculateTimeStep(renderer);</span>

  // Check if time step is valid
<span style = "background-color:#fdd">  const TimeGeometry *dataTimeGeometry = data-&gt;GetTimeGeometry();
  if ((dataTimeGeometry == nullptr) || (dataTimeGeometry-&gt;CountTimeSteps() == 0) ||</span>
      (!dataTimeGeometry-&gt;IsValidTimeStep(m_TimeStep)))
  {
    // TimeGeometry or time step is not valid for this data:
    // reset mapper so that nothing is displayed
<span style = "background-color:#fdd">    this-&gt;ResetMapper(renderer);
    return;</span>
  }

<span style = "background-color:#fdd">  this-&gt;GenerateDataForRenderer(renderer);
}</span>

bool mitk::Mapper::BaseLocalStorage::IsGenerateDataRequired(mitk::BaseRenderer *renderer,
                                                            mitk::Mapper *mapper,
                                                            mitk::DataNode *dataNode) const
<span style = "background-color:#fdd">{
  if (mapper &amp;&amp; m_LastGenerateDataTime &lt; mapper-&gt;GetMTime())
    return true;</span>

<span style = "background-color:#fdd">  if (dataNode)</span>
  {
<span style = "background-color:#fdd">    if (m_LastGenerateDataTime &lt; dataNode-&gt;GetDataReferenceChangedTime())
      return true;</span>

<span style = "background-color:#fdd">    mitk::BaseData *data = dataNode-&gt;GetData();</span>

<span style = "background-color:#fdd">    if (data &amp;&amp; m_LastGenerateDataTime &lt; data-&gt;GetMTime())
      return true;</span>
  }

<span style = "background-color:#fdd">  if (renderer &amp;&amp; m_LastGenerateDataTime &lt; renderer-&gt;GetTimeStepUpdateTime())
    return true;</span>

<span style = "background-color:#fdd">  return false;
}</span>

void mitk::Mapper::SetDefaultProperties(mitk::DataNode *node, mitk::BaseRenderer *renderer, bool overwrite)
<span style = "background-color:#fdd">{
  node-&gt;AddProperty("visible", mitk::BoolProperty::New(true), renderer, overwrite);
  node-&gt;AddProperty("layer", mitk::IntProperty::New(0), renderer, overwrite);
  node-&gt;AddProperty("name", mitk::StringProperty::New(DataNode::NO_NAME_VALUE()), renderer, overwrite);
}</span></pre>
	</body>
</html>