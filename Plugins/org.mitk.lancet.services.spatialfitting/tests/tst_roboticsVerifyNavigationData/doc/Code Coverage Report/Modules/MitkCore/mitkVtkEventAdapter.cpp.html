<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkVtkEventAdapter.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkVtkEventAdapter.h"
#include "mitkInteractionEventConst.h"
#include "vtkCommand.h"
#include &lt;mitkInteractionConst.h&gt; // INTERACTION LEGACY
#include &lt;cstring&gt;

namespace mitk
{
<span style = "background-color:#dfd">  std::map&lt;BaseRenderer *, int&gt; VtkEventAdapter::buttonStateMap;</span>
}

mitk::MouseMoveEvent::Pointer mitk::VtkEventAdapter::AdaptMouseMoveEvent(mitk::BaseRenderer *sender,
                                                                         unsigned long vtkCommandEventId,
                                                                         vtkRenderWindowInteractor *rwi)
<span style = "background-color:#fdd">{
  mitk::Point2D point;
  point[0] = rwi-&gt;GetEventPosition()[0];
  point[1] = rwi-&gt;GetEventPosition()[1];</span>

<span style = "background-color:#fdd">  int modifiers = 0;</span>

  // vtkRenderWindowInteractor does not provide information about mouse buttons during
  // mouse move events therefore the Press/Release functions update the button state in the buttonStateMap
  // this button state is then provided for mouse move events

<span style = "background-color:#fdd">  int buttonState = 0;</span>

<span style = "background-color:#fdd">  if (buttonStateMap.find(sender) != buttonStateMap.end())</span>
  {
    // set stored button state
<span style = "background-color:#fdd">    buttonState = buttonStateMap.find(sender)-&gt;second;</span>
  }

<span style = "background-color:#fdd">  if (vtkCommandEventId == vtkCommand::MouseMoveEvent)</span>
  {
<span style = "background-color:#fdd">    if (buttonState != 0)</span>
    {
<span style = "background-color:#fdd">      modifiers = buttonState;</span>
    }
<span style = "background-color:#fdd">  }</span>
  else
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "Wrong usage of function AdaptMouseMoveEvent. Wrong input type.";</span>
  }

<span style = "background-color:#fdd">  if (rwi-&gt;GetShiftKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::ShiftKey;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetControlKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::ControlKey;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetAltKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::AltKey;</span>
  }

<span style = "background-color:#fdd">  MouseMoveEvent::Pointer mme = MouseMoveEvent::New(sender,</span>
                                                    point,
                                                    static_cast&lt;InteractionEvent::MouseButtons&gt;(buttonState),
                                                    static_cast&lt;InteractionEvent::ModifierKeys&gt;(modifiers));
<span style = "background-color:#fdd">  return mme;
}</span>

mitk::MouseReleaseEvent::Pointer mitk::VtkEventAdapter::AdaptMouseReleaseEvent(mitk::BaseRenderer *sender,
                                                                               unsigned long vtkCommandEventId,
                                                                               vtkRenderWindowInteractor *rwi)
<span style = "background-color:#fdd">{
  mitk::Point2D point;
  point[0] = rwi-&gt;GetEventPosition()[0];
  point[1] = rwi-&gt;GetEventPosition()[1];</span>

<span style = "background-color:#fdd">  int button = 0;
  int modifiers = 0;
  int buttonState = 0;</span>

  // vtkRenderWindowInteractor does not provide information about mouse buttons during
  // mouse move events therefore the Press/Release functions update the button state in the buttonStateMap
  // this button state is then provided for mouse move events

<span style = "background-color:#fdd">  if (buttonStateMap.find(sender) != buttonStateMap.end())
    buttonState = buttonStateMap.find(sender)-&gt;second;</span>

<span style = "background-color:#fdd">  if (buttonState != 0 &amp;&amp; vtkCommandEventId != vtkCommand::MouseMoveEvent)
    buttonStateMap.erase(buttonStateMap.find(sender)); // press or release event with active map caching</span>

<span style = "background-color:#fdd">  switch (vtkCommandEventId)</span>
  {
    case vtkCommand::LeftButtonReleaseEvent:
<span style = "background-color:#fdd">      button = InteractionEvent::LeftMouseButton;</span>
      // remove left mouse button from button state
<span style = "background-color:#fdd">      buttonStateMap[sender] = (buttonState - button);
      break;</span>
    case vtkCommand::MiddleButtonReleaseEvent:
<span style = "background-color:#fdd">      button = InteractionEvent::MiddleMouseButton;</span>
      // remove middle button from button state
<span style = "background-color:#fdd">      buttonStateMap[sender] = (buttonState - button);
      break;</span>
    case vtkCommand::RightButtonReleaseEvent:
<span style = "background-color:#fdd">      button = InteractionEvent::RightMouseButton;</span>
      // remove right mouse button from button state
<span style = "background-color:#fdd">      buttonStateMap[sender] = (buttonState - button);</span>
      break;
  }

<span style = "background-color:#fdd">  if (rwi-&gt;GetShiftKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::ShiftKey;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetControlKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::ControlKey;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetAltKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::AltKey;</span>
  }

  // after releasing button is no longer pressed, to update it
<span style = "background-color:#fdd">  if (buttonStateMap.find(sender) != buttonStateMap.end())</span>
  {
<span style = "background-color:#fdd">    buttonState = buttonStateMap.find(sender)-&gt;second;</span>
  }

<span style = "background-color:#fdd">  MouseReleaseEvent::Pointer mre = MouseReleaseEvent::New(sender,</span>
                                                          point,
                                                          static_cast&lt;InteractionEvent::MouseButtons&gt;(buttonState),
                                                          static_cast&lt;InteractionEvent::ModifierKeys&gt;(modifiers),
                                                          static_cast&lt;InteractionEvent::MouseButtons&gt;(button));
<span style = "background-color:#fdd">  return mre;
}</span>

mitk::MouseWheelEvent::Pointer mitk::VtkEventAdapter::AdaptMouseWheelEvent(mitk::BaseRenderer *sender,
                                                                           unsigned long vtkCommandEventId,
                                                                           vtkRenderWindowInteractor *rwi)
<span style = "background-color:#fdd">{
  mitk::Point2D p;
  p[0] = rwi-&gt;GetEventPosition()[0];
  p[1] = rwi-&gt;GetEventPosition()[1];</span>

<span style = "background-color:#fdd">  int delta = 0;
  switch (vtkCommandEventId)</span>
  {
    case vtkCommand::MouseWheelForwardEvent:
<span style = "background-color:#fdd">      delta = +120; // http://doc.trolltech.com/3.3/qwheelevent.html#delta
      break;</span>
    case vtkCommand::MouseWheelBackwardEvent:
<span style = "background-color:#fdd">      delta = -120; // http://doc.trolltech.com/3.3/qwheelevent.html#delta</span>
      break;
  }

<span style = "background-color:#fdd">  int modifiers = 0;
  if (rwi-&gt;GetShiftKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= mitk::BS_ShiftButton;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetControlKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= mitk::BS_ControlButton;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetAltKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= mitk::BS_AltButton;</span>
  }

<span style = "background-color:#fdd">  mitk::Point2D point;
  point[0] = rwi-&gt;GetEventPosition()[0];
  point[1] = rwi-&gt;GetEventPosition()[1];</span>

  // vtkWheelEvent does not have a buttonState or event button
<span style = "background-color:#fdd">  int buttonState = 0;
  MouseWheelEvent::Pointer mpe = MouseWheelEvent::New(sender,</span>
                                                      point,
                                                      static_cast&lt;InteractionEvent::MouseButtons&gt;(buttonState),
                                                      static_cast&lt;InteractionEvent::ModifierKeys&gt;(modifiers),
                                                      delta);
<span style = "background-color:#fdd">  return mpe;
}</span>

mitk::InteractionKeyEvent::Pointer mitk::VtkEventAdapter::AdaptInteractionKeyEvent(mitk::BaseRenderer *sender,
                                                                                   unsigned long vtkCommandEventId,
                                                                                   vtkRenderWindowInteractor *rwi)
<span style = "background-color:#fdd">{
  if (vtkCommandEventId != vtkCommand::KeyPressEvent)</span>
  {
<span style = "background-color:#fdd">    MITK_WARN &lt;&lt; "mitk::VtkEventAdapter::AdaptInteractionKeyEvent() called with wrong argument";
    return nullptr;</span>
  }
<span style = "background-color:#fdd">  int modifiers = 0;
  if (rwi-&gt;GetShiftKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= mitk::BS_ShiftButton;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetControlKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= mitk::BS_ControlButton;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetAltKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= mitk::BS_AltButton;</span>
  }
<span style = "background-color:#fdd">  InteractionKeyEvent::Pointer ike = InteractionKeyEvent::New(</span>
    sender, std::string(rwi-&gt;GetKeySym()), static_cast&lt;InteractionEvent::ModifierKeys&gt;(modifiers));
<span style = "background-color:#fdd">  return ike;
}</span>

mitk::MousePressEvent::Pointer mitk::VtkEventAdapter::AdaptMousePressEvent(mitk::BaseRenderer *sender,
                                                                           unsigned long vtkCommandEventId,
                                                                           vtkRenderWindowInteractor *rwi)
<span style = "background-color:#fdd">{
  mitk::Point2D point;
  point[0] = rwi-&gt;GetEventPosition()[0];
  point[1] = rwi-&gt;GetEventPosition()[1];</span>

<span style = "background-color:#fdd">  int button = 0;
  int modifiers = 0;
  int buttonState = 0;</span>

  // vtkRenderWindowInteractor does not provide information about mouse buttons during
  // mouse move events therefore the Press/Release functions update the button state in the buttonStateMap
  // this button state is then provided for mouse move events

<span style = "background-color:#fdd">  if (buttonStateMap.find(sender) != buttonStateMap.end())
    buttonState = buttonStateMap.find(sender)-&gt;second;</span>

<span style = "background-color:#fdd">  if (buttonState != 0 &amp;&amp; vtkCommandEventId != vtkCommand::MouseMoveEvent)
    buttonStateMap.erase(buttonStateMap.find(sender)); // press or release event with active map caching</span>

<span style = "background-color:#fdd">  switch (vtkCommandEventId)</span>
  {
    case vtkCommand::LeftButtonPressEvent:
<span style = "background-color:#fdd">      button = InteractionEvent::LeftMouseButton;
      buttonState |= button;
      buttonStateMap[sender] = buttonState;
      break;</span>
    case vtkCommand::MiddleButtonPressEvent:
<span style = "background-color:#fdd">      button = InteractionEvent::MiddleMouseButton;
      buttonState |= button;
      buttonStateMap[sender] = buttonState;
      break;</span>
    case vtkCommand::RightButtonPressEvent:
<span style = "background-color:#fdd">      button = InteractionEvent::RightMouseButton;
      buttonState |= button;
      buttonStateMap[sender] = buttonState;</span>
      break;
  }

<span style = "background-color:#fdd">  if (rwi-&gt;GetShiftKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::ShiftKey;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetControlKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::ControlKey;</span>
  }
<span style = "background-color:#fdd">  if (rwi-&gt;GetAltKey())</span>
  {
<span style = "background-color:#fdd">    modifiers |= InteractionEvent::AltKey;</span>
  }

<span style = "background-color:#fdd">  MousePressEvent::Pointer mpe = MousePressEvent::New(sender,</span>
                                                      point,
                                                      static_cast&lt;InteractionEvent::MouseButtons&gt;(buttonState),
                                                      static_cast&lt;InteractionEvent::ModifierKeys&gt;(modifiers),
                                                      static_cast&lt;InteractionEvent::MouseButtons&gt;(button));
<span style = "background-color:#fdd">  return mpe;
}</span></pre>
	</body>
</html>