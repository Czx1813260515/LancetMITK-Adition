<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkStateMachineTransition.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkStateMachineTransition.h"
#include "mitkEventFactory.h"
#include "mitkInteractionEventConst.h"
#include "mitkStateMachineAction.h"
#include "mitkStateMachineState.h"

mitk::StateMachineTransition::StateMachineTransition(const std::string &amp;nextStateName,
                                                     const std::string &amp;eventClass,
                                                     const std::string &amp;eventVariant)
<span style = "background-color:#fdd">  : m_EventClass(eventClass), m_EventVariant(eventVariant), m_NextStateName(nextStateName)
{
  PropertyList::Pointer propertyList = PropertyList::New();
  propertyList-&gt;SetStringProperty(InteractionEventConst::xmlParameterEventClass().c_str(), eventClass.c_str());
  m_TransitionEvent = EventFactory::CreateEvent(propertyList);
}</span>

bool mitk::StateMachineTransition::operator==(const StateMachineTransition &amp;transition) const
<span style = "background-color:#fdd">{</span>
  // Create event based on incoming event type,
  // then try to cast it to the type of event that this transition holds,
  // if this is possible, the variant is checked

  // check for nullptr since a corrupted state machine might cause an empty event
<span style = "background-color:#fdd">  if (m_TransitionEvent.IsNull())</span>
  {
<span style = "background-color:#fdd">    return false;</span>
  }
<span style = "background-color:#fdd">  PropertyList::Pointer propertyList = PropertyList::New();
  propertyList-&gt;SetStringProperty(InteractionEventConst::xmlParameterEventClass().c_str(),</span>
                                  transition.m_EventClass.c_str());
<span style = "background-color:#fdd">  InteractionEvent::Pointer tmpEvent = EventFactory::CreateEvent(propertyList);
  if (tmpEvent.IsNull())</span>
  {
<span style = "background-color:#fdd">    return false;</span>
  }

<span style = "background-color:#fdd">  if (m_TransitionEvent-&gt;IsSuperClassOf(tmpEvent.GetPointer()))</span>
  {
<span style = "background-color:#fdd">    return (this-&gt;m_EventVariant == transition.m_EventVariant);
  }</span>
  else
  {
    // if event variants match, but super class condition is violated
    // this means that the configuration file, implements a class that does not
    // support the type in the state machine.
<span style = "background-color:#fdd">    if (this-&gt;m_EventVariant == transition.m_EventVariant)</span>
    {
<span style = "background-color:#fdd">      MITK_WARN &lt;&lt; "Event type in Statemachine " &lt;&lt; m_EventClass &lt;&lt; " is not compatible to configuration class "</span>
                &lt;&lt; transition.m_EventClass;
    }
<span style = "background-color:#fdd">    return false;</span>
  }
<span style = "background-color:#fdd">}</span>

mitk::StateMachineTransition::~StateMachineTransition()
<span style = "background-color:#fdd">{</span>
  // needed for correct reference counting of mitkState//, for real???
<span style = "background-color:#fdd">  m_NextState = nullptr;</span>

<span style = "background-color:#fdd">  m_Actions.clear();
  m_Conditions.clear();
}</span>

void mitk::StateMachineTransition::AddAction(const StateMachineAction::Pointer &amp;action)
<span style = "background-color:#fdd">{
  m_Actions.push_back(action);
}</span>

void mitk::StateMachineTransition::AddCondition(const StateMachineCondition &amp;condition)
<span style = "background-color:#fdd">{
  m_Conditions.push_back(condition);
}</span>

mitk::StateMachineState::Pointer mitk::StateMachineTransition::GetNextState() const
<span style = "background-color:#fdd">{
  return m_NextState;
}</span>

std::string mitk::StateMachineTransition::GetNextStateName() const
<span style = "background-color:#fdd">{
  return m_NextStateName;
}</span>

std::vector&lt;mitk::StateMachineAction::Pointer&gt; mitk::StateMachineTransition::GetActions() const
<span style = "background-color:#fdd">{
  return m_Actions;
}</span>

const mitk::ConditionVectorType &amp;mitk::StateMachineTransition::GetConditions() const
<span style = "background-color:#fdd">{
  return m_Conditions;
}</span>

void mitk::StateMachineTransition::SetNextState(const SpStateMachineState &amp;nextState)
<span style = "background-color:#fdd">{
  m_NextState = nextState;
}</span></pre>
	</body>
</html>