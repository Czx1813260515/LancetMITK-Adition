<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkImageStatisticsCalculator.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#ifndef MITKIMAGESTATISTICSCALCULATOR
#define MITKIMAGESTATISTICSCALCULATOR

#include &lt;MitkImageStatisticsExports.h&gt;
#include &lt;mitkImage.h&gt;
#include &lt;mitkMaskGenerator.h&gt;
#include &lt;mitkImageStatisticsContainer.h&gt;

namespace mitk
{
    class MITKIMAGESTATISTICS_EXPORT ImageStatisticsCalculator: public itk::Object
    {
    public:
        /** Standard Self typedef */
        typedef ImageStatisticsCalculator        Self;
        typedef itk::Object                         Superclass;
        typedef itk::SmartPointer&lt; Self &gt;           Pointer;
        typedef itk::SmartPointer&lt; const Self &gt;     ConstPointer;

        /** Method for creation through the object factory. */
<span style = "background-color:#fdd">        itkNewMacro(Self); /** Runtime information support. */
        itkTypeMacro(ImageStatisticsCalculator_v2, itk::Object);</span>

        typedef double statisticsValueType;
        typedef std::map&lt;std::string, statisticsValueType&gt; statisticsMapType;
        typedef itk::Statistics::Histogram&lt;double&gt; HistogramType;
        typedef unsigned short MaskPixelType;
        using LabelIndex = ImageStatisticsContainer::LabelIndex;

        /**Documentation
        @brief Set the image for which the statistics are to be computed.*/
        void SetInputImage(const mitk::Image* image);

        /**Documentation
        @brief Set the mask generator that creates the mask which is to be used to calculate statistics. If no more mask is desired simply set @param mask to nullptr*/
        void SetMask(mitk::MaskGenerator* mask);

        /**Documentation
        @brief Set this if more than one mask should be applied (for instance if a IgnorePixelValueMask were to be used alongside with a segmentation).
        Both masks are combined using pixel wise AND operation. The secondary mask does not have to be the same size than the primary but they need to have some overlap*/
        void SetSecondaryMask(mitk::MaskGenerator* mask);

        /**Documentation
        @brief Set number of bins to be used for histogram statistics. If Bin size is set after number of bins, bin size will be used instead!*/
        void SetNBinsForHistogramStatistics(unsigned int nBins);

        /**Documentation
        @brief Retrieve the number of bins used for histogram statistics. Careful: The return value does not indicate whether NBins or BinSize is used.
        That solely depends on which parameter has been set last.*/
        unsigned int GetNBinsForHistogramStatistics() const;

        /**Documentation
        @brief Set bin size to be used for histogram statistics. If nbins is set after bin size, nbins will be used instead!*/
        void SetBinSizeForHistogramStatistics(double binSize);

        /**Documentation
        @brief Retrieve the bin size for histogram statistics. Careful: The return value does not indicate whether NBins or BinSize is used.
        That solely depends on which parameter has been set last.*/
        double GetBinSizeForHistogramStatistics() const;

        /**Documentation
        @brief Returns the statistics for label @a label. If these requested statistics are not computed yet the computation is done as well.
        For performance reasons, statistics for all labels in the image are computed at once.
         */
        ImageStatisticsContainer* GetStatistics(LabelIndex label=1);

    protected:
<span style = "background-color:#fdd">        ImageStatisticsCalculator(){
            m_nBinsForHistogramStatistics = 100;
            m_binSizeForHistogramStatistics = 10;
            m_UseBinSizeOverNBins = false;
        };</span>


    private:
        //Calculates statistics for each timestep for image
        template &lt; typename TPixel, unsigned int VImageDimension &gt; void InternalCalculateStatisticsUnmasked(
                typename itk::Image&lt; TPixel, VImageDimension &gt;* image, const TimeGeometry* timeGeometry, TimeStepType timeStep);

        template &lt; typename TPixel, unsigned int VImageDimension &gt; void InternalCalculateStatisticsMasked(
                typename itk::Image&lt; TPixel, VImageDimension &gt;* image, const TimeGeometry* timeGeometry,
                unsigned int timeStep);

        template &lt; typename TPixel, unsigned int VImageDimension &gt;
        double GetVoxelVolume(typename itk::Image&lt;TPixel, VImageDimension&gt;* image) const;

        bool IsUpdateRequired(LabelIndex label) const;

        mitk::Image::ConstPointer m_Image;
        mitk::Image::Pointer m_ImageTimeSlice;
        mitk::Image::ConstPointer m_InternalImageForStatistics;

        mitk::MaskGenerator::Pointer m_MaskGenerator;
        mitk::Image::Pointer m_InternalMask;

        mitk::MaskGenerator::Pointer m_SecondaryMaskGenerator;
        mitk::Image::Pointer m_SecondaryMask;

        unsigned int m_nBinsForHistogramStatistics;
        double m_binSizeForHistogramStatistics;
        bool m_UseBinSizeOverNBins;

        std::map&lt;LabelIndex,ImageStatisticsContainer::Pointer&gt; m_StatisticContainers;
    };

}
#endif // MITKIMAGESTATISTICSCALCULATOR
</pre>
	</body>
</html>