<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>lancetSpatialFittingPipelineManager.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
#include "lancetSpatialFittingPipelineManager.h"
#include &lt;vector&gt;
#include &lt;algorithm&gt;
BEGIN_SPATIAL_FITTING_NAMESPACE

struct PipelineManager::PipelineManagerPrivateImp
{
	std::vector&lt;mitk::NavigationDataToNavigationDataFilter::Pointer&gt; vecFilterManage;
};

PipelineManager::PipelineManager()
<span style = "background-color:#dfd">	: imp(std::make_shared&lt;PipelineManagerPrivateImp&gt;())
{
}</span>

PipelineManager::~PipelineManager()
<span style = "background-color:#dfd">{
}</span>

bool PipelineManager::AddFilter(int index, mitk::NavigationDataToNavigationDataFilter::Pointer filter)
<span style = "background-color:#dfd">{
	if (filter.IsNull() || index &lt; 0)</span>
	{
<span style = "background-color:#fdd">		return false;</span>
	}

<span style = "background-color:#dfd">	if (index &gt;= this-&gt;imp-&gt;vecFilterManage.size())</span>
	{
<span style = "background-color:#dfd">		this-&gt;imp-&gt;vecFilterManage.push_back(filter);
		this-&gt;UpdateConntedToFilter();
		return true;</span>
	}
<span style = "background-color:#fdd">	this-&gt;imp-&gt;vecFilterManage.insert(this-&gt;imp-&gt;vecFilterManage.begin() + index, filter);
	this-&gt;UpdateConntedToFilter();
	return true;</span>
<span style = "background-color:#dfd">}</span>

bool PipelineManager::RemoveFilter(int index)
<span style = "background-color:#fdd">{
	if (index &gt;= this-&gt;GetSize() || index &lt; 0)</span>
	{
<span style = "background-color:#fdd">		return false;</span>
	}
<span style = "background-color:#fdd">	this-&gt;imp-&gt;vecFilterManage.erase(std::begin(this-&gt;imp-&gt;vecFilterManage) + index);
	this-&gt;UpdateConntedToFilter();
	return true;
}</span>

bool PipelineManager::RemoveFilter(const std::string&amp; name)
<span style = "background-color:#fdd">{
	return this-&gt;RemoveFilter(this-&gt;GetIndexByName(name));
}</span>

bool PipelineManager::ModifyFilter(int index, mitk::NavigationDataToNavigationDataFilter::Pointer filter)
<span style = "background-color:#fdd">{
	if (index &gt;= this-&gt;GetSize() || index &lt; 0)</span>
	{
<span style = "background-color:#fdd">		return false;</span>
	}
<span style = "background-color:#fdd">	this-&gt;imp-&gt;vecFilterManage[index]= filter;
	this-&gt;UpdateConntedToFilter();
	return true;
}</span>

bool PipelineManager::ModifyFilter(const std::string&amp; name, mitk::NavigationDataToNavigationDataFilter::Pointer filter)
<span style = "background-color:#fdd">{
	return this-&gt;ModifyFilter(this-&gt;GetIndexByName(name), filter);
}</span>

mitk::NavigationDataToNavigationDataFilter::Pointer PipelineManager::FindFilter(int index)
<span style = "background-color:#dfd">{
	if (index &lt; this-&gt;GetSize() &amp;&amp; index &gt;= 0)</span>
	{
<span style = "background-color:#dfd">		return this-&gt;imp-&gt;vecFilterManage[index];</span>
	}
<span style = "background-color:#fdd">	return mitk::NavigationDataToNavigationDataFilter::Pointer();</span>
<span style = "background-color:#dfd">}</span>

mitk::NavigationDataToNavigationDataFilter::Pointer PipelineManager::FindFilter(const std::string&amp; name)
<span style = "background-color:#fdd">{
	return this-&gt;FindFilter(this-&gt;GetIndexByName(name));
}</span>

int PipelineManager::GetIndexByName(const std::string&amp; name)
<span style = "background-color:#fdd">{
	for (int index = 0; index &lt; this-&gt;GetSize(); ++index)</span>
	{
<span style = "background-color:#fdd">		if (name == this-&gt;imp-&gt;vecFilterManage.at(index).GetPointer()-&gt;GetName())</span>
		{
<span style = "background-color:#fdd">			return index;</span>
		}
<span style = "background-color:#fdd">	}
	return -1;
}</span>

bool PipelineManager::IsEmpty() const
<span style = "background-color:#dfd">{
	return this-&gt;imp-&gt;vecFilterManage.empty();
}</span>

int PipelineManager::GetSize() const
<span style = "background-color:#dfd">{
	return this-&gt;imp-&gt;vecFilterManage.size();
}</span>

void PipelineManager::UpdateFilter()
<span style = "background-color:#fdd">{
	if (false == this-&gt;IsEmpty())</span>
	{
<span style = "background-color:#fdd">		this-&gt;FindFilter(this-&gt;GetSize() - 1)-&gt;Update();</span>
	}	
<span style = "background-color:#fdd">}</span>

void PipelineManager::UpdateConntedToFilter()
<span style = "background-color:#dfd">{
	this-&gt;UpdateDisConntedToFilter();
	for (size_t index = 1; index &lt; this-&gt;GetSize(); ++index)</span>
	{
<span style = "background-color:#dfd">		this-&gt;FindFilter(index)-&gt;ConnectTo(this-&gt;FindFilter(index - 1));
	}
	if (false == this-&gt;IsEmpty())</span>
	{
<span style = "background-color:#dfd">		this-&gt;FindFilter(0)-&gt;ConnectTo(this);</span>
	}
<span style = "background-color:#dfd">}</span>

void PipelineManager::UpdateDisConntedToFilter()
<span style = "background-color:#dfd">{
	for (size_t index = 0; index &lt; this-&gt;GetSize(); ++index)</span>
	{
<span style = "background-color:#dfd">		DataObjectPointerArray outputs = this-&gt;FindFilter(index)-&gt;GetInputs();
		for (DataObjectPointerArray::size_type i = 0; i &lt; outputs.size(); ++i)</span>
		{
<span style = "background-color:#dfd">			if (static_cast&lt;mitk::NavigationData*&gt;(outputs.at(i).GetPointer()))</span>
			{ 
<span style = "background-color:#dfd">				(static_cast&lt;mitk::NavigationData*&gt;(outputs.at(i).GetPointer()))-&gt;DisconnectPipeline();</span>
			}
<span style = "background-color:#dfd">		}
	}
}</span>

void PipelineManager::GenerateData()
<span style = "background-color:#fdd">{
	std::cout &lt;&lt; __FUNCTION__ &lt;&lt; "log" &lt;&lt; std::endl;</span>

<span style = "background-color:#fdd">	this-&gt;CreateOutputsForAllInputs();</span>

<span style = "background-color:#fdd">	for (size_t index = 0; index &lt; this-&gt;GetNumberOfInputs(); ++index)</span>
	{
<span style = "background-color:#fdd">		if (this-&gt;GetInput(index) &amp;&amp; this-&gt;GetOutput(index))</span>
		{
<span style = "background-color:#fdd">			this-&gt;GetOutput(index)-&gt;Graft(this-&gt;GetInput(index));</span>
		}
<span style = "background-color:#fdd">	}
}</span>


END_SPATIAL_FITTING_NAMESPACE</pre>
	</body>
</html>