<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkPlanarRectangle.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkProperties.h"

#include "mitkPlanarRectangle.h"
#include "mitkPlaneGeometry.h"

mitk::PlanarRectangle::PlanarRectangle()
<span style = "background-color:#fdd">  : FEATURE_ID_CIRCUMFERENCE(this-&gt;AddFeature("Circumference", "mm")), FEATURE_ID_AREA(this-&gt;AddFeature("Area", "mm2"))
{</span>
  // Rectangle has four control points
<span style = "background-color:#fdd">  this-&gt;ResetNumberOfControlPoints(4);
  this-&gt;SetProperty("closed", mitk::BoolProperty::New(true));
  this-&gt;SetNumberOfPolyLines(1);
}</span>

bool mitk::PlanarRectangle::SetControlPoint(unsigned int index, const Point2D &amp;point, bool createIfDoesNotExist)
<span style = "background-color:#fdd">{</span>
  // heres the deal with the rectangle:
  // when a point is moved all corresponding corner points are moved with him
  // e.g. if the lower right point (index=3) is moved the upper right point (index=1)
  // is moved in the same x direction
  // and the lower left point (index=2) is moved in the same y direction
  // the upper left point (index=0) is left untouched
<span style = "background-color:#fdd">  bool set = PlanarFigure::SetControlPoint(index, point, createIfDoesNotExist);</span>

<span style = "background-color:#fdd">  if (set)</span>
  {
    // can be made better ...
<span style = "background-color:#fdd">    unsigned int horizontalCorrespondingPointIndex = 1;
    unsigned int verticalCorrespondingPointIndex = 3;
    if (index == 1)</span>
    {
<span style = "background-color:#fdd">      horizontalCorrespondingPointIndex = 0;
      verticalCorrespondingPointIndex = 2;
    }
    else if (index == 2)</span>
    {
<span style = "background-color:#fdd">      horizontalCorrespondingPointIndex = 3;
      verticalCorrespondingPointIndex = 1;
    }
    else if (index == 3)</span>
    {
<span style = "background-color:#fdd">      horizontalCorrespondingPointIndex = 2;
      verticalCorrespondingPointIndex = 0;</span>
    }

<span style = "background-color:#fdd">    Point2D verticalCorrespondingPoint = GetControlPoint(verticalCorrespondingPointIndex);
    verticalCorrespondingPoint[0] = point[0];
    PlanarFigure::SetControlPoint(verticalCorrespondingPointIndex, verticalCorrespondingPoint);</span>

<span style = "background-color:#fdd">    Point2D horizontalCorrespondingPoint = GetControlPoint(horizontalCorrespondingPointIndex);
    horizontalCorrespondingPoint[1] = point[1];
    PlanarFigure::SetControlPoint(horizontalCorrespondingPointIndex, horizontalCorrespondingPoint);</span>
  }

<span style = "background-color:#fdd">  return set;
}</span>

void mitk::PlanarRectangle::PlaceFigure(const mitk::Point2D &amp;point)
<span style = "background-color:#fdd">{
  PlanarFigure::PlaceFigure(point);
  m_SelectedControlPoint = 3;
}</span>

void mitk::PlanarRectangle::GeneratePolyLine()
<span style = "background-color:#fdd">{
  this-&gt;ClearPolyLines();</span>

<span style = "background-color:#fdd">  for (unsigned int i = 0; i &lt; this-&gt;GetNumberOfControlPoints(); ++i)
    this-&gt;AppendPointToPolyLine(0, this-&gt;GetControlPoint(i));
}</span>

void mitk::PlanarRectangle::GenerateHelperPolyLine(double /*mmPerDisplayUnit*/, unsigned int /*displayHeight*/)
<span style = "background-color:#fdd">{</span>
  // A polygon does not require helper objects
<span style = "background-color:#fdd">}</span>

void mitk::PlanarRectangle::EvaluateFeaturesInternal()
<span style = "background-color:#fdd">{</span>
  // Calculate circumference
<span style = "background-color:#fdd">  double circumference = 0.0;</span>
  unsigned int i;
<span style = "background-color:#fdd">  for (i = 0; i &lt; this-&gt;GetNumberOfControlPoints(); ++i)</span>
  {
<span style = "background-color:#fdd">    circumference += this-&gt;GetWorldControlPoint(i).EuclideanDistanceTo(</span>
      this-&gt;GetWorldControlPoint((i + 1) % this-&gt;GetNumberOfControlPoints()));
<span style = "background-color:#fdd">  }</span>

<span style = "background-color:#fdd">  this-&gt;SetQuantity(FEATURE_ID_CIRCUMFERENCE, circumference);</span>

  // Calculate rectangle area (well, done a bit clumsy...)
<span style = "background-color:#fdd">  double area = 0.0;
  if (this-&gt;GetPlaneGeometry() != nullptr)</span>
  {
<span style = "background-color:#fdd">    for (i = 0; i &lt; this-&gt;GetNumberOfControlPoints(); ++i)</span>
    {
<span style = "background-color:#fdd">      Point2D p0 = this-&gt;GetControlPoint(i);
      Point2D p1 = this-&gt;GetControlPoint((i + 1) % this-&gt;GetNumberOfControlPoints());</span>

<span style = "background-color:#fdd">      area += p0[0] * p1[1] - p1[0] * p0[1];
    }
    area /= 2.0;</span>
  }

<span style = "background-color:#fdd">  this-&gt;SetQuantity(FEATURE_ID_AREA, fabs(area));
}</span>

void mitk::PlanarRectangle::PrintSelf(std::ostream &amp;os, itk::Indent indent) const
<span style = "background-color:#fdd">{
  Superclass::PrintSelf(os, indent);</span>

<span style = "background-color:#fdd">  os &lt;&lt; indent &lt;&lt; "Number of control points: " &lt;&lt; this-&gt;GetNumberOfControlPoints() &lt;&lt; std::endl;</span>

<span style = "background-color:#fdd">  os &lt;&lt; indent &lt;&lt; "Control points:" &lt;&lt; std::endl;</span>

<span style = "background-color:#fdd">  for (unsigned int i = 0; i &lt; this-&gt;GetNumberOfControlPoints(); ++i)</span>
  {
<span style = "background-color:#fdd">    os &lt;&lt; indent &lt;&lt; indent &lt;&lt; i &lt;&lt; ": " &lt;&lt; GetControlPoint(i) &lt;&lt; std::endl;
  }
}</span>

bool mitk::PlanarRectangle::Equals(const mitk::PlanarFigure &amp;other) const
<span style = "background-color:#fdd">{
  const auto *otherRectangle = dynamic_cast&lt;const mitk::PlanarRectangle *&gt;(&amp;other);
  if (otherRectangle)</span>
  {
<span style = "background-color:#fdd">    return Superclass::Equals(other);
  }</span>
  else
  {
<span style = "background-color:#fdd">    return false;</span>
  }
<span style = "background-color:#fdd">}</span></pre>
	</body>
</html>