<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkSTLFileReader.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/
#include "mitkSTLFileReader.h"
#include &lt;mitkSurface.h&gt;
#include &lt;vtkCleanPolyData.h&gt;
#include &lt;vtkPolyData.h&gt;
#include &lt;vtkPolyDataNormals.h&gt;
#include &lt;vtkSTLReader.h&gt;
#include &lt;vtkSmartPointer.h&gt;

<span style = "background-color:#fdd">mitk::STLFileReader::STLFileReader() : mitk::SurfaceSource(), m_FileName("")
{
}</span>

mitk::STLFileReader::~STLFileReader()
<span style = "background-color:#fdd">{
}</span>

void mitk::STLFileReader::GenerateData()
<span style = "background-color:#fdd">{
  mitk::Surface::Pointer output = this-&gt;GetOutput();</span>

<span style = "background-color:#fdd">  if (m_FileName != "")</span>
  {
<span style = "background-color:#fdd">    MITK_INFO("mitkSTLFileReader") &lt;&lt; "Loading " &lt;&lt; m_FileName &lt;&lt; " as stl..." &lt;&lt; std::endl;
    vtkSmartPointer&lt;vtkSTLReader&gt; stlReader = vtkSmartPointer&lt;vtkSTLReader&gt;::New();
    stlReader-&gt;SetFileName(m_FileName.c_str());</span>

<span style = "background-color:#fdd">    vtkSmartPointer&lt;vtkPolyDataNormals&gt; normalsGenerator = vtkSmartPointer&lt;vtkPolyDataNormals&gt;::New();
    normalsGenerator-&gt;SetInputConnection(stlReader-&gt;GetOutputPort());</span>

<span style = "background-color:#fdd">    vtkSmartPointer&lt;vtkCleanPolyData&gt; cleanPolyDataFilter = vtkSmartPointer&lt;vtkCleanPolyData&gt;::New();
    cleanPolyDataFilter-&gt;SetInputConnection(normalsGenerator-&gt;GetOutputPort());
    cleanPolyDataFilter-&gt;PieceInvariantOff();
    cleanPolyDataFilter-&gt;ConvertLinesToPointsOff();
    cleanPolyDataFilter-&gt;ConvertPolysToLinesOff();
    cleanPolyDataFilter-&gt;ConvertStripsToPolysOff();
    cleanPolyDataFilter-&gt;PointMergingOn();
    cleanPolyDataFilter-&gt;Update();</span>

<span style = "background-color:#fdd">    if ((stlReader-&gt;GetOutput() != nullptr) &amp;&amp; (cleanPolyDataFilter-&gt;GetOutput() != nullptr))</span>
    {
<span style = "background-color:#fdd">      vtkSmartPointer&lt;vtkPolyData&gt; surfaceWithNormals = cleanPolyDataFilter-&gt;GetOutput();
      output-&gt;SetVtkPolyData(surfaceWithNormals);
    }
  }
}</span>

bool mitk::STLFileReader::CanReadFile(const std::string filename,
                                      const std::string /*filePrefix*/,
                                      const std::string /*filePattern*/)
<span style = "background-color:#fdd">{</span>
  // First check the extension
<span style = "background-color:#fdd">  if (filename == "")</span>
  {
    // MITK_INFO&lt;&lt;"No filename specified."&lt;&lt;std::endl;
<span style = "background-color:#fdd">    return false;</span>
  }

<span style = "background-color:#fdd">  bool extensionFound = false;
  std::string::size_type STLPos = filename.rfind(".stl");
  if ((STLPos != std::string::npos) &amp;&amp; (STLPos == filename.length() - 4))</span>
  {
<span style = "background-color:#fdd">    extensionFound = true;</span>
  }

<span style = "background-color:#fdd">  STLPos = filename.rfind(".STL");
  if ((STLPos != std::string::npos) &amp;&amp; (STLPos == filename.length() - 4))</span>
  {
<span style = "background-color:#fdd">    extensionFound = true;</span>
  }

<span style = "background-color:#fdd">  if (!extensionFound)</span>
  {
    // MITK_INFO&lt;&lt;"The filename extension is not recognized."&lt;&lt;std::endl;
<span style = "background-color:#fdd">    return false;</span>
  }

<span style = "background-color:#fdd">  return true;
}</span></pre>
	</body>
</html>