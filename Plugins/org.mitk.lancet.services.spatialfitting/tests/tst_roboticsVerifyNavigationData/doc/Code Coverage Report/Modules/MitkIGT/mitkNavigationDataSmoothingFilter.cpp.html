<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkNavigationDataSmoothingFilter.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkNavigationDataSmoothingFilter.h"

mitk::NavigationDataSmoothingFilter::NavigationDataSmoothingFilter()
<span style = "background-color:#fdd">  : mitk::NavigationDataToNavigationDataFilter(),
    m_NumerOfValues(5)
{
}</span>

mitk::NavigationDataSmoothingFilter::~NavigationDataSmoothingFilter()
<span style = "background-color:#fdd">{
}</span>

void mitk::NavigationDataSmoothingFilter::GenerateData()
<span style = "background-color:#fdd">{
  DataObjectPointerArraySizeType numberOfInputs = this-&gt;GetNumberOfInputs();</span>

<span style = "background-color:#fdd">  if ( numberOfInputs == 0 ) return;</span>

<span style = "background-color:#fdd">  this-&gt;CreateOutputsForAllInputs();</span>

  //initialize list if nessesary
<span style = "background-color:#fdd">  if ( m_LastValuesList.size() != numberOfInputs )</span>
  {
<span style = "background-color:#fdd">    this-&gt;InitializeLastValuesList();</span>
  }

  //add current value to list
<span style = "background-color:#fdd">  for ( unsigned int i = 0; i &lt; numberOfInputs; ++i )</span>
  {
<span style = "background-color:#fdd">    this-&gt;AddValue(i,this-&gt;GetInput(i)-&gt;GetPosition());
  }</span>

  //generate output
<span style = "background-color:#fdd">  for (unsigned int i = 0; i &lt; numberOfInputs; ++i)</span>
  {
<span style = "background-color:#fdd">    const mitk::NavigationData* nd = this-&gt;GetInput(i);
    assert(nd);</span>

<span style = "background-color:#fdd">    mitk::NavigationData* output = this-&gt;GetOutput(i);
    assert(output);</span>

<span style = "background-color:#fdd">    output-&gt;Graft(nd); // copy all information from input to output</span>

<span style = "background-color:#fdd">    output-&gt;SetPosition(GetMean(i));</span>

<span style = "background-color:#fdd">    output-&gt;SetDataValid(nd-&gt;IsDataValid());
  }
}</span>

void mitk::NavigationDataSmoothingFilter::InitializeLastValuesList()
<span style = "background-color:#fdd">{
  m_LastValuesList = std::map&lt; int, std::map&lt; int , mitk::Point3D&gt; &gt;();</span>

<span style = "background-color:#fdd">  for ( unsigned int i = 0; i &lt; this-&gt;GetNumberOfOutputs(); ++i )</span>
  {
<span style = "background-color:#fdd">    std::map&lt;int,mitk::Point3D&gt; currentList;
    for ( int j = 0; j &lt; m_NumerOfValues; ++j )</span>
    {
<span style = "background-color:#fdd">      mitk::Point3D emptyPoint;
      emptyPoint.Fill(0);
      currentList.insert(std::pair&lt;int, mitk::Point3D&gt;(j, emptyPoint));
    }
    m_LastValuesList.insert(std::pair&lt;int, std::map&lt;int,mitk::Point3D&gt; &gt; (i,currentList));
  }
}</span>

void mitk::NavigationDataSmoothingFilter::AddValue(int outputID, mitk::Point3D value)
<span style = "background-color:#fdd">{
  for (int i = 1; i &lt; m_NumerOfValues; ++i)</span>
  {
<span style = "background-color:#fdd">    m_LastValuesList[outputID][i-1] = m_LastValuesList[outputID][i];
  }</span>

<span style = "background-color:#fdd">  m_LastValuesList[outputID][m_NumerOfValues-1] = value;
}</span>

mitk::Point3D mitk::NavigationDataSmoothingFilter::GetMean(int outputID)
<span style = "background-color:#fdd">{
  mitk::Point3D mean;
  mean.Fill(0);
  for (int i=0; i&lt;m_NumerOfValues; i++)</span>
  {
<span style = "background-color:#fdd">    mean[0] += m_LastValuesList[outputID][i][0];
    mean[1] += m_LastValuesList[outputID][i][1];
    mean[2] += m_LastValuesList[outputID][i][2];
  }
  mean[0] /= m_NumerOfValues;
  mean[1] /= m_NumerOfValues;
  mean[2] /= m_NumerOfValues;
  return mean;
}</span></pre>
	</body>
</html>