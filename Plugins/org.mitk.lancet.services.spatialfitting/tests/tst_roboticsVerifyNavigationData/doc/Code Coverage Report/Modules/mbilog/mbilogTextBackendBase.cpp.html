<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mbilogTextBackendBase.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mbilogTextBackendBase.h"
#include "mbilogLoggingTypes.h"
#include &lt;ctime&gt;
#include &lt;iomanip&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;

#ifdef _WIN32
#define USE_WIN32COLOREDCONSOLE
#include &lt;windows.h&gt;
#include "mbilogTextDictionary.h"
#endif

static bool g_init = false;

mbilog::TextBackendBase::~TextBackendBase()
<span style = "background-color:#fdd">{
}</span>

#ifdef USE_WIN32COLOREDCONSOLE

static HANDLE g_hConsole;

class AutoCategorize
{
protected:
  std::vector&lt;std::string&gt; path;

  std::string current, category;

  int pos;

  void flush()
<span style = "background-color:#dfd">  {
    if (current.size() &gt; 0)</span>
    {
<span style = "background-color:#dfd">      if (current.compare("..") == 0)</span>
      {
<span style = "background-color:#fdd">        if (path.size() &gt; 0)
          path.pop_back();
      }</span>
      else
      {
<span style = "background-color:#dfd">        path.push_back(current);</span>
      }
<span style = "background-color:#dfd">      current = "";</span>
    }
<span style = "background-color:#dfd">  }</span>

  std::string simplify(std::string x)
<span style = "background-color:#dfd">  {</span>
    bool redo;

<span style = "background-color:#dfd">    std::string lft(""), rgt("");</span>

    do
    {
<span style = "background-color:#dfd">      redo = false;</span>

<span style = "background-color:#dfd">      for (int r = 0; r &lt; sizeof(mbilog::replace) / sizeof(char *); r += 2)</span>
      {
<span style = "background-color:#dfd">        int s = static_cast&lt;int&gt;(strlen(mbilog::replace[r]));
        int xs = static_cast&lt;int&gt;(x.size());</span>

<span style = "background-color:#dfd">        if (xs == s)</span>
        {
<span style = "background-color:#dfd">          if (mbilog::replace[r + 1][0] || !lft.empty() || !rgt.empty())
            if (x.compare(mbilog::replace[r]) == 0)
              x = mbilog::replace[r + 1];
        }
        else if (xs &gt; s)</span>
        {
<span style = "background-color:#dfd">          if (strncmp(mbilog::replace[r], &amp;x.c_str()[xs - s], s) == 0)</span>
          {
<span style = "background-color:#dfd">            std::string rp = mbilog::replace[r + 1];
            if (!rp.empty())
              rp[0] = toupper(rp[0]);
            x = x.substr(0, xs - s);
            rgt = rp + rgt;
            redo = true;
          }
          else if (strncmp(mbilog::replace[r], x.c_str(), s) == 0)</span>
          {
<span style = "background-color:#dfd">            std::string rp = mbilog::replace[r + 1];
            if (!rp.empty())
              rp[0] = toupper(rp[0]);
            x = x.substr(s, xs - s);
            lft = lft + rp;
            redo = true;
          }</span>
        }
<span style = "background-color:#dfd">      }
    } while (redo);</span>

<span style = "background-color:#dfd">    x[0] = toupper(x[0]);</span>

<span style = "background-color:#dfd">    x = lft + x + rgt;</span>

<span style = "background-color:#dfd">    x[0] = tolower(x[0]);</span>

<span style = "background-color:#dfd">    return x;
  }</span>

  std::string concat(std::string a, std::string b, bool opt)
<span style = "background-color:#dfd">  {
    int as = static_cast&lt;int&gt;(a.size());
    int bs = static_cast&lt;int&gt;(b.size());
    if (opt &amp;&amp; as &lt;= bs)</span>
    {
<span style = "background-color:#dfd">      if (as == bs &amp;&amp; a.compare(b) == 0)</span>
<span style = "background-color:#fdd">        return a;</span>

<span style = "background-color:#dfd">      if (strncmp(a.c_str(), b.c_str(), as) == 0)</span>
      {
<span style = "background-color:#dfd">        b = b.substr(as, bs - as);
        b[0] = tolower(b[0]);</span>
      }
    }

<span style = "background-color:#dfd">    return a + "." + b;
  }</span>

  bool search2p2(char *a, char *b, bool optimize = true)
<span style = "background-color:#dfd">  {
    int size = static_cast&lt;int&gt;(path.size()) - 3;
    for (int r = 0; r &lt; size; r++)
      if (path[r].compare(a) == 0 &amp;&amp; path[r + 1].compare(b) == 0)</span>
      {
<span style = "background-color:#fdd">        pos = r + 2;
        category = concat(simplify(path[pos]), simplify(path[path.size() - 1]), optimize);
        return true;</span>
<span style = "background-color:#dfd">      }
    return false;
  }</span>

  bool search2p1(char *a, char *b)
<span style = "background-color:#dfd">  {
    int size = static_cast&lt;int&gt;(path.size()) - 2;
    for (int r = 0; r &lt; size; r++)
      if (path[r].compare(a) == 0 &amp;&amp; path[r + 1].compare(b) == 0)</span>
      {
<span style = "background-color:#fdd">        pos = r + 2;
        category = simplify(path[path.size() - 1]);
        return true;</span>
<span style = "background-color:#dfd">      }
    return false;
  }</span>

  bool search1p2(char *a, bool optimize = true)
<span style = "background-color:#dfd">  {
    int size = static_cast&lt;int&gt;(path.size()) - 2;
    for (int r = 0; r &lt; size; r++)
      if (path[r].compare(a) == 0)</span>
      {
<span style = "background-color:#dfd">        pos = r + 1;
        category = concat(simplify(path[pos]), simplify(path[path.size() - 1]), optimize);
        return true;
      }</span>
<span style = "background-color:#fdd">    return false;</span>
<span style = "background-color:#dfd">  }</span>

public:
<span style = "background-color:#dfd">  AutoCategorize(const mbilog::LogMessage &amp;l)</span>
  {
<span style = "background-color:#dfd">    int size = static_cast&lt;int&gt;(strlen(l.filePath));</span>

<span style = "background-color:#dfd">    current = "";</span>

<span style = "background-color:#dfd">    for (int r = 0; r &lt; size; r++)</span>
    {
<span style = "background-color:#dfd">      char c = l.filePath[r];
      if (c == '\\' || c == '/')
        flush();</span>
      else
<span style = "background-color:#dfd">        current += tolower(c);
    }</span>

<span style = "background-color:#dfd">    flush();
  }</span>

  std::string GetPrefix()
<span style = "background-color:#dfd">  {
    category = "";
    if (search2p2("mbi-sb", "core", false))</span>
<span style = "background-color:#fdd">      return "sb.";</span>
<span style = "background-color:#dfd">    if (search2p1("mbi-sb", "q4mitk"))</span>
<span style = "background-color:#fdd">      return "sb.ui.";</span>
<span style = "background-color:#dfd">    if (search2p2("mbi", "applications"))</span>
<span style = "background-color:#fdd">      return "sb.app.";</span>
<span style = "background-color:#dfd">    if (search2p2("mbi-sb", "q4applications"))</span>
<span style = "background-color:#fdd">      return "sb.app.";</span>
<span style = "background-color:#dfd">    if (search2p2("mbi-sb", "utilities"))</span>
<span style = "background-color:#fdd">      return "sb.util.";</span>
<span style = "background-color:#dfd">    if (search2p2("mbi-sb", "bundles"))</span>
<span style = "background-color:#fdd">      return "sb.bun.";</span>
<span style = "background-color:#dfd">    if (search2p2("mbi-sb", "bundlesqt"))</span>
<span style = "background-color:#fdd">      return "sb.bun.";</span>
<span style = "background-color:#dfd">    if (search2p2("mbi", "modules"))</span>
<span style = "background-color:#fdd">      return "sb.mod.";</span>

<span style = "background-color:#dfd">    if (search2p2("mbi-qm", "core", false))</span>
<span style = "background-color:#fdd">      return "qm.";</span>
<span style = "background-color:#dfd">    if (search2p2("mbi-qm", "utilities"))</span>
<span style = "background-color:#fdd">      return "qm.util.";</span>

<span style = "background-color:#dfd">    if (search2p2("modules", "mitkext", false))</span>
<span style = "background-color:#fdd">      return "ext.";</span>
<span style = "background-color:#dfd">    if (search2p1("modules", "qmitkext"))</span>
<span style = "background-color:#fdd">      return "ext.ui.";</span>
<span style = "background-color:#dfd">    if (search2p2("modules", "bundles"))</span>
<span style = "background-color:#fdd">      return "ext.bun.";</span>

<span style = "background-color:#dfd">    if (search2p2("blueberry", "bundles"))</span>
<span style = "background-color:#fdd">      return "blueberry.";</span>

<span style = "background-color:#dfd">    if (search2p2("core", "code", false))</span>
<span style = "background-color:#fdd">      return "core.";</span>
<span style = "background-color:#dfd">    if (search2p1("coreui", "qmitk"))</span>
<span style = "background-color:#fdd">      return "core.ui.";</span>
<span style = "background-color:#dfd">    if (search2p2("coreui", "bundles"))</span>
<span style = "background-color:#fdd">      return "core.bun.";</span>

    // following must come last:
<span style = "background-color:#dfd">    if (search1p2("modules"))
      return "core.mod.";</span>
<span style = "background-color:#fdd">    if (search1p2("utilities"))
      return "core.util.";
    if (search1p2("applications"))
      return "core.app.";</span>

<span style = "background-color:#fdd">    return "";</span>
<span style = "background-color:#dfd">  }</span>

<span style = "background-color:#dfd">  std::string GetCategory() { return category; }</span>
};

#endif

void mbilog::TextBackendBase::FormatSmart(std::ostream &amp;out, const LogMessage &amp;l, int /*threadID*/)
<span style = "background-color:#fdd">{
  char c_open = '[';
  char c_close = ']';</span>

<span style = "background-color:#fdd">  switch (l.level)</span>
  {
    case mbilog::Info:
<span style = "background-color:#fdd">      break;</span>

    case mbilog::Warn:
<span style = "background-color:#fdd">      c_open = '!';
      c_close = '!';
      break;</span>

    case mbilog::Error:
<span style = "background-color:#fdd">      c_open = '#';
      c_close = '#';
      break;</span>

    case mbilog::Fatal:
<span style = "background-color:#fdd">      c_open = '*';
      c_close = '*';
      break;</span>

    case mbilog::Debug:
<span style = "background-color:#fdd">      c_open = '{';
      c_close = '}';</span>
      break;
  }

<span style = "background-color:#fdd">  out &lt;&lt; c_open;</span>

<span style = "background-color:#fdd">  if (!g_init)</span>
  {
<span style = "background-color:#fdd">    g_init = true;
    AppendTimeStamp(out);
    out &lt;&lt; std::endl;</span>
  }

<span style = "background-color:#fdd">  std::locale C("C");
  std::locale originalLocale = out.getloc();
  out.imbue(C);</span>

<span style = "background-color:#fdd">  out &lt;&lt; std::fixed &lt;&lt; std::setprecision(3) &lt;&lt; ((double)std::clock()) / CLOCKS_PER_SEC;</span>

<span style = "background-color:#fdd">  out.imbue(originalLocale);</span>

<span style = "background-color:#fdd">  out &lt;&lt; c_close &lt;&lt; " ";</span>

<span style = "background-color:#fdd">  if (!l.category.empty())</span>
  {
<span style = "background-color:#fdd">    out &lt;&lt; "[" &lt;&lt; l.category &lt;&lt; "] ";</span>
  }

<span style = "background-color:#fdd">  switch (l.level)</span>
  {
    case mbilog::Info:
<span style = "background-color:#fdd">      break;</span>

    case mbilog::Warn:
<span style = "background-color:#fdd">      out &lt;&lt; "WARNING: ";
      break;</span>

    case mbilog::Error:
<span style = "background-color:#fdd">      out &lt;&lt; "ERROR: ";
      break;</span>

    case mbilog::Fatal:
<span style = "background-color:#fdd">      out &lt;&lt; "FATAL: ";
      break;</span>

    case mbilog::Debug:
<span style = "background-color:#fdd">      out &lt;&lt; "DEBUG: ";</span>
      break;
  }

<span style = "background-color:#fdd">  out &lt;&lt; l.message &lt;&lt; std::endl;
}</span>

void mbilog::TextBackendBase::FormatFull(std::ostream &amp;out, const LogMessage &amp;l, int threadID)
<span style = "background-color:#fdd">{
  switch (l.level)</span>
  {
    case mbilog::Info:
<span style = "background-color:#fdd">      out &lt;&lt; "INFO";
      break;</span>

    case mbilog::Warn:
<span style = "background-color:#fdd">      out &lt;&lt; "WARN";
      break;</span>

    case mbilog::Error:
<span style = "background-color:#fdd">      out &lt;&lt; "ERROR";
      break;</span>

    case mbilog::Fatal:
<span style = "background-color:#fdd">      out &lt;&lt; "FATAL";
      break;</span>

    case mbilog::Debug:
<span style = "background-color:#fdd">      out &lt;&lt; "DEBUG";</span>
      break;
  }

<span style = "background-color:#fdd">  out &lt;&lt; "|";</span>

<span style = "background-color:#fdd">  AppendTimeStamp(out);</span>

<span style = "background-color:#fdd">  out &lt;&lt; "|";</span>

<span style = "background-color:#fdd">  out &lt;&lt; "|" &lt;&lt; std::string(l.filePath) &lt;&lt; "(" &lt;&lt; l.lineNumber &lt;&lt; ")";</span>

<span style = "background-color:#fdd">  out &lt;&lt; "|" &lt;&lt; std::string(l.functionName);</span>

  // if(threadID)
  {
<span style = "background-color:#fdd">    out &lt;&lt; "|" &lt;&lt; std::hex &lt;&lt; threadID;</span>
  }

  // if(NA_STRING != l.moduleName)
  {
<span style = "background-color:#fdd">    out &lt;&lt; "|" &lt;&lt; std::string(l.moduleName);</span>
  }

  // if(!l.category.empty())
  {
<span style = "background-color:#fdd">    out &lt;&lt; "|" &lt;&lt; l.category;</span>
  }

<span style = "background-color:#fdd">  out &lt;&lt; l.message &lt;&lt; std::endl;
}</span>

void mbilog::TextBackendBase::FormatSmart(const LogMessage &amp;l, int threadID)
<span style = "background-color:#dfd">{</span>
#ifdef USE_WIN32COLOREDCONSOLE
<span style = "background-color:#dfd">  FormatSmartWindows(l, threadID);</span>
#else
  FormatSmart(std::cout, l, threadID);
#endif
<span style = "background-color:#dfd">}</span>

void mbilog::TextBackendBase::FormatFull(const LogMessage &amp;l, int threadID)
<span style = "background-color:#fdd">{
  FormatFull(std::cout, l, threadID);
}</span>

void mbilog::TextBackendBase::AppendTimeStamp(std::ostream &amp;out)
<span style = "background-color:#dfd">{
  time_t rawtime = time(nullptr);
  std::string timestring(ctime(&amp;rawtime));
  timestring.replace(timestring.length() - 1,</span>
                     1,
                     " "); // replace \n by " " (separates date/time from following output of relative time since start)

<span style = "background-color:#dfd">  std::locale C("C");
  std::locale originalLocale = out.getloc();
  out.imbue(C);</span>

<span style = "background-color:#dfd">  out &lt;&lt; timestring;</span>

<span style = "background-color:#dfd">  out.imbue(originalLocale);
}</span>

#ifdef USE_WIN32COLOREDCONSOLE

// Get the horizontal and vertical screen sizes in pixel
void GetDesktopResolution(int&amp; horizontal, int&amp; vertical)
<span style = "background-color:#dfd">{</span>
    RECT desktop;
    // Get a handle to the desktop window
<span style = "background-color:#dfd">    const HWND hDesktop = GetDesktopWindow();</span>
    // Get the size of screen to the variable desktop
<span style = "background-color:#dfd">    GetWindowRect(hDesktop, &amp;desktop);</span>
    // The top left corner will have coordinates (0,0)
      // and the bottom right corner will have coordinates
      // (horizontal, vertical)
<span style = "background-color:#dfd">    horizontal = desktop.right;
    vertical = desktop.bottom;
}</span>

BOOL CALLBACK MonitorEnumProc(HMONITOR hMonitor, HDC hdcMonitor, LPRECT lprcMonitor, LPARAM dwData)
<span style = "background-color:#dfd"> {
  int *Count = (int*)dwData;
  (*Count)++;
  return TRUE;
  }</span>

int GetMonitorCount()
<span style = "background-color:#dfd"> {
  int Count = 0;
  if (EnumDisplayMonitors(NULL, NULL, MonitorEnumProc, (LPARAM)&amp;Count))
     return Count;</span>
<span style = "background-color:#fdd">  return -1;//signals an error</span>
<span style = "background-color:#dfd">}</span>

void mbilog::TextBackendBase::FormatSmartWindows(const mbilog::LogMessage &amp;l, int /*threadID*/)
<span style = "background-color:#dfd">{
  int colorNormal = FOREGROUND_RED | FOREGROUND_GREEN | FOREGROUND_BLUE;</span>

<span style = "background-color:#dfd">  int lastColor = colorNormal;</span>
#define ChangeColor(_col)                                                                                              \
  {                                                                                                                    \
    int col = (_col);                                                                                                  \
    if (lastColor != (col))                                                                                            \
    {                                                                                                                  \
      SetConsoleTextAttribute(g_hConsole, (col));                                                                      \
      lastColor = (col);                                                                                               \
    }                                                                                                                  \
  }

<span style = "background-color:#dfd">  int colorTime = FOREGROUND_GREEN;
  int colorText = FOREGROUND_RED | FOREGROUND_GREEN | FOREGROUND_BLUE;
  int colorCat = FOREGROUND_BLUE | FOREGROUND_RED;
  bool showColon = true;
  bool forceCat = false;</span>

<span style = "background-color:#dfd">  if (!g_init)</span>
  {
<span style = "background-color:#dfd">    g_hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
    g_init = true;</span>

<span style = "background-color:#dfd">    std::string title = "mbilog";</span>

<span style = "background-color:#dfd">    SetConsoleTitle(title.c_str());</span>

    /* Title rendering
    ChangeColor( FOREGROUND_GREEN|FOREGROUND_BLUE|BACKGROUND_BLUE );
    std::cout &lt;&lt; " &lt;&lt;&lt; " &lt;&lt; std::flush;
    ChangeColor( FOREGROUND_RED|FOREGROUND_GREEN|FOREGROUND_BLUE|FOREGROUND_INTENSITY|BACKGROUND_BLUE );
    std::cout &lt;&lt; title &lt;&lt; std::flush;
    ChangeColor( FOREGROUND_GREEN|FOREGROUND_BLUE|BACKGROUND_BLUE );
    std::cout &lt;&lt; " &gt;&gt;&gt; " &lt;&lt; std::flush;
    ChangeColor( colorNormal );
    std::cout &lt;&lt; std::endl;
    */

    // Give out start time
<span style = "background-color:#dfd">    ChangeColor(colorTime);
    AppendTimeStamp(std::cout);
    std::cout &lt;&lt; std::endl;
  }</span>

<span style = "background-color:#dfd">  switch (l.level)</span>
  {
    case mbilog::Info:
<span style = "background-color:#fdd">      break;</span>

    case mbilog::Warn:
<span style = "background-color:#fdd">      colorTime = FOREGROUND_RED | FOREGROUND_GREEN | FOREGROUND_INTENSITY;</span>
      // colorText = FOREGROUND_RED|FOREGROUND_GREEN;
<span style = "background-color:#fdd">      colorCat = FOREGROUND_BLUE | FOREGROUND_RED | FOREGROUND_INTENSITY;
      showColon = false;
      forceCat = true;
      break;</span>

    case mbilog::Error:
<span style = "background-color:#fdd">      colorTime = FOREGROUND_RED | FOREGROUND_INTENSITY;</span>
      // colorText = FOREGROUND_RED;
<span style = "background-color:#fdd">      colorCat = FOREGROUND_BLUE | FOREGROUND_RED | FOREGROUND_INTENSITY;
      showColon = false;
      forceCat = true;
      break;</span>

    case mbilog::Fatal:
<span style = "background-color:#fdd">      colorTime = FOREGROUND_RED | FOREGROUND_BLUE | FOREGROUND_INTENSITY;</span>
      // colorText = FOREGROUND_RED|FOREGROUND_BLUE|FOREGROUND_INTENSITY;
<span style = "background-color:#fdd">      colorCat = FOREGROUND_BLUE | FOREGROUND_RED | FOREGROUND_INTENSITY;
      showColon = false;
      forceCat = true;
      break;</span>

    case mbilog::Debug:
<span style = "background-color:#dfd">      colorTime = FOREGROUND_BLUE | FOREGROUND_INTENSITY;</span>
      // colorText |= FOREGROUND_INTENSITY;
<span style = "background-color:#dfd">      showColon = false;</span>
      break;
  }

<span style = "background-color:#dfd">  ChangeColor(colorTime);</span>

<span style = "background-color:#dfd">  std::locale C("C");
  std::locale originalLocale = std::cout.getloc();
  std::cout.imbue(C);</span>

<span style = "background-color:#dfd">  std::cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(2) &lt;&lt; ((double)std::clock()) / CLOCKS_PER_SEC &lt;&lt; " ";</span>

<span style = "background-color:#dfd">  std::cout.imbue(originalLocale);</span>

  // category
  {
<span style = "background-color:#dfd">    AutoCategorize ac(l);
    std::string pre = ac.GetPrefix();
    std::string cat = ac.GetCategory();</span>

<span style = "background-color:#dfd">    cat = pre + cat;</span>

<span style = "background-color:#dfd">    if (cat.empty())</span>
<span style = "background-color:#fdd">      cat = l.category;</span>

<span style = "background-color:#dfd">    if (!cat.empty())</span>
    {
<span style = "background-color:#dfd">      ChangeColor(colorCat);</span>
      // static std::string lastCat;
      // if(forceCat||lastCat.compare(cat))
      {
<span style = "background-color:#dfd">        std::cout &lt;&lt; cat &lt;&lt; std::flush;</span>
        // lastCat = cat;
      }
      // else
      // std::cout &lt;&lt; "..." &lt;&lt; std::flush;

<span style = "background-color:#dfd">      if (showColon)</span>
      {
<span style = "background-color:#fdd">        ChangeColor(FOREGROUND_BLUE | FOREGROUND_INTENSITY);
        std::cout &lt;&lt; ": " &lt;&lt; std::flush;
      }</span>
      else
<span style = "background-color:#dfd">        std::cout &lt;&lt; " ";</span>
    }
<span style = "background-color:#dfd">  }</span>

<span style = "background-color:#dfd">  switch (l.level)</span>
  {
    case mbilog::Info:
<span style = "background-color:#fdd">      break;</span>

    case mbilog::Warn:
<span style = "background-color:#fdd">      ChangeColor(colorTime);
      std::cout &lt;&lt; "WARNING" &lt;&lt; std::flush;
      ChangeColor(FOREGROUND_BLUE | FOREGROUND_INTENSITY);
      std::cout &lt;&lt; ": " &lt;&lt; std::flush;
      break;</span>

    case mbilog::Error:
<span style = "background-color:#fdd">      ChangeColor(colorTime);
      std::cout &lt;&lt; "ERROR" &lt;&lt; std::flush;
      ChangeColor(FOREGROUND_BLUE | FOREGROUND_INTENSITY);
      std::cout &lt;&lt; ": " &lt;&lt; std::flush;
      break;</span>

    case mbilog::Fatal:
<span style = "background-color:#fdd">      ChangeColor(colorTime);
      std::cout &lt;&lt; "FATAL" &lt;&lt; std::flush;
      ChangeColor(FOREGROUND_BLUE | FOREGROUND_INTENSITY);
      std::cout &lt;&lt; ": " &lt;&lt; std::flush;
      break;</span>

    case mbilog::Debug:
<span style = "background-color:#dfd">      ChangeColor(colorTime);
      std::cout &lt;&lt; "DBG" &lt;&lt; std::flush;
      ChangeColor(FOREGROUND_BLUE | FOREGROUND_INTENSITY);
      std::cout &lt;&lt; ": " &lt;&lt; std::flush;</span>
      break;
  }

<span style = "background-color:#dfd">  ChangeColor(colorText);
  std::cout &lt;&lt; l.message &lt;&lt; std::endl;</span>

<span style = "background-color:#dfd">  ChangeColor(colorNormal);</span>

<span style = "background-color:#dfd">  int monitorCount = GetMonitorCount();
  if (monitorCount &gt; 1) {
    HWND consoleWindow = GetConsoleWindow();
    int horizontal = 0, vertical = 0;
    const int verticalSizeOfConsoleWindow = 300;
    GetDesktopResolution(horizontal, vertical);
    SetWindowPos(consoleWindow, 0, horizontal, vertical/2 - verticalSizeOfConsoleWindow, 0, 0, SWP_NOSIZE | SWP_NOZORDER);</span>
  }

<span style = "background-color:#dfd">}</span>

#endif</pre>
	</body>
</html>