<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkAIFBasedModelBase.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkAIFBasedModelBase.h"
#include "mitkTimeGridHelper.h"
#include "mitkAIFParametrizerHelper.h"

#include "itkArray2D.h"


<span style = "background-color:#dfd">const std::string mitk::AIFBasedModelBase::NAME_STATIC_PARAMETER_AIF = "Aterial Input Function";
const std::string mitk::AIFBasedModelBase::NAME_STATIC_PARAMETER_AIFTimeGrid =
  "Aterial Input Function Timegrid";</span>

//Assumed AIF is always extracted from concentration image
<span style = "background-color:#dfd">const std::string mitk::AIFBasedModelBase::UNIT_STATIC_PARAMETER_AIF = "C";
const std::string mitk::AIFBasedModelBase::UNIT_STATIC_PARAMETER_AIFTimeGrid =
  "s";</span>

std::string mitk::AIFBasedModelBase::GetXAxisName() const
<span style = "background-color:#fdd">{
  return "Time";
};</span>

std::string mitk::AIFBasedModelBase::GetXAxisUnit() const
<span style = "background-color:#fdd">{
  return "s";
}</span>

std::string mitk::AIFBasedModelBase::GetYAxisName() const
<span style = "background-color:#fdd">{
  return "";
};</span>

std::string mitk::AIFBasedModelBase::GetYAxisUnit() const
<span style = "background-color:#fdd">{
  return "";
}</span>

mitk::AIFBasedModelBase::AIFBasedModelBase()
<span style = "background-color:#dfd">{
}</span>

mitk::AIFBasedModelBase::~AIFBasedModelBase()
<span style = "background-color:#dfd">{
}</span>

const mitk::AIFBasedModelBase::TimeGridType&amp;
mitk::AIFBasedModelBase::GetCurrentAterialInputFunctionTimeGrid() const
<span style = "background-color:#fdd">{
  if (!m_AterialInputFunctionTimeGrid.empty())</span>
  {
<span style = "background-color:#fdd">    return m_AterialInputFunctionTimeGrid;
  }</span>
  else
  {
<span style = "background-color:#fdd">    return m_TimeGrid;</span>
  }
<span style = "background-color:#fdd">};</span>

const mitk::AIFBasedModelBase::AterialInputFunctionType
mitk::AIFBasedModelBase::GetAterialInputFunction(TimeGridType CurrentTimeGrid) const
<span style = "background-color:#fdd">{
  if (CurrentTimeGrid.GetSize() == 0)</span>
  {
<span style = "background-color:#fdd">    return this-&gt;m_AterialInputFunctionValues;
  }</span>
  else
  {
<span style = "background-color:#fdd">    return mitk::InterpolateSignalToNewTimeGrid(m_AterialInputFunctionValues,</span>
           GetCurrentAterialInputFunctionTimeGrid(), CurrentTimeGrid);
  }
<span style = "background-color:#fdd">}</span>

mitk::AIFBasedModelBase::ParameterNamesType mitk::AIFBasedModelBase::GetStaticParameterNames() const
<span style = "background-color:#fdd">{
  ParameterNamesType result;</span>

<span style = "background-color:#fdd">  result.push_back(NAME_STATIC_PARAMETER_AIF);
  result.push_back(NAME_STATIC_PARAMETER_AIFTimeGrid);</span>

<span style = "background-color:#fdd">  return result;
}</span>

mitk::AIFBasedModelBase::ParametersSizeType  mitk::AIFBasedModelBase::GetNumberOfStaticParameters()
const
<span style = "background-color:#fdd">{
  return 2;
}</span>

mitk::AIFBasedModelBase::ParamterUnitMapType
mitk::AIFBasedModelBase::GetStaticParameterUnits() const
<span style = "background-color:#fdd">{
  ParamterUnitMapType result;</span>

<span style = "background-color:#fdd">  result.insert(std::make_pair(NAME_STATIC_PARAMETER_AIF, UNIT_STATIC_PARAMETER_AIF));
  result.insert(std::make_pair(NAME_STATIC_PARAMETER_AIFTimeGrid, UNIT_STATIC_PARAMETER_AIFTimeGrid));</span>

<span style = "background-color:#fdd">  return result;
};</span>


void mitk::AIFBasedModelBase::SetStaticParameter(const ParameterNameType&amp; name,
    const StaticParameterValuesType&amp; values)
<span style = "background-color:#fdd">{
  if (name == NAME_STATIC_PARAMETER_AIF)</span>
  {
<span style = "background-color:#fdd">    AterialInputFunctionType aif = mitk::convertParameterToArray(values);</span>

<span style = "background-color:#fdd">    SetAterialInputFunctionValues(aif);
  }</span>

<span style = "background-color:#fdd">  if (name == NAME_STATIC_PARAMETER_AIFTimeGrid)</span>
  {
<span style = "background-color:#fdd">    TimeGridType timegrid = mitk::convertParameterToArray(values);</span>

<span style = "background-color:#fdd">    SetAterialInputFunctionTimeGrid(timegrid);
  }
};</span>

mitk::AIFBasedModelBase::StaticParameterValuesType mitk::AIFBasedModelBase::GetStaticParameterValue(
  const ParameterNameType&amp; name) const
<span style = "background-color:#fdd">{
  StaticParameterValuesType result;</span>

<span style = "background-color:#fdd">  if (name == NAME_STATIC_PARAMETER_AIF)</span>
  {
<span style = "background-color:#fdd">    result = mitk::convertArrayToParameter(this-&gt;m_AterialInputFunctionValues);</span>
  }

<span style = "background-color:#fdd">  if (name == NAME_STATIC_PARAMETER_AIFTimeGrid)</span>
  {
<span style = "background-color:#fdd">    result = mitk::convertArrayToParameter(this-&gt;m_AterialInputFunctionTimeGrid);</span>
  }

<span style = "background-color:#fdd">  return result;
};</span>

bool mitk::AIFBasedModelBase::ValidateModel(std::string&amp; error) const
<span style = "background-color:#fdd">{
  bool result = Superclass::ValidateModel(error);</span>

<span style = "background-color:#fdd">  if (result)</span>
  {
<span style = "background-color:#fdd">    if (m_AterialInputFunctionTimeGrid.empty())</span>
    {
<span style = "background-color:#fdd">      if (this-&gt;m_TimeGrid.GetSize() != m_AterialInputFunctionValues.GetSize())</span>
      {
<span style = "background-color:#fdd">        result = false;
        error = "Number of elements of Model Time Grid does not match number of elements in Aterial Input Function! Set valid aif or aif time grid.";</span>
      }
<span style = "background-color:#fdd">    }</span>
    else
    {
<span style = "background-color:#fdd">      if (m_AterialInputFunctionTimeGrid.GetSize() != m_AterialInputFunctionValues.GetSize())</span>
      {
<span style = "background-color:#fdd">        result = false;
        error = "Number of elements of Aterial Input Function Time Grid does not match number of elements of Aterial Input Function Values! Set valid curve";</span>
      }
    }
  }

<span style = "background-color:#fdd">  return result;
};</span>

void mitk::AIFBasedModelBase::PrintSelf(std::ostream&amp; os, ::itk::Indent indent) const
<span style = "background-color:#fdd">{
  Superclass::PrintSelf(os, indent);</span>

<span style = "background-color:#fdd">  os &lt;&lt; indent &lt;&lt; "Aterial Input Function: " &lt;&lt; m_AterialInputFunctionValues;
  os &lt;&lt; indent &lt;&lt; "Aterial Input Function Time Grid: " &lt;&lt; m_AterialInputFunctionTimeGrid;
};</span>

</pre>
	</body>
</html>