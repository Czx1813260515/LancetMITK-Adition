<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>mitkNavigationDataSet.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
/*============================================================================

The Medical Imaging Interaction Toolkit (MITK)

Copyright (c) German Cancer Research Center (DKFZ)
All rights reserved.

Use of this source code is governed by a 3-clause BSD license that can be
found in the LICENSE file.

============================================================================*/

#include "mitkNavigationDataSet.h"
#include "mitkPointSet.h"
#include "mitkBaseRenderer.h"

mitk::NavigationDataSet::NavigationDataSet( unsigned int numberOfTools )
<span style = "background-color:#fdd">  : m_NavigationDataVectors(std::vector&lt;std::vector&lt;mitk::NavigationData::Pointer&gt; &gt;()), m_NumberOfTools(numberOfTools)
{
}</span>

mitk::NavigationDataSet::~NavigationDataSet( )
<span style = "background-color:#fdd">{
}</span>

bool mitk::NavigationDataSet::AddNavigationDatas( std::vector&lt;mitk::NavigationData::Pointer&gt; navigationDatas )
<span style = "background-color:#fdd">{</span>
  // test if tool with given index exist
<span style = "background-color:#fdd">  if ( navigationDatas.size() != m_NumberOfTools )</span>
  {
<span style = "background-color:#fdd">    MITK_WARN("NavigationDataSet") &lt;&lt; "Tried to add too many or too few navigation Datas to NavigationDataSet. " &lt;&lt; m_NumberOfTools &lt;&lt; " required, tried to add " &lt;&lt; navigationDatas.size() &lt;&lt; ".";
    return false;</span>
  }

  // test for consistent timestamp
<span style = "background-color:#fdd">  if ( m_NavigationDataVectors.size() &gt; 0)</span>
  {
<span style = "background-color:#fdd">    for (std::vector&lt;mitk::NavigationData::Pointer&gt;::size_type i = 0; i &lt; navigationDatas.size(); i++)
      if (navigationDatas[i]-&gt;GetIGTTimeStamp() &lt;= m_NavigationDataVectors.back()[i]-&gt;GetIGTTimeStamp())</span>
      {
<span style = "background-color:#fdd">        MITK_WARN("NavigationDataSet") &lt;&lt; "IGTTimeStamp of new NavigationData should be newer than timestamp of last NavigationData.";
        return false;
      }</span>
  }

<span style = "background-color:#fdd">  m_NavigationDataVectors.push_back(navigationDatas);
  return true;
}</span>

mitk::NavigationData::Pointer mitk::NavigationDataSet::GetNavigationDataForIndex( unsigned int index, unsigned int toolIndex ) const
<span style = "background-color:#fdd">{
  if ( index &gt;= m_NavigationDataVectors.size() )</span>
  {
<span style = "background-color:#fdd">    MITK_WARN("NavigationDataSet") &lt;&lt; "There is no NavigationData available at index " &lt;&lt; index &lt;&lt; ".";
    return nullptr;</span>
  }

<span style = "background-color:#fdd">  if ( toolIndex &gt;= m_NavigationDataVectors.at(index).size() )</span>
  {
<span style = "background-color:#fdd">    MITK_WARN("NavigationDataSet") &lt;&lt; "There is NavigatitionData available at index " &lt;&lt; index &lt;&lt; " for tool " &lt;&lt; toolIndex &lt;&lt; ".";
    return nullptr;</span>
  }

<span style = "background-color:#fdd">  return m_NavigationDataVectors.at(index).at(toolIndex);
}</span>

// Method not yet supported, code below compiles but delivers wrong results
//mitk::NavigationData::Pointer mitk::NavigationDataSet::GetNavigationDataBeforeTimestamp(
//  mitk::NavigationData::TimeStampType timestamp, unsigned int toolIndex) const
//{
//  if ( toolIndex &gt;= m_NavigationDataVectors.size() )
//  {
//    MITK_WARN("NavigationDataSet") &lt;&lt; "There is no tool with index " &lt;&lt; toolIndex &lt;&lt; ".";
//    return nullptr;
//  }
//
//  std::vector&lt;mitk::NavigationData::Pointer&gt;::const_iterator it;
//
//  // iterate through all NavigationData objects of the given tool index
//  // till the timestamp of the NavigationData is greater then the given timestamp
//  for (it = m_NavigationDataVectors.at(toolIndex).begin();
//    it != m_NavigationDataVectors.at(toolIndex).end(); ++it)
//  {
//    if ( (*it)-&gt;GetIGTTimeStamp() &gt; timestamp) { break; }
//  }
//
//  // first element was greater than timestamp -&gt; return null
//  if ( it == m_NavigationDataVectors.at(toolIndex).begin() )
//  {
//    MITK_WARN("NavigationDataSet") &lt;&lt; "No NavigationData was recorded before given timestamp.";
//    return nullptr;
//  }
//
//  // return last element smaller than the given timestamp
//  return *(it-1);
//}

std::vector&lt; mitk::NavigationData::Pointer &gt; mitk::NavigationDataSet::GetDataStreamForTool(unsigned int toolIndex)
<span style = "background-color:#fdd">{
  if (toolIndex &gt;= m_NumberOfTools )</span>
  {
<span style = "background-color:#fdd">    MITK_WARN("NavigationDataSet") &lt;&lt; "Invalid toolIndex: " &lt;&lt; m_NumberOfTools &lt;&lt; " Tools known, requested index " &lt;&lt; toolIndex &lt;&lt; "";
    return std::vector&lt;mitk::NavigationData::Pointer&gt;();</span>
  }

<span style = "background-color:#fdd">  std::vector&lt; mitk::NavigationData::Pointer &gt; result;</span>

<span style = "background-color:#fdd">  for(std::vector&lt;std::vector&lt;NavigationData::Pointer&gt; &gt;::size_type i = 0; i &lt; m_NavigationDataVectors.size(); i++)
    result.push_back(m_NavigationDataVectors[i][toolIndex]);</span>

<span style = "background-color:#fdd">  return result;
}</span>

std::vector&lt; mitk::NavigationData::Pointer &gt; mitk::NavigationDataSet::GetTimeStep(unsigned int index) const
<span style = "background-color:#fdd">{
  return m_NavigationDataVectors[index];
}</span>

unsigned int mitk::NavigationDataSet::GetNumberOfTools() const
<span style = "background-color:#fdd">{
  return m_NumberOfTools;
}</span>

unsigned int mitk::NavigationDataSet::Size() const
<span style = "background-color:#fdd">{
  return m_NavigationDataVectors.size();
}</span>

// ---&gt; methods necessary for BaseData
void mitk::NavigationDataSet::SetRequestedRegionToLargestPossibleRegion()
<span style = "background-color:#fdd">{
}</span>

bool mitk::NavigationDataSet::RequestedRegionIsOutsideOfTheBufferedRegion()
<span style = "background-color:#fdd">{
  return false;
}</span>

bool mitk::NavigationDataSet::VerifyRequestedRegion()
<span style = "background-color:#fdd">{
  return true;
}</span>

void mitk::NavigationDataSet::SetRequestedRegion(const DataObject * )
<span style = "background-color:#fdd">{
}</span>

bool mitk::NavigationDataSet::IsEmpty() const
<span style = "background-color:#fdd">{
  return (Size() == 0);
}</span>

void mitk::NavigationDataSet::ConvertNavigationDataToPointSet() const
<span style = "background-color:#fdd">{</span>
  //iterate over all tools
<span style = "background-color:#fdd">  for (unsigned int toolIndex = 0; toolIndex &lt; this-&gt;GetNumberOfTools(); ++ toolIndex)</span>
  {
<span style = "background-color:#fdd">    mitk::PointSet::Pointer _tempPointSet = mitk::PointSet::New();</span>
    //iterate over all time steps
<span style = "background-color:#fdd">    for (unsigned int time = 0; time &lt; m_NavigationDataVectors.size(); time++)</span>
    {
<span style = "background-color:#fdd">      _tempPointSet-&gt;InsertPoint(time,m_NavigationDataVectors[time][toolIndex]-&gt;GetPosition());
      MITK_DEBUG &lt;&lt; m_NavigationDataVectors[time][toolIndex]-&gt;GetPosition() &lt;&lt; " --- " &lt;&lt; _tempPointSet-&gt;GetPoint(time);
    }
    mitk::DataNode::Pointer dn = mitk::DataNode::New();
    std::stringstream str;
    str &lt;&lt; "NavigationData Tool " &lt;&lt; toolIndex;
    dn-&gt;SetProperty("name", mitk::StringProperty::New(str.str()));
    dn-&gt;SetData(_tempPointSet);
    mitk::BaseRenderer::GetInstance(mitk::BaseRenderer::GetRenderWindowByName("stdmulti.widget3"))-&gt;GetDataStorage()-&gt;Add(dn);
  }
}</span>

// &lt;--- methods necessary for BaseData

// ---&gt; methods for Iterators

mitk::NavigationDataSet::NavigationDataSetConstIterator mitk::NavigationDataSet::Begin() const
<span style = "background-color:#fdd">{
  return m_NavigationDataVectors.cbegin();
}</span>

mitk::NavigationDataSet::NavigationDataSetConstIterator mitk::NavigationDataSet::End() const
<span style = "background-color:#fdd">{
  return m_NavigationDataVectors.cend();
}</span></pre>
	</body>
</html>